"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([["29425"],{87578:function(t,e,i){i.d(e,{x:function(){return n}});const n=(t,e)=>t.substring(0,e.length)===e},16037:function(t,e,i){i.d(e,{V:function(){return s}});var n=i(53049);const s=(t,e)=>(t=>{switch(t){case"de":case"lb":return!0;default:return!1}})(e)?(0,n.f)(t):t.toLocaleLowerCase(e)},43563:function(t,e,i){i.d(e,{MY:function(){return m},Yc:function(){return u},hb:function(){return y},jV:function(){return l},o1:function(){return g},ri:function(){return v},sS:function(){return _}});i(26847),i(1455),i(64455),i(56303),i(6202),i(44261),i(27530);var n=i(40141),s=i(44272),o=i(6219),r=i(16037),a=i(16230);const c="ui.components.logbook.messages",l=["counter","proximity","sensor","zone"],d={triggered_by_numeric_state_of:"numeric state of",triggered_by_state_of:"state of",triggered_by_event:"event",triggered_by_time_pattern:"time pattern",triggered_by_time:"time",triggered_by_homeassistant_stopping:"Home Assistant stopping",triggered_by_homeassistant_starting:"Home Assistant starting"},_=async(t,e,i)=>h(t,e,void 0,void 0,i),h=(t,e,i,n,s,o)=>{if((n||o)&&(!n||0===n.length)&&(!o||0===o.length))return Promise.resolve([]);const r={type:"logbook/get_events",start_time:e};return i&&(r.end_time=i),null!=n&&n.length&&(r.entity_ids=n),null!=o&&o.length&&(r.device_ids=o),s&&(r.context_id=s),t.callWS(r)},u=(t,e,i,n,s,o,r)=>{if((o||r)&&(!o||0===o.length)&&(!r||0===r.length))return Promise.reject("No entities or devices");const a={type:"logbook/event_stream",start_time:i,end_time:n};return null!=o&&o.length&&(a.entity_ids=o),null!=r&&r.length&&(a.device_ids=r),t.connection.subscribeMessage(t=>e(t,s),a)},g=(t,e)=>({entity_id:t.entity_id,state:e,attributes:{device_class:null==t?void 0:t.attributes.device_class,source_type:null==t?void 0:t.attributes.source_type,has_date:null==t?void 0:t.attributes.has_date,has_time:null==t?void 0:t.attributes.has_time,entity_picture_local:n.iY.has((0,s.M)(t.entity_id))||null==t?void 0:t.attributes.entity_picture_local,entity_picture:n.iY.has((0,s.M)(t.entity_id))||null==t?void 0:t.attributes.entity_picture}}),y=(t,e)=>{for(const i of Object.keys(d)){const n=d[i];if(e.startsWith(n))return e.replace(n,`${t(`ui.components.logbook.${i}`)}`)}return e},v=(t,e,i,s,o)=>{switch(o){case"device_tracker":case"person":return"not_home"===i?e(`${c}.was_away`):"home"===i?e(`${c}.was_at_home`):e(`${c}.was_at_state`,{state:i});case"sun":return e("above_horizon"===i?`${c}.rose`:`${c}.set`);case"binary_sensor":{const o=i===n.uo,a=i===n.lC,l=s.attributes.device_class;if(l&&(o||a))return e(`${c}.${o?"detected_device_classes":"cleared_device_classes"}.${l}`,{device_class:(0,r.V)(e(`component.binary_sensor.entity_component.${l}.name`)||l,t.language)})||e(`${c}.${o?"detected_device_class":"cleared_device_class"}`,{device_class:(0,r.V)(e(`component.binary_sensor.entity_component.${l}.name`)||l,t.language)});break}case"cover":switch(i){case"open":return e(`${c}.was_opened`);case"opening":return e(`${c}.is_opening`);case"closing":return e(`${c}.is_closing`);case"closed":return e(`${c}.was_closed`)}break;case"event":return e(`${c}.detected_event_no_type`);case"lock":switch(i){case"unlocked":return e(`${c}.was_unlocked`);case"locking":return e(`${c}.is_locking`);case"unlocking":return e(`${c}.is_unlocking`);case"opening":return e(`${c}.is_opening`);case"open":return e(`${c}.is_opened`);case"locked":return e(`${c}.was_locked`);case"jammed":return e(`${c}.is_jammed`)}}return i===n.uo?e(`${c}.turned_on`):i===n.lC?e(`${c}.turned_off`):i===a.lz?e(`${c}.became_unknown`):i===a.nZ?e(`${c}.became_unavailable`):t.localize(`${c}.changed_to_state`,{state:s?t.formatEntityState(s,i):i})},m=t=>"sensor"!==(0,o.N)(t)||void 0===t.attributes.unit_of_measurement&&void 0===t.attributes.state_class},59715:function(t,e,i){i.d(e,{U_:function(){return a},Zm:function(){return l},lj:function(){return r},mA:function(){return o},nV:function(){return c}});i(40777),i(6988),i(81738),i(29981);if(99387==i.j)var n=i(87578);var s=i(10142);const o=(t,e,i,n)=>t.callWS({type:"trace/get",domain:e,item_id:i,run_id:n}),r=(t,e,i)=>t.callWS({type:"trace/list",domain:e,item_id:i}),a=(t,e,i)=>t.callWS({type:"trace/contexts",domain:e,item_id:i}),c=(t,e)=>{const i=e.split("/").reverse();let n=t;for(;i.length;){const t=i.pop(),e=Number(t);if(isNaN(e)){let e=n[t];if(!e&&"sequence"===t)continue;e||"trigger"!==t||(e=n.triggers),e||"condition"!==t||(e=n.conditions),e||"action"!==t||(e=n.actions),n="trigger"===t?(0,s.Kc)(e):e;continue}if(Array.isArray(n))n=n[e];else if(0!==e)throw new Error("If config is not an array, can only return index 0")}return n},l=t=>"trigger"===t||(0,n.x)(t,"trigger/")},63583:function(t,e,i){i.a(t,async function(t,e){try{i(39710),i(26847),i(2394),i(81738),i(6989),i(64455),i(26086),i(56389),i(6202),i(27530);var n=i(73742),s=i(59048),o=i(7616),r=i(31733),a=i(36180),c=i(37528),l=i(40142),d=i(45691),_=i(89868),h=i(39884),u=i(44272),g=i(67050),y=i(32483),v=i(23476),m=(i(5786),i(19262)),p=i(43563),b=i(95814),x=i(54643),$=i(35580),f=i(96222),k=t([v,m,l,d]);[v,m,l,d]=k.then?(await k)():k;let w,z,C,I,M,S,E,N,P,j,B,L,T,W,U,D,V,O,A=t=>t;const Y=["script","automation"],H=t=>t.context_event_type||t.context_state||t.context_message,Z=(t,e)=>e?t.replace(e," "):t;class q extends s.oi{willUpdate(t){(!this.hasUpdated&&this.virtualize||t.has("virtualize")&&this.virtualize)&&(this.hass.loadBackendTranslation("services"),this.hass.loadBackendTranslation("title"),(0,x.o)())}shouldUpdate(t){const e=t.get("hass"),i=void 0===e||e.locale!==this.hass.locale;return t.has("entries")||t.has("traceContexts")||i}render(){var t;return null!==(t=this.entries)&&void 0!==t&&t.length?(0,s.dy)(z||(z=A` <div class="container ha-scrollbar ${0}" @scroll="${0}"> ${0} </div> `),(0,r.$)({narrow:this.narrow,"no-name":this.noName,"no-icon":this.noIcon}),this._saveScrollPos,this.virtualize?(0,s.dy)(C||(C=A`<lit-virtualizer @visibilityChanged="${0}" scroller class="ha-scrollbar" .items="${0}" .renderItem="${0}"> </lit-virtualizer>`),this._visibilityChanged,this.entries,this._renderLogbookItem):this.entries.map((t,e)=>this._renderLogbookItem(t,e))):(0,s.dy)(w||(w=A` <div class="container no-entries"> ${0} </div> `),this.hass.localize("ui.components.logbook.entries_not_found"))}_saveScrollPos(t){this._savedScrollPos=t.target.scrollTop}_visibilityChanged(t){(0,h.B)(this,"hass-logbook-live",{enable:0===t.first})}_renderIndicator(t){const e=this.hass.states[t.entity_id],i=getComputedStyle(this),n={backgroundColor:void 0!==t.state?(0,y.U)(t.state,i,e):void 0};return(0,s.dy)(I||(I=A` <div class="indicator" style="${0}"></div> `),(0,a.V)(n))}_renderMessage(t,e,i,n,s){if(t.entity_id&&t.state)return n?(0,p.ri)(this.hass,this.hass.localize,t.state,n,i):t.state;const o=H(t);let r=t.message;if(Y.includes(i)&&t.source){if(o)return"";r=(0,p.hb)(this.hass.localize,t.source)}return r?this._formatMessageWithPossibleEntity(o?Z(r,t.context_entity_id):r,e,void 0,s):""}_renderUser(t){const e=t.context_user_id&&this.userIdToName[t.context_user_id];return e?`- ${e}`:""}_renderUnseenContextSourceEntity(t,e,i){return!t.context_entity_id||e.includes(t.context_entity_id)?"":(0,s.dy)(M||(M=A` (${0})`),this._renderEntity(t.context_entity_id,t.context_entity_id_name,i))}_renderContextMessage(t,e,i){if(t.context_state){const e=t.context_entity_id&&t.context_entity_id in this.hass.states?(0,p.o1)(this.hass.states[t.context_entity_id],t.context_state):void 0;return(0,s.dy)(S||(S=A`${0} ${0} ${0}`),this.hass.localize("ui.components.logbook.triggered_by_state_of"),this._renderEntity(t.context_entity_id,t.context_entity_id_name,i),e?(0,p.ri)(this.hass,this.hass.localize,t.context_state,e,(0,u.M)(t.context_entity_id)):t.context_state)}var n;if("call_service"===t.context_event_type)return(0,s.dy)(E||(E=A`${0} ${0}`),this.hass.localize("ui.components.logbook.triggered_by_action"),t.context_domain&&t.context_service?`${(0,f.Lh)(this.hass.localize,t.context_domain)}:\n      ${this.hass.localize(`component.${t.context_domain}.services.${t.context_service}.name`)||(null===(n=this.hass.services[t.context_domain])||void 0===n||null===(n=n[t.context_service])||void 0===n?void 0:n.name)||t.context_service}`:"");if(!t.context_message||e.includes(t.context_entity_id))return"";if("automation_triggered"===t.context_event_type||"script_started"===t.context_event_type){const n=t.context_source?t.context_source:t.context_message.replace("triggered by ",""),o=(0,p.hb)(this.hass.localize,n);return(0,s.dy)(N||(N=A`${0} ${0} ${0}`),this.hass.localize("automation_triggered"===t.context_event_type?"ui.components.logbook.triggered_by_automation":"ui.components.logbook.triggered_by_script"),this._renderEntity(t.context_entity_id,t.context_entity_id_name,i),t.context_message?this._formatMessageWithPossibleEntity(o,e,void 0,i):"")}return(0,s.dy)(P||(P=A` ${0} ${0} ${0} ${0}`),this.hass.localize("ui.components.logbook.triggered_by"),t.context_name,this._formatMessageWithPossibleEntity(t.context_message,e,t.context_entity_id,i),this._renderUnseenContextSourceEntity(t,e,i))}_renderEntity(t,e,i){const n=t&&t in this.hass.states,o=e||n&&this.hass.states[t].attributes.friendly_name||t;return n?i?o:(0,s.dy)(j||(j=A`<button class="link" @click="${0}" .entityId="${0}"> ${0} </button>`),this._entityClicked,t,o):o}_formatMessageWithPossibleEntity(t,e,i,n){if(-1!==t.indexOf(".")){const i=t.split(" ");for(let t=0,o=i.length;t<o;t++)if(i[t]in this.hass.states){const o=i[t];if(e.includes(o))return"";e.push(o);const r=i.splice(t);return r.shift(),(0,s.dy)(B||(B=A`${0} ${0} ${0}`),i.join(" "),this._renderEntity(o,this.hass.states[o].attributes.friendly_name,n),r.join(" "))}}if(i&&i in this.hass.states){const o=this.hass.states[i].attributes.friendly_name;if(o&&t.endsWith(o))return e.includes(i)?"":(e.push(i),t=t.substring(0,t.length-o.length),(0,s.dy)(L||(L=A`${0} ${0}`),t,this._renderEntity(i,o,n)))}return t}_entityClicked(t){const e=t.currentTarget.entityId;e&&(t.preventDefault(),t.stopPropagation(),(0,h.B)(this,"hass-more-info",{entityId:e}))}_handleClick(t){const e=t.currentTarget;e.traceLink&&((0,g.c)(e.traceLink),(0,h.B)(this,"closed"))}static get styles(){return[b.Qx,b.$c,b.k1,(0,s.iv)(T||(T=A`:host([virtualize]){display:block;height:100%}.entry-container{width:100%}.entry{position:relative;display:flex;width:100%;line-height:var(--ha-line-height-expanded);padding:8px 16px;box-sizing:border-box;border-top:1px solid var(--divider-color);justify-content:space-between;align-items:center}.indicator{background-color:var(--disabled-color);height:8px;width:8px;border-radius:4px;flex-shrink:0;margin-right:12px;margin-inline-start:initial;margin-inline-end:12px;direction:var(--direction)}ha-icon-next{color:var(--secondary-text-color)}.clickable{cursor:pointer}:not(.clickable) .entry.no-entity,:not(.clickable) .no-name .entry{cursor:default}.entry:hover{background-color:rgba(var(--rgb-primary-text-color),.04)}.narrow:not(.no-icon) .time{margin-left:32px;margin-inline-start:32px;margin-inline-end:initial;direction:var(--direction)}.message-relative_time{display:flex;flex-direction:column}.secondary{font-size:var(--ha-font-size-s);line-height:var(--ha-line-height-normal)}.secondary a{color:var(--secondary-text-color)}.date{margin:8px 0;padding:0 16px}.icon-message{display:flex;align-items:center}.no-entries{text-align:center;color:var(--secondary-text-color)}state-badge{margin-right:16px;margin-inline-start:initial;flex-shrink:0;color:var(--state-icon-color);margin-inline-end:16px;direction:var(--direction)}.message{color:var(--primary-text-color)}.no-name .message:first-letter{text-transform:capitalize}a{color:var(--primary-color);text-decoration:none}button.link{color:var(--state-icon-color);text-decoration:none}.container{max-height:var(--logbook-max-height)}.container,lit-virtualizer{height:100%}lit-virtualizer{contain:size layout!important}.narrow .entry{line-height:var(--ha-line-height-normal)}.narrow .icon-message state-badge{margin-left:0;margin-inline-start:0;margin-right:8px;margin-inline-end:8px;direction:var(--direction)}`))]}constructor(...t){super(...t),this.userIdToName={},this.traceContexts={},this.entries=[],this.narrow=!1,this.virtualize=!1,this.showIndicator=!1,this.noIcon=!1,this.noName=!1,this.relativeTime=!1,this._renderLogbookItem=(t,e)=>{var i;if(!t||void 0===e)return s.Ld;const n=this.entries[e-1],o=[],a=t.entity_id?this.hass.states[t.entity_id]:void 0,_=a?(0,p.o1)(a,t.state):void 0,h=t.entity_id?(0,u.M)(t.entity_id):t.domain,g=_||t.icon||t.state||!h||!(0,c.p)(this.hass,h)?void 0:(0,$.X1)({domain:h,type:"icon",useFallback:!0,darkOptimized:null===(i=this.hass.themes)||void 0===i?void 0:i.darkMode}),y=Y.includes(t.domain)&&t.context_id&&t.context_id in this.traceContexts?this.traceContexts[t.context_id]:void 0,v=void 0!==y;return(0,s.dy)(W||(W=A` <div class="entry-container ${0}" .traceLink="${0}" @click="${0}"> ${0} <div class="entry ${0}"> <div class="icon-message"> ${0} ${0} <div class="message-relative_time"> <div class="message"> ${0} ${0} ${0} </div> <div class="secondary"> <span>${0}</span> - <ha-relative-time .hass="${0}" .datetime="${0}" capitalize></ha-relative-time> ${0} ${0} </div> </div> </div> ${0} </div> </div> `),(0,r.$)({clickable:v}),y?`/config/${y.domain}/trace/${y.item_id}?run_id=${y.run_id}`:void 0,this._handleClick,0===e||null!=t&&t.when&&null!=n&&n.when&&new Date(1e3*t.when).toDateString()!==new Date(1e3*n.when).toDateString()?(0,s.dy)(U||(U=A` <h4 class="date"> ${0} </h4> `),(0,l.p6)(new Date(1e3*t.when),this.hass.locale,this.hass.config)):s.Ld,(0,r.$)({"no-entity":!t.entity_id}),this.noIcon?"":(0,s.dy)(D||(D=A` <state-badge .hass="${0}" .overrideIcon="${0}" .overrideImage="${0}" .stateObj="${0}" .stateColor="${0}"></state-badge> `),this.hass,t.icon,g,t.icon?void 0:_,!1),this.showIndicator?this._renderIndicator(t):"",this.noName?"":this._renderEntity(t.entity_id,t.name,v),this._renderMessage(t,o,h,_,v),this._renderContextMessage(t,o,v),(0,d.Vu)(new Date(1e3*t.when),this.hass.locale,this.hass.config),this.hass,1e3*t.when,t.context_user_id?(0,s.dy)(V||(V=A`${0}`),this._renderUser(t)):"",v?`- ${this.hass.localize("ui.components.logbook.show_trace")}`:"",v?(0,s.dy)(O||(O=A`<ha-icon-next></ha-icon-next>`)):"")}}}(0,n.__decorate)([(0,o.Cb)({attribute:!1})],q.prototype,"hass",void 0),(0,n.__decorate)([(0,o.Cb)({attribute:!1})],q.prototype,"userIdToName",void 0),(0,n.__decorate)([(0,o.Cb)({attribute:!1})],q.prototype,"traceContexts",void 0),(0,n.__decorate)([(0,o.Cb)({attribute:!1})],q.prototype,"entries",void 0),(0,n.__decorate)([(0,o.Cb)({type:Boolean,attribute:"narrow"})],q.prototype,"narrow",void 0),(0,n.__decorate)([(0,o.Cb)({type:Boolean,attribute:"virtualize",reflect:!0})],q.prototype,"virtualize",void 0),(0,n.__decorate)([(0,o.Cb)({type:Boolean,attribute:"show-indicator"})],q.prototype,"showIndicator",void 0),(0,n.__decorate)([(0,o.Cb)({type:Boolean,attribute:"no-icon"})],q.prototype,"noIcon",void 0),(0,n.__decorate)([(0,o.Cb)({type:Boolean,attribute:"no-name"})],q.prototype,"noName",void 0),(0,n.__decorate)([(0,o.Cb)({type:Boolean,attribute:"relative-time"})],q.prototype,"relativeTime",void 0),(0,n.__decorate)([(0,_.i)(".container")],q.prototype,"_savedScrollPos",void 0),(0,n.__decorate)([(0,o.hO)({passive:!0})],q.prototype,"_saveScrollPos",null),(0,n.__decorate)([(0,o.hO)({passive:!0})],q.prototype,"_visibilityChanged",null),q=(0,n.__decorate)([(0,o.Mo)("ha-logbook-renderer")],q),e()}catch(w){e(w)}})}}]);
//# sourceMappingURL=29425.a847f6bdc1897002.js.map