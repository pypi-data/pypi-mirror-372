[project]
name = "bliss"
version = "2.2.1"
description = "BeamLine Instrumentation Support Software"
readme = "README.md"
license = "LGPL-3.0-or-later"
authors = [{name = "BCU (ESRF)"}]
maintainers = [{name = "bliss developers", email = "bliss@esrf.fr"}]
classifiers = [
    "Intended Audience :: Science/Research",
    "Programming Language :: Python :: 3",
]
requires-python = ">=3.10"
dependencies = [
    "appdirs<1.5",
    "beartype>=0.17,<0.21",
    "blissdata>=2.0,<2.1",
    "blisswriter>=1.0.0,<1.1", # pin up to the minor version to allow bug fixes
    "cerberus<1.4",
    "cffi<1.18",
    "docopt<0.7",
    "fabio>=0.12,<2024.10",
    "flask>=2.0.1,<3.2",
    "gevent>=20.9.0,<24.12",
    "glom<24.12",
    "greenlet>=0.4.17,<3.2",
    "h5py>=2.9,!=3.3,!=3.4,<3.14",  # blacklist versions with corrupt deployment
    "hdf5plugin<5.1",
    "hiredis<3.2",
    "lima2-client~=2.2",
    "louie>=2.0,<2.1",
    "matplotlib==3.9.*",
    "mendeleev<0.16.0",
    "mock<5.3",
    "msgpack-numpy>=0.4.4.2,<0.5",
    "msgpack<1.2",
    "networkx>2.4,<3.5",
    "numexpr<2.11",
    "numpy>=1.21.1,<2",
    "packaging<25",
    "pandas<2.3",
    "pillow<11.2",
    "pint<0.25",
    "psutil<7.1",
    "ptpython>=3.0.23,<3.0.24",
    "prompt-toolkit>=3.0.50,<3.1",
    "pygments<2.19.0",
    "pyicat-plus>=0.9.0,<1",
    "esrf-ontologies>=1,<2",
    "pymca>=5.8.1,<5.10",
    "pyqt5>=5.12",
    "pyserial>2,<3.6",
    "pytango>9.4,<10.0",
    "querypool<1.1",
    "redis>=4,<5.0.1",  # https://gitlab.esrf.fr/bliss/bliss/-/merge_requests/5686, need refactoring settings cache
    "requests<2.33",
    "ruamel.yaml<0.19",
    "scipy>=1.1.0,<1.16",
    "silx~=2.2.0",
    "simple-pid<2.1",
    "sortedcontainers<2.5",
    "tabulate<0.10",
    "tblib>=1.7,<3.1",
    "treelib<=1.5.5,<1.6",
    "typing_extensions<4.13",
    "xcalibu==1.0.1,<1.1",
    "yappi<1.7",
    "lru-dict<1.4"
]

[project.urls]
Homepage = "https://gitlab.esrf.fr/bliss/bliss"
Documentation = "https://bliss.gitlab-pages.esrf.fr/bliss"
Tracker = "https://gitlab.esrf.fr/bliss/bliss/issues"

[project.optional-dependencies]
dev = [
    "black==22.3", # lint
    "flake8<7.2", # lint
    "flake8-pep585",
    "pre-commit",
    "pytest-cov",
    "pytest-mock",
    "pytest-profiling!=1.8.0", # https://gitlab.esrf.fr/bliss/bliss/-/issues/4543
    "pytest-rerunfailures",
    "pytest-xvfb",
    "pytest",
    "scriv>=1.3.1",
    "nosqltangodb", # for beacon
    "python-socketio[asyncio_client]" # for rest API testing
]
rest = [
    "pydantic",
    "eval_type_backport; python_version=='3.9'",
    "flask-socketio",
    "flask",
    "flask-cors",
    "flask-openapi3"
]
doc = [
    "markdown>=3.2,<3.4",
    "mike",
    "mkdocs-material>=8.2.11",
    "mkdocs-material-extensions>=1.0.3", # 1.0.(1|2) is buggy
    "sphinx"
]

[project.scripts]
bliss = "bliss.shell.main.step1:main"
bliss-emulator = "bliss.controllers.emulator:main"
beacon-server = "bliss.beacon.app.beacon_server:main"
BlissBrother = "bliss.tango.servers.bliss_brother_ds:main"
bliss-ct2-server = "bliss.controllers.ct2.server:main"
bliss-flex-server = "bliss.controllers.correlator.flex.server:main"
bliss-handel-server = "bliss.controllers.mca.handel.server:main"
bliss-speedgoat-server = "bliss.controllers.speedgoat.server:main"
bliss-service = "bliss.comm.service:main"
CT2 = "bliss.tango.servers.ct2_ds:main"
BlissAxisManager = "bliss.tango.servers.axis_ds:main"
BlissTempManager = "bliss.tango.servers.temp_ds:main"
Musst = "bliss.tango.servers.musst_ds:main"
FuelCell = "bliss.tango.servers.fuelcell_ds:main"
Gpib = "bliss.tango.servers.gpib_ds:main"
Keithley428 = "bliss.tango.servers.keithley428_ds:main"
Multimeter = "bliss.tango.servers.keithley_ds:main"
Multiplexer = "bliss.tango.servers.multiplexer_ds:main"
LinkamDsc = "bliss.tango.servers.linkamdsc_ds:main"
NanoBpm = "bliss.tango.servers.nanobpm_ds:main"
NanoBpmServo = "bliss.tango.servers.nanobpm_servo_ds:main"
Wago = "bliss.tango.servers.wago_ds:main"
MCCE = "bliss.tango.servers.mcce_ds:main"
Regulation = "bliss.tango.servers.regulation_ds:main"
BlissMotorController = "bliss.tango.servers.motor_controller_ds:main"
BlissTangoServer = "bliss.tango.servers.bliss_ds:main"
tcp-proxy = "bliss.comm.tcp_proxy:main"
Tetramm = "bliss.tango.servers.tetramm_ds:main"

[project.entry-points.bliss_rest]
bliss = "bliss.rest_service.default_rest_plugin:DefaultRestPlugin"

[build-system]
requires = ["setuptools>40.8"]
build-backend = "setuptools.build_meta"

[tool.setuptools.packages.find]
include = ["bliss", "bliss.*"]

[tool.setuptools.package-data]
"bliss" = ["py.typed"]
"bliss.controllers.regulation.temperature.eurotherm" = ["*.txt"]
"bliss.beacon.redis" = ["*.conf"]
"bliss.beacon.services.configuration" = ["static/**", "templates/**", "plugins/*.html"]
"bliss.beacon.services.homepage" = ["static/**", "templates/**"]
"bliss.config" = ["tmux.conf"]
"bliss.shell.qtapp.resources" = ["logo/*.svg", "ui/*.ui"]
"bliss.controllers.speedgoat" = ["*.bat", "*.dll", "*.h"]
"bliss.tango.servers" = ["*.xmi", "ct2_ds/*.xmi"]

[tool.pytest.ini_options]
addopts = "-v --ignore=tests/images --ignore=tests/test_configuration --ignore=tests/controllers_hw --ignore=tests/emulators"
filterwarnings = [
    "ignore::DeprecationWarning",
    "ignore::PendingDeprecationWarning"
]
log_format = "%(asctime)s.%(msecs)03d %(levelname)08s %(message)s"
log_date_format = "%Y-%m-%d %H:%M:%S"
markers = [
    "can_segfault: Marks tests which can segfault. They are executed in a dedicated 'bliss_unstable' job"
]
