var FuncNodesPlugin=function(T,s){"use strict";function O(c){const v=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(c){for(const p in c)if(p!=="default"){const m=Object.getOwnPropertyDescriptor(c,p);Object.defineProperty(v,p,m.get?m:{enumerable:!0,get:()=>c[p]})}}return v.default=c,Object.freeze(v)}const k=O(T);var R={exports:{}},_={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var P;function w(){if(P)return _;P=1;var c=Symbol.for("react.transitional.element"),v=Symbol.for("react.fragment");function p(m,e,t){var n=null;if(t!==void 0&&(n=""+t),e.key!==void 0&&(n=""+e.key),"key"in e){t={};for(var u in e)u!=="key"&&(t[u]=e[u])}else t=e;return e=t.ref,{$$typeof:c,type:m,key:n,ref:e!==void 0?e:null,props:t}}return _.Fragment=v,_.jsx=p,_.jsxs=p,_}var I;function C(){return I||(I=1,R.exports=w()),R.exports}var l=C();return{renderpluginfactory:({})=>({input_renderers:{"funcnodes_files.FileUpload":({})=>{const e=k.useRef(null),t=s.useIOStore(),n=s.useIOStore("parent"),u=t.use(r=>r.node),f=t.use(r=>r.connected),y=s.useSetIOValue(),{worker:g}=s.useWorkerApi(),h=s.useFuncNodesContext(),b=(r,i,a)=>{h.on_node_action({type:"update",id:u,node:{progress:{prefix:"Uploading",n:r,total:i,elapsed:(new Date().getTime()-a)/1e3,unit_scale:!0,unit:"B",unit_divisor:1024}},from_remote:!0})},F=async r=>{const i=r.target.files;if(!i||i.length===0||!n)return;const a=n.getState();let x;for(let d=0;d<10;d++){try{const o=n.valuestore.getState().full;if(o){x=o.value?.path?.toString();break}}catch{}if(a.try_get_full_value===void 0)break;a.try_get_full_value(),await new Promise(o=>setTimeout(o,500))}const S=new Date().getTime(),j=await g?.upload_file({files:i,onProgressCallback:(d,o)=>{b(d,o,S)},root:x});y(j,!0)};return l.jsxs("div",{children:[l.jsx("input",{className:"nodedatainput styledinput",type:"file",onChange:F,disabled:f,style:{display:"none"},ref:e}),l.jsx("button",{className:"nodedatainput styledinput",disabled:f,onClick:()=>{e.current?.click()},children:"Upload File"})]})},"funcnodes_files.FolderUpload":({})=>{const e=k.useRef(null),t=s.useIOStore(),n=s.useIOStore("parent"),u=t.use(r=>r.node),f=t.use(r=>r.connected),{worker:y}=s.useWorkerApi(),g=s.useFuncNodesContext(),h=s.useSetIOValue(),b=(r,i,a)=>{g.on_node_action({type:"update",id:u,node:{progress:{prefix:"Uploading",n:r,total:i,elapsed:(new Date().getTime()-a)/1e3,unit_scale:!0,unit:"B",unit_divisor:1024}},from_remote:!0})},F=async r=>{const i=r.target.files;if(!i||i.length===0||!n)return;let a;const x=n.getState();for(let d=0;d<10;d++){try{const o=n.valuestore.getState().full;if(o){a=o.value?.path?.toString();break}}catch{}if(x.try_get_full_value===void 0)break;x.try_get_full_value(),await new Promise(o=>setTimeout(o,500))}const S=new Date().getTime(),j=await y?.upload_file({files:i,onProgressCallback:(d,o)=>{b(d,o,S)},root:a});h(j,!0)};return l.jsxs("div",{children:[l.jsx("input",{className:"nodedatainput styledinput",type:"file",onChange:F,disabled:f,style:{display:"none"},ref:e,webkitdirectory:"true",directory:"true",multiple:!0}),l.jsx("button",{className:"nodedatainput styledinput",disabled:f,onClick:()=>{e.current?.click()},children:"Upload Folder"})]})}},output_renderers:{"funcnodes_files.FileDownload":({})=>{const e=k.useRef(null),t=s.useIOGetFullValue(),n=s.useIOValueStore("filename");console.log(n);const u=k.useCallback(async()=>{if(!t||!n)return;const f=n.preview?.toString()??"";if(!f)return;const y=await t();if(!y)return;const g=e.current;g?.setAttribute("href",y.objectUrl),g?.setAttribute("download",f),g?.click()},[t,n]);return l.jsxs("div",{children:[l.jsx("a",{ref:e,style:{display:"none"},href:"",download:""}),l.jsx("button",{className:"nodedatainput styledinput",onClick:u,children:"Download File"})]})}}}),v:s.LATEST_VERSION}}(React,FuncNodesReactFlow);
