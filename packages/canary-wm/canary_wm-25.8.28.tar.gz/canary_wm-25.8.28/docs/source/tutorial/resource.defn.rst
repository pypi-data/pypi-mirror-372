.. Copyright NTESS. See COPYRIGHT file for details.

   SPDX-License-Identifier: MIT

.. _tutorial-resource-defn:

Defining the resource pool
==========================

Homogeneous single-node compute environments
--------------------------------------------

For desktop and single-node *homogeneous* compute environments, the resource pool can be specified on the command line by simply defining the number of each resource type.  For example, resource pool having the default CPU count (as determined by ``canary``) and 4 GPUs, can be generated by

.. command-output:: canary -c resource_pool:gpus:4 config show resource_pool
    :nocache:

The resource pool can also be defined in the ``resource_pool`` section of the configuration file:

.. code-block:: yaml

  resource_pool:
    gpus: 4

Homogeneous multi-node compute environments
-------------------------------------------

For homogeneous multi-node compute environments, the resource pool can be specified on the command line by defining the number nodes, and the count per node of each resource type.  For example, resource pool having 4 compute nodes with 32 CPUs and 4 GPUs per node, respectively, can be generated via:

.. command-output:: canary -c resource_pool:nodes:4 -c resource_pool:cpus_per_node:32 -c resource_pool:gpus_per_node:4 config show resource_pool
    :nocache:
    :ellipsis: 4

The resource pool can also be defined in the ``resource_pool`` section of the configuration file:

.. code-block:: yaml

  resource_pool:
    nodes: 4
    cpus_per_node: 32
    gpus_per_node: 4

.. note::

  On HPC systems, :ref:`hpc-connect` will probe the specified batch scheduler to generate the homogenous multi-node resource pool.

Heterogeneous compute environments
----------------------------------

For heterogeneous single or multi-node compute environments, the resource pool must by specified in the ``resource_pool`` section of a configuration file.  The resource pool must define the CPU configuration on each node in addition to any other named resource type.  The resource types *must not* end in ``_per_node``.  For example, a pool having 1 node with ``N`` CPUs with 1 slot per CPU and 4 GPUs with 2, 2, 4, and 4 slots, respectively, would be defined in the configuration file as:

.. code-block:: yaml

  resource_pool:
  - id: "0"
    cpus:
    - id: "0"
      slots: 1
    - id: "1"
      slots: 1
    # Repeat entries until "id": "N-1" for N CPUs in total
    - id: "N-1"
      slots: 1
    gpus:
    - id: "0"
      slots: 2
    - id: "1"
      slots: 2
    - id: "2"
      slots: 4
    - id: "3"
      slots: 4
