var Mt=l=>{throw TypeError(l)};var Ot=(l,t,a)=>t.has(l)||Mt("Cannot "+a);var Me=(l,t,a)=>(Ot(l,t,"read from private field"),a?a.call(l):t.get(l)),rt=(l,t,a)=>t.has(l)?Mt("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(l):t.set(l,a);var Nt=(l,t,a)=>(Ot(l,t,"access private method"),a);import{u as it,a as Xt}from"../chunks/C2RVOhm1.js";import{a as ea}from"../chunks/CZ9iRrNd.js";import{r as He,i as ta,a as aa,b as sa}from"../chunks/H7C68rOM.js";import{r as ra}from"../chunks/B90CZVMX.js";import{d as qt,g as Xe,w as na}from"../chunks/B9NWxkPv.js";import"../chunks/CWj6FrbW.js";import{a9 as bt,g as e,F as M,p as Oe,f as w,n as lt,a as Ne,s as r,c as o,at as ae,d as _,r as n,t as ce,P as Be,au as oa,ai as ia,u as Dt}from"../chunks/Bzf_CGVu.js";import{c as U,a as s,t as g,d as fe}from"../chunks/DudhA4Qw.js";import{a as O,i as re,s as Ge}from"../chunks/CMIc6HKa.js";import{s as Ue}from"../chunks/DTwAVzRw.js";import{s as dt,r as at,c as ve,a as je,p as et,b as Lt}from"../chunks/BYXJJYwp.js";import{p as Je}from"../chunks/BoQGZ29z.js";import{Y as yt,I as ct,B as Re,c as ot,D as $t,Z as pt,e as We,i as nt,l as la,_ as wt,$ as Ct,a0 as St,a1 as Pt,a2 as kt,a3 as Tt,a4 as da,a5 as zt,b as jt,a6 as ca,a7 as Rt,a8 as Vt,f as ua,a9 as Et,aa as va,ab as fa,ac as Ht,ad as ma,o as mt,k as pa,s as _a,p as ga,ae as ha,af as $a,ag as xa,ah as ba,ai as ya,aj as Gt,ak as wa,al as Ca,am as Sa,g as Pa,an as ka,d as Ta,u as Ia,P as Ea,ao as Aa,O as Fa,ap as Ma}from"../chunks/CEsXP70Q.js";import{g as Ye,o as Jt,a as Kt}from"../chunks/DVrGeszw.js";import{S as ut,f as Qe,b as Oa}from"../chunks/DDZ-yUNZ.js";import{C as Na}from"../chunks/E3w8eaja.js";import{s as J}from"../chunks/CF3MLdDH.js";import{u as Wt}from"../chunks/zR0aG0nj.js";import{u as Da}from"../chunks/dEoPsUJ9.js";import{p as _t}from"../chunks/BCjuA-ED.js";import"../chunks/69_IOA4Y.js";import{u as La,c as za,b as ja}from"../chunks/JOxghoy7.js";import{c as vt}from"../chunks/BzArsHZA.js";import{u as Ra,a as Ba}from"../chunks/Dj2z331H.js";import{u as At}from"../chunks/CnVqPRP3.js";import{i as Qt}from"../chunks/1iR4VSSn.js";import{T as qa}from"../chunks/BVsK4-M8.js";var Va=["forEach","isDisjointFrom","isSubsetOf","isSupersetOf"],Ha=["difference","intersection","symmetricDifference","union"],Bt=!1,tt,qe,Ke,gt,Yt;const ht=class ht extends Set{constructor(a){super();rt(this,gt);rt(this,tt,new Map);rt(this,qe,bt(0));rt(this,Ke,bt(0));if(a){for(var i of a)super.add(i);Me(this,Ke).v=super.size}Bt||Nt(this,gt,Yt).call(this)}has(a){var i=super.has(a),c=Me(this,tt),d=c.get(a);if(d===void 0){if(!i)return e(Me(this,qe)),!1;d=bt(!0),c.set(a,d)}return e(d),i}add(a){return super.has(a)||(super.add(a),M(Me(this,Ke),super.size),yt(Me(this,qe))),this}delete(a){var i=super.delete(a),c=Me(this,tt),d=c.get(a);return d!==void 0&&(c.delete(a),M(d,!1)),i&&(M(Me(this,Ke),super.size),yt(Me(this,qe))),i}clear(){if(super.size!==0){super.clear();var a=Me(this,tt);for(var i of a.values())M(i,!1);a.clear(),M(Me(this,Ke),0),yt(Me(this,qe))}}keys(){return this.values()}values(){return e(Me(this,qe)),super.values()}entries(){return e(Me(this,qe)),super.entries()}[Symbol.iterator](){return this.keys()}get size(){return e(Me(this,Ke))}};tt=new WeakMap,qe=new WeakMap,Ke=new WeakMap,gt=new WeakSet,Yt=function(){Bt=!0;var a=ht.prototype,i=Set.prototype;for(const c of Va)a[c]=function(...d){return e(Me(this,qe)),i[c].apply(this,d)};for(const c of Ha)a[c]=function(...d){e(Me(this,qe));var v=i[c].apply(this,d);return new ht(v)}};let It=ht;function Ut(l,t){Oe(t,!0);let a=at(t,["$$slots","$$events","$$legacy"]);ct(l,dt({name:"image"},()=>a,{iconNode:[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2"}],["circle",{cx:"9",cy:"9",r:"2"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"}]],children:(c,d)=>{var v=U(),y=w(v);Ue(y,()=>t.children??lt),s(c,v)},$$slots:{default:!0}})),Ne()}var Ga=g("<!> Samples",1),Ja=g("<!> Annotations",1),Ka=g('<div class="mb-5 mt-2 text-lg font-semibold">Collections</div> <!> <div class="flex space-x-2"><!> <!></div>',1);function Wa(l,t){Oe(t,!0);const a="is-active inline-flex rounded-md bg-muted",i=()=>{Ye(He.toSamples(t.datasetId))},c=()=>{Ye(He.toAnnotations(t.datasetId))};var d=Ka(),v=r(w(d),2);ut(v,{class:"mb-4 bg-border-hard"});var y=r(v,2),B=o(y);const E=_(()=>ot("flex-1","px-2",t.gridType=="samples"&&a));Re(B,{variant:"ghost",get class(){return e(E)},onclick:i,"data-testid":"collections-nav-samples-button","data-sveltekit-noscroll":!0,children:(I,C)=>{var S=Ga(),x=w(S);Ut(x,{class:"size-4"}),ae(),s(I,S)},$$slots:{default:!0}});var A=r(B,2);const k=_(()=>ot("flex-1","px-2",t.gridType=="annotations"&&a));Re(A,{get class(){return e(k)},variant:"ghost",onclick:c,"data-testid":"collections-nav-annotations-button","data-sveltekit-noscroll":!0,children:(I,C)=>{var S=Ja(),x=w(S);Na(x,{class:"size-4"}),ae(),s(I,S)},$$slots:{default:!0}}),n(y),s(l,d),Ne()}var Qa=g('<div class="space-y-1"><h2 class="text-md capitalize"> </h2> <div class="flex justify-between text-sm text-diffuse-foreground"><span> </span> <span> </span></div> <div class="relative p-2"><!></div></div>'),Ya=g('<div class="space-y-4"><div class="space-y-1"><h2 class="text-md">Width</h2> <div class="flex justify-between text-sm text-diffuse-foreground"><span> </span> <span> </span></div> <div class="relative p-2"><!></div></div> <div class="space-y-1"><h2 class="text-md">Height</h2> <div class="flex justify-between text-sm text-diffuse-foreground"><span> </span> <span> </span></div> <div class="relative p-2"><!></div></div> <!></div>');function Ua(l,t){Oe(t,!0);const[a,i]=Ge(),c=()=>O(_t,"$page",a),d=()=>O(k,"$values",a),v=()=>O(m,"$metadataValues",a),y=()=>O(x,"$metadataBounds",a),B=()=>O(A,"$bounds",a),E=c().params.dataset_id,{dimensionsBounds:A,dimensionsValues:k,updateDimensionsValues:I}=Wt(),C=P=>{I({min_width:P[0],max_width:P[1],min_height:d().min_height,max_height:d().max_height})},S=P=>{I({min_width:d().min_width,max_width:d().max_width,min_height:P[0],max_height:P[1]})},{metadataBounds:x,metadataValues:m,updateMetadataValues:h}=Da(E),V=P=>H=>{const Q={...v()};Q[P]={min:H[0],max:H[1]},h(Q)},Z=_(()=>Object.keys(y()).filter(P=>{const H=y()[P];return H&&typeof H.min=="number"&&typeof H.max=="number"})),N=(P,H)=>{const Q=y()[H];return Q&&Number.isInteger(Q.min)&&Number.isInteger(Q.max)?Qe(P):Oa(P)};$t(l,{title:"Metadata FIlters",children:(P,H)=>{var Q=Ya(),ye=o(Q),T=r(o(ye),2),me=o(T),Ie=o(me);n(me);var Ee=r(me,2),Pe=o(Ee);n(Ee),n(T);var X=r(T,2),we=o(X);const ee=_(()=>[d().min_width,d().max_width]);pt(we,{type:"multiple",class:"filter-width",get min(){return B().min_width},get max(){return B().max_width},get value(){return e(ee)},onValueCommit:C}),n(X),n(ye);var ne=r(ye,2),ge=r(o(ne),2),he=o(ge),Ce=o(he);n(he);var ke=r(he,2),De=o(ke);n(ke),n(ge);var f=r(ge,2),u=o(f);const p=_(()=>[d().min_height,d().max_height]);pt(u,{type:"multiple",class:"filter-height",get min(){return B().min_height},get max(){return B().max_height},get value(){return e(p)},onValueCommit:S}),n(f),n(ne);var ue=r(ne,2);{var L=K=>{var z=U(),$e=w(z);We($e,17,()=>e(Z),nt,(Se,D)=>{var q=Qa();const oe=_(()=>y()[e(D)]),te=_(()=>v()[e(D)]),ie=_(()=>Number.isInteger(e(oe).min)&&Number.isInteger(e(oe).max));var Te=o(q),b=o(Te,!0);n(Te);var j=r(Te,2),$=o(j),W=o($,!0);n($);var F=r($,2),R=o(F,!0);n(F),n(j);var le=r(j,2),G=o(le);const de=_(()=>e(ie)?1:.01),Ae=_(()=>[e(te).min,e(te).max]),pe=_(()=>V(e(D)));pt(G,{type:"multiple",get class(){return`filter-${e(D)??""}`},get min(){return e(oe).min},get max(){return e(oe).max},get step(){return e(de)},get value(){return e(Ae)},get onValueCommit(){return e(pe)}}),n(le),n(q),ce((_e,xe,Y)=>{J(b,_e),J(W,xe),J(R,Y)},[()=>e(D).replace(/_/g," "),()=>N(e(te).min,e(D)),()=>N(e(te).max,e(D))]),s(Se,q)}),s(K,z)};re(ue,K=>{e(Z).length>0&&K(L)})}n(Q),ce((K,z,$e,Se)=>{J(Ie,`${K??""}px`),J(Pe,`${z??""}px`),J(Ce,`${$e??""}px`),J(De,`${Se??""}px`)},[()=>Qe(d().min_width),()=>Qe(d().max_width),()=>Qe(d().min_height),()=>Qe(d().max_height)]),s(P,Q)},$$slots:{default:!0}}),Ne(),i()}function Za(l,t){Oe(t,!0);let a=at(t,["$$slots","$$events","$$legacy"]);ct(l,dt({name:"eraser"},()=>a,{iconNode:[["path",{d:"m7 21-4.3-4.3c-1-1-1-2.5 0-3.4l9.6-9.6c1-1 2.5-1 3.4 0l5.6 5.6c1 1 1 2.5 0 3.4L13 21"}],["path",{d:"M22 21H7"}],["path",{d:"m5 11 9 9"}]],children:(c,d)=>{var v=U(),y=w(v);Ue(y,()=>t.children??lt),s(c,v)},$$slots:{default:!0}})),Ne()}function Xa(l,t){Oe(t,!0);let a=at(t,["$$slots","$$events","$$legacy"]);ct(l,dt({name:"grid-3x3"},()=>a,{iconNode:[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2"}],["path",{d:"M3 9h18"}],["path",{d:"M3 15h18"}],["path",{d:"M9 3v18"}],["path",{d:"M15 3v18"}]],children:(c,d)=>{var v=U(),y=w(v);Ue(y,()=>t.children??lt),s(c,v)},$$slots:{default:!0}})),Ne()}function es(l,t){Oe(t,!0);let a=at(t,["$$slots","$$events","$$legacy"]);ct(l,dt({name:"plus"},()=>a,{iconNode:[["path",{d:"M5 12h14"}],["path",{d:"M12 5v14"}]],children:(c,d)=>{var v=U(),y=w(v);Ue(y,()=>t.children??lt),s(c,v)},$$slots:{default:!0}})),Ne()}function ts(l,t){Oe(t,!0);let a=at(t,["$$slots","$$events","$$legacy"]);ct(l,dt({name:"sliders-horizontal"},()=>a,{iconNode:[["line",{x1:"21",x2:"14",y1:"4",y2:"4"}],["line",{x1:"10",x2:"3",y1:"4",y2:"4"}],["line",{x1:"21",x2:"12",y1:"12",y2:"12"}],["line",{x1:"8",x2:"3",y1:"12",y2:"12"}],["line",{x1:"21",x2:"16",y1:"20",y2:"20"}],["line",{x1:"12",x2:"3",y1:"20",y2:"20"}],["line",{x1:"14",x2:"14",y1:"2",y2:"6"}],["line",{x1:"8",x2:"8",y1:"10",y2:"14"}],["line",{x1:"16",x2:"16",y1:"18",y2:"22"}]],children:(c,d)=>{var v=U(),y=w(v);Ue(y,()=>t.children??lt),s(c,v)},$$slots:{default:!0}})),Ne()}const as=async l=>{const t={data:{},error:void 0};try{const a=await vt.POST("/api/metrics/compute/detection/map",{body:l});if(a.error)throw new Error(JSON.stringify(a.error,null,2));if(!a.data)throw new Error("No data returned from metrics calculation");t.data=a.data}catch(a){t.error="Error computing metrics: "+String(a)}return t};var ss=g("<!> <!>",1),rs=g("<!> <!>",1),ns=g("<!> <!>",1),os=g("<!> <!>",1),is=g('<div class="rounded-md bg-destructive/15 p-3 text-sm text-destructive"> </div>'),ls=g('<span class="mr-2 animate-spin">⟳</span>'),ds=g("<!> Compute",1),cs=g('<div class="space-y-6"><!> <!> <!> <!> <div class="flex space-x-2"><!> <!></div></div>'),us=g('<div class="flex justify-between"><span class="truncate"> </span> <span class="font-medium"> </span></div>'),vs=g('<div class="rounded-lg bg-muted p-4"><h4 class="text-md mb-2 font-medium">mAP by Class</h4> <div class="max-h-60 space-y-1 overflow-y-auto text-sm"></div></div>'),fs=g('<div class="space-y-4"><div class="rounded-lg bg-muted p-4"><h4 class="text-md mb-2 font-medium">mAP Results</h4> <div class="space-y-2 text-sm"><div class="flex justify-between"><span>mAP:</span> <span class="font-medium"> </span></div> <div class="flex justify-between"><span>mAP@50:</span> <span class="font-medium"> </span></div> <div class="flex justify-between"><span>mAP@75:</span> <span class="font-medium"> </span></div></div></div> <!> <!></div>'),ms=g('<div class="flex w-80 flex-col rounded-[1vw] bg-card p-4"><div class="mb-5 mt-2 text-lg font-semibold">Metrics</div> <!> <div class="flex-1 space-y-6"><!></div></div>'),ps=g('<div class="hidden"></div>');function _s(l,t){Oe(t,!0);const[a,i]=Ge(),c=()=>O(I,"$isMetricsPanelOpen",a),d=()=>O(k,"$hasEnoughTasksForMetrics",a),v=()=>O(A,"$annotationTasks",a),y=()=>O(E,"$tags",a);let B=Je.params.dataset_id;const{tags:E}=At({dataset_id:B}),{annotationTasks:A,hasEnoughTasksForMetrics:k}=la(),{isMetricsPanelOpen:I}=Ra();let C=Be(""),S=Be(""),x=Be(""),m=Be(null),h=Be(!1),V=Be("");async function Z(){if(!e(C)||!e(S)){M(V,"Please select both ground truth and prediction tasks");return}M(h,!0),M(V,"");try{const T=await as({dataset_id:B,ground_truth_task_id:e(C),prediction_task_id:e(S),tag_id:e(x)||null});T.error?M(V,je(T.error)):M(m,je(T.data))}catch(T){M(V,je(String(T)))}finally{M(h,!1)}}function N(){M(C,""),M(S,""),M(x,""),M(m,null),M(V,"")}var P=U(),H=w(P);{var Q=T=>{var me=ms(),Ie=r(o(me),2);ut(Ie,{class:"mb-4 bg-border-hard"});var Ee=r(Ie,2),Pe=o(Ee);{var X=ee=>{var ne=cs(),ge=o(ne);wt(ge,{label:"Ground Truth Task",children:(L,K)=>{var z=U(),$e=w(z);ve($e,()=>Tt,(Se,D)=>{D(Se,{type:"single",name:"groundTruthTaskId",get value(){return e(C)},set value(q){M(C,je(q))},children:(q,oe)=>{var te=ss(),ie=w(te);ve(ie,()=>Ct,(b,j)=>{j(b,{class:"w-full",children:($,W)=>{ae();var F=fe();ce(R=>J(F,R),[()=>{var R;return((R=v().find(le=>le.annotation_task_id===e(C)))==null?void 0:R.name)||"Select ground truth task"}]),s($,F)},$$slots:{default:!0}})});var Te=r(ie,2);ve(Te,()=>St,(b,j)=>{j(b,{children:($,W)=>{var F=U(),R=w(F);ve(R,()=>Pt,(le,G)=>{G(le,{children:(de,Ae)=>{var pe=U(),_e=w(pe);We(_e,1,()=>v().filter(xe=>!xe.is_prediction),nt,(xe,Y)=>{var se=U(),be=w(se);{var ze=Fe=>{var Le=U(),Ve=w(Le);ve(Ve,()=>kt,(ft,Ze)=>{Ze(ft,{get value(){return e(Y).annotation_task_id},get label(){return e(Y).name},children:(xt,Zt)=>{ae();var st=fe();ce(()=>J(st,e(Y).name)),s(xt,st)},$$slots:{default:!0}})}),s(Fe,Le)};re(be,Fe=>{e(Y).annotation_task_id&&Fe(ze)})}s(xe,se)}),s(de,pe)},$$slots:{default:!0}})}),s($,F)},$$slots:{default:!0}})}),s(q,te)},$$slots:{default:!0}})}),s(L,z)}});var he=r(ge,2);wt(he,{label:"Prediction Task",children:(L,K)=>{var z=U(),$e=w(z);ve($e,()=>Tt,(Se,D)=>{D(Se,{type:"single",name:"predictionTaskId",get value(){return e(S)},set value(q){M(S,je(q))},children:(q,oe)=>{var te=rs(),ie=w(te);ve(ie,()=>Ct,(b,j)=>{j(b,{class:"w-full",children:($,W)=>{ae();var F=fe();ce(R=>J(F,R),[()=>{var R;return((R=v().find(le=>le.annotation_task_id===e(S)))==null?void 0:R.name)||"Select prediction task"}]),s($,F)},$$slots:{default:!0}})});var Te=r(ie,2);ve(Te,()=>St,(b,j)=>{j(b,{children:($,W)=>{var F=U(),R=w(F);ve(R,()=>Pt,(le,G)=>{G(le,{children:(de,Ae)=>{var pe=U(),_e=w(pe);We(_e,1,()=>v().filter(xe=>xe.is_prediction),nt,(xe,Y)=>{var se=U(),be=w(se);{var ze=Fe=>{var Le=U(),Ve=w(Le);ve(Ve,()=>kt,(ft,Ze)=>{Ze(ft,{get value(){return e(Y).annotation_task_id},get label(){return e(Y).name},children:(xt,Zt)=>{ae();var st=fe();ce(()=>J(st,e(Y).name)),s(xt,st)},$$slots:{default:!0}})}),s(Fe,Le)};re(be,Fe=>{e(Y).annotation_task_id&&Fe(ze)})}s(xe,se)}),s(de,pe)},$$slots:{default:!0}})}),s($,F)},$$slots:{default:!0}})}),s(q,te)},$$slots:{default:!0}})}),s(L,z)}});var Ce=r(he,2);wt(Ce,{label:"Tag (Optional)",children:(L,K)=>{var z=U(),$e=w(z);ve($e,()=>Tt,(Se,D)=>{D(Se,{type:"single",name:"tagId",get value(){return e(x)},set value(q){M(x,je(q))},children:(q,oe)=>{var te=os(),ie=w(te);ve(ie,()=>Ct,(b,j)=>{j(b,{class:"w-full",children:($,W)=>{ae();var F=fe();ce(R=>J(F,R),[()=>{var R;return((R=y().find(le=>le.tag_id===e(x)))==null?void 0:R.name)||"Select tag (optional)"}]),s($,F)},$$slots:{default:!0}})});var Te=r(ie,2);ve(Te,()=>St,(b,j)=>{j(b,{children:($,W)=>{var F=U(),R=w(F);ve(R,()=>Pt,(le,G)=>{G(le,{children:(de,Ae)=>{var pe=ns(),_e=w(pe);ve(_e,()=>da,(Y,se)=>{se(Y,{children:(be,ze)=>{ae();var Fe=fe("Sample tags");s(be,Fe)},$$slots:{default:!0}})});var xe=r(_e,2);We(xe,1,()=>y().filter(Y=>Y.kind==="sample"),nt,(Y,se)=>{var be=U(),ze=w(be);ve(ze,()=>kt,(Fe,Le)=>{Le(Fe,{get value(){return e(se).tag_id},get label(){return e(se).name},children:(Ve,ft)=>{ae();var Ze=fe();ce(()=>J(Ze,e(se).name)),s(Ve,Ze)},$$slots:{default:!0}})}),s(Y,be)}),s(de,pe)},$$slots:{default:!0}})}),s($,F)},$$slots:{default:!0}})}),s(q,te)},$$slots:{default:!0}})}),s(L,z)}});var ke=r(Ce,2);{var De=L=>{var K=is(),z=o(K,!0);n(K),ce(()=>J(z,e(V))),s(L,K)};re(ke,L=>{e(V)&&L(De)})}var f=r(ke,2),u=o(f);Re(u,{variant:"outline",class:"flex-1",onclick:N,get disabled(){return e(h)},children:(L,K)=>{ae();var z=fe("Reset");s(L,z)},$$slots:{default:!0}});var p=r(u,2);const ue=_(()=>!e(C)||!e(S)||e(h));Re(p,{variant:"default",class:"flex-1",onclick:Z,get disabled(){return e(ue)},children:(L,K)=>{var z=ds(),$e=w(z);{var Se=D=>{var q=ls();s(D,q)};re($e,D=>{e(h)&&D(Se)})}ae(),s(L,z)},$$slots:{default:!0}}),n(f),n(ne),s(ee,ne)},we=ee=>{var ne=fs(),ge=o(ne),he=r(o(ge),2),Ce=o(he),ke=r(o(Ce),2),De=o(ke);n(ke),n(Ce);var f=r(Ce,2),u=r(o(f),2),p=o(u);n(u),n(f);var ue=r(f,2),L=r(o(ue),2),K=o(L);n(L),n(ue),n(he),n(ge);var z=r(ge,2);{var $e=D=>{var q=vs(),oe=r(o(q),2);We(oe,21,()=>Object.entries(e(m).map_per_class).sort(([te],[ie])=>te<ie?-1:te>ie?1:0),nt,(te,ie)=>{let Te=()=>e(ie)[0],b=()=>e(ie)[1];var j=us(),$=o(j),W=o($);n($);var F=r($,2),R=o(F);n(F),n(j),ce(le=>{J(W,`${Te()??""}:`),J(R,`${le??""}%`)},[()=>(b()*100).toFixed(2)]),s(te,j)}),n(oe),n(q),s(D,q)};re(z,D=>{e(m).map_per_class&&D($e)})}var Se=r(z,2);Re(Se,{variant:"outline",class:"mt-4 w-full",onclick:()=>M(m,null),children:(D,q)=>{ae();var oe=fe("Back to Form");s(D,oe)},$$slots:{default:!0}}),n(ne),ce((D,q,oe)=>{J(De,`${D??""}%`),J(p,`${q??""}%`),J(K,`${oe??""}%`)},[()=>(e(m).map*100).toFixed(2),()=>(e(m).map_50*100).toFixed(2),()=>(e(m).map_75*100).toFixed(2)]),s(ee,ne)};re(Pe,ee=>{e(m)?ee(we,!1):ee(X)})}n(Ee),n(me),s(T,me)},ye=T=>{var me=ps();s(T,me)};re(H,T=>{c()&&d()?T(Q):T(ye,!1)})}s(l,P),Ne(),i()}var gs=g("<input>"),hs=g("<input>");function Ft(l,t){Oe(t,!0);let a=et(t,"ref",15,null),i=et(t,"value",15),c=et(t,"files",15),d=at(t,["$$slots","$$events","$$legacy","ref","value","type","files","class"]);var v=U(),y=w(v);{var B=A=>{var k=gs();zt(k);let I;Lt(k,C=>a(C),()=>a()),ce(C=>I=jt(k,I,{class:C,type:"file",...d}),[()=>ot("border-input bg-background ring-offset-background placeholder:text-muted-foreground focus-visible:ring-ring flex h-10 w-full rounded-md border px-3 py-2 text-base file:border-0 file:bg-transparent file:text-sm file:font-medium focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t.class)]),ca(k,c),Rt(k,i),s(A,k)},E=A=>{var k=hs();zt(k);let I;Lt(k,C=>a(C),()=>a()),ce(C=>I=jt(k,I,{class:C,type:t.type,...d}),[()=>ot("border-input bg-background ring-offset-background placeholder:text-muted-foreground focus-visible:ring-ring flex h-10 w-full rounded-md border px-3 py-2 text-base file:border-0 file:bg-transparent file:text-sm file:font-medium focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t.class)]),Rt(k,i),s(A,k)};re(y,A=>{t.type==="file"?A(B):A(E,!1)})}s(l,v),Ne()}var $s=g('<div class="flex w-80 flex-col rounded-[1vw] bg-card p-4"><div class="mb-5 mt-2 flex items-center justify-between"><div class="text-lg font-semibold">Create Classifier</div> <!></div> <!> <div class="flex-1 space-y-6"><!> <div class="space-y-2"><label for="classifier-name" class="text-sm font-medium">Classifier Name</label> <!></div> <!></div></div>'),xs=g('<div class="hidden"></div>');function bs(l,t){Oe(t,!1);const[a,i]=Ge(),c=()=>O(v,"$isCreateClassifiersPanelOpen",a),d=()=>O(B,"$error",a),{isCreateClassifiersPanelOpen:v,closeCreateClassifiersPanel:y}=ua(),{error:B,createClassifier:E}=Vt(),{clearClassifierSamples:A}=it();let k=oa(""),I=Je.params.dataset_id;function C(){A(),M(k,""),y(),Ye(He.toSamples(I))}Qt();var S=U(),x=w(S);{var m=V=>{var Z=$s(),N=o(Z),P=r(o(N),2);Re(P,{variant:"ghost",size:"icon",onclick:C,class:"h-8 w-8",children:(X,we)=>{ae();var ee=fe("✕");s(X,ee)},$$slots:{default:!0}}),n(N);var H=r(N,2);ut(H,{class:"mb-4 bg-border-hard"});var Q=r(H,2),ye=o(Q);{var T=X=>{Et(X,{title:"Error occured",children:(we,ee)=>{ae();var ne=fe();ce(()=>J(ne,d())),s(we,ne)}})};re(ye,X=>{d()&&X(T)})}var me=r(ye,2),Ie=r(o(me),2);Ft(Ie,{id:"classifier-name",type:"text",placeholder:"Enter classifier name",get value(){return e(k)},set value(X){M(k,X)},$$legacy:!0}),n(me);var Ee=r(me,2);const Pe=ia(()=>!e(k).trim());Re(Ee,{variant:"default",class:"w-full",onclick:()=>E({name:e(k),class_list:["positive","negative"],dataset_id:I}),get disabled(){return e(Pe)},children:(X,we)=>{ae();var ee=fe("Create Classifier");s(X,ee)},$$slots:{default:!0}}),n(Q),n(Z),s(V,Z)},h=V=>{var Z=xs();s(V,Z)};re(x,V=>{c()?V(m):V(h,!1)})}s(l,S),Ne(),i()}var ys=g('<div class="w-300 flex space-x-4 text-diffuse-foreground"><!> <!> <!></div>');function ws(l,t){Oe(t,!0);const[a,i]=Ge(),c=()=>O(y,"$sampleSize",a),d=et(t,"min",3,100),v=et(t,"max",3,1500),{sampleSize:y,updateSampleSize:B}=it(),E=_(()=>c().width),A=va.throttle(m=>{B(m[0])},100);var k=ys(),I=o(k);Xa(I,{class:"h-6 w-6"});var C=r(I,2);const S=_(()=>[e(E)]);pt(C,{class:"w-full flex-1",get value(){return e(S)},get min(){return d()},get max(){return v()},step:1,onValueChange:A});var x=r(C,2);Ut(x,{class:"h-6 w-6"}),n(k),s(l,k),Ne(),i()}var Cs=g('<div class="h-3 w-3 cursor-pointer rounded-sm border"></div>'),Ss=g('<div class="color-picker-container"><!></div> <p class="flex-1 truncate text-base font-normal" data-testid="label-menu-label-name"> </p> <span class="text-sm text-diffuse-foreground" data-testid="label-menu-label-count"> </span>',1),Ps=g('<div class="width-full flex items-center space-x-2"><!> <!></div>'),ks=g('<div class="width-full space-y-2 overflow-hidden"></div>');function Ts(l,t){Oe(t,!0);const[a,i]=Ge(),c=()=>O(A,"$customLabelColorsStore",a),d=()=>O(v(),"$annotationFilters",a);let v=et(t,"annotationFilters",19,()=>[]);const{setCustomColor:y,getCustomColor:B,hasCustomColor:E,customLabelColorsStore:A}=ga();function k(x,m,h){y(x,m,h)}function I(x){if(E(x)){const h=B(x);return(h==null?void 0:h.color)||"#ff0000"}const m=mt(x,1).color;try{const h=m.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)/);if(h){const V=parseInt(h[1]),Z=parseInt(h[2]),N=parseInt(h[3]);return`#${((1<<24)+(V<<16)+(Z<<8)+N).toString(16).slice(1)}`}}catch(h){console.error("Error converting rgba to hex",h)}return"#ff0000"}function C(x){if(E(x)){const m=B(x);return(m==null?void 0:m.alpha)||1}return .4}const S=_(()=>{const x=c(),m={};for(const h of Object.keys(x)){const V=x[h];m[h]={borderColor:V.color,backgroundColor:mt(h,.4).color}}return m});$t(l,{title:"Labels",children:(x,m)=>{var h=ks();We(h,5,d,({label_name:V,current_count:Z,total_count:N,selected:P})=>V,(V,Z)=>{let N=()=>e(Z).label_name,P=()=>e(Z).current_count,H=()=>e(Z).total_count,Q=()=>e(Z).selected;var ye=Ps(),T=o(ye);const me=_(()=>`${N()}-label`);fa(T,{get id(){return N()},get checked(){return Q()},get"aria-labelledby"(){return e(me)},onCheckedChange:()=>t.onToggleAnnotationFilter(N())});var Ie=r(T,2);const Ee=_(()=>`${N()}-label`);Ht(Ie,{get id(){return e(Ee)},get for(){return N()},"data-testid":"labels-menu-item",class:"flex min-w-0 flex-1 cursor-pointer items-center space-x-2 text-nowrap peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:(Pe,X)=>{var we=Ss(),ee=w(we),ne=o(ee);const ge=_(()=>I(N())),he=_(()=>C(N()));ma(ne,{get initialColor(){return e(ge)},get initialAlpha(){return e(he)},onChange:(u,p)=>k(N(),u,p),children:(u,p)=>{var ue=Cs();ce(L=>pa(ue,L),[()=>{var L,K;return`
                                    border-color: ${((L=e(S)[N()])==null?void 0:L.borderColor)??mt(N()).color};
                                    background-color: ${((K=e(S)[N()])==null?void 0:K.backgroundColor)??mt(N(),Q()?1:.4).color};
                                `}]),s(u,ue)},$$slots:{default:!0}}),n(ee);var Ce=r(ee,2),ke=o(Ce,!0);n(Ce);var De=r(Ce,2),f=o(De);n(De),ce((u,p)=>{J(ke,N()),J(f,`${u??""} of ${p??""}`)},[()=>Qe(P()),()=>Qe(H())]),s(Pe,we)},$$slots:{default:!0}}),n(ye),ce(()=>_a(ye,"title",N())),s(V,ye)}),n(h),s(x,h)},$$slots:{default:!0}}),Ne(),i()}const Is=async({dataset_id:l,tag_id:t,annotationIdsBody:a})=>{const i={data:void 0,error:void 0};try{const c=await vt.POST("/api/datasets/{dataset_id}/tags/{tag_id}/add/annotations",{params:{path:{dataset_id:l,tag_id:t}},body:a});if(c.error)throw new Error(JSON.stringify(c.error,null,2));if(!c.data)throw new Error("No data");i.data=c.data}catch(c){i.error="Error assigning annotationIds to a tag: "+String(c)}return i},Es=l=>["/api/datasets/{dataset_id}/tags",l],As=async({dataset_id:l,tag_id:t,sampleIdsBody:a})=>{const i={data:void 0,error:void 0};try{const c=await vt.POST("/api/datasets/{dataset_id}/tags/{tag_id}/add/samples",{params:{path:{dataset_id:l,tag_id:t}},body:a});if(c.error)throw new Error(JSON.stringify(c.error,null,2));if(!c.data)throw new Error("No data");i.data=c.data}catch(c){i.error="Error assigning sampleIds to tag: "+String(c)}return i},Fs=async({dataset_id:l,tagInputBody:t})=>{const a={data:void 0,error:void 0};try{const i=await vt.POST("/api/datasets/{dataset_id}/tags",{params:{path:{dataset_id:l}},body:t});if(i.error)throw new Error(JSON.stringify(i.error,null,2));if(!i.data)throw new Error("No data");a.data=i.data}catch(i){a.error="Error creating tag: "+String(i)}return a};var Ms=g("<!> Create new Tags",1),Os=g("<!> <!>",1),Ns=g('<div class="flex space-x-2 py-1"><!></div>'),Ds=g('<!> <!> <div class="grid gap-4"><!></div> <div><!> <!></div> <!>',1),Ls=g('<div class="flex space-x-1"><!> <!></div> <!>',1);function zs(l,t){Oe(t,!0);const[a,i]=Ge(),c=()=>O(C,"$selectedSampleIds",a),d=()=>O(S,"$selectedSampleAnnotationCropIds",a),v=()=>O(e(k),"$tags",a),y=()=>O(e(V),"$itemsSelected",a),B=()=>O(X,"$submitTagAndMutate",a);let E=_(()=>t.gridType==="samples"?"sample":"annotation");const A=_(()=>At({dataset_id:t.datasetId,kind:[e(E)]})),k=_(()=>e(A).tags),I=_(()=>e(A).loadTags),{selectedSampleIds:C,selectedSampleAnnotationCropIds:S,clearSelectedSampleAnnotationCrops:x,clearSelectedSamples:m}=it(),h=_(()=>t.gridType==="samples"?m:x),V=_(()=>t.gridType==="samples"?C:S);let Z=Be(!1);const N=_(()=>c().size>0&&t.gridType==="samples"||d().size>0&&t.gridType==="annotations");let P=Be(""),H=Be(je([])),Q=()=>{e(H).push(e(P)),T.add(e(P)),M(P,"")};const ye=_(()=>[...e(H).map(u=>({tag_id:u,name:u,kind:e(E)})),...v()].filter(u=>u.name.includes(e(P))));let T=je(new It);const me=u=>{T.has(u)?(T.delete(u),e(H).splice(e(H).indexOf(u),1)):T.add(u)};let Ie=Be(null);const Ee=async()=>{await Promise.all([...e(H)].map(async u=>{var ue;const p=await Fs({dataset_id:t.datasetId,tagInputBody:{name:u,description:`${u} description`,kind:e(E)}});if(p.error)throw p.error;return(ue=p.data)!=null&&ue.tag_id&&(T.delete(u),T.add(p.data.tag_id)),p})),await Promise.all([...T].map(async u=>{const p=e(E)==="sample"?await As({dataset_id:t.datasetId,tag_id:u,sampleIdsBody:{sample_ids:[...y()]}}):await Is({dataset_id:t.datasetId,tag_id:u,annotationIdsBody:{annotation_ids:[...y()]}});if(p.error)throw p.error;return p}))},Pe=La(),X=ha({mutationFn:async()=>{await Ee()},onError:u=>{M(Ie,je(u))},onSuccess:()=>{Pe.invalidateQueries({queryKey:Es({dataset_id:t.datasetId})}),e(I)(),e(h)(),we(!1)}}),we=u=>{M(Z,je(u)),M(Ie,null),M(P,""),M(H,je([])),T.clear()},ee=_(()=>T.size>0||e(H).length>0);var ne=Ls(),ge=w(ne),he=o(ge);const Ce=_(()=>!e(N));Re(he,{variant:"outline",get disabled(){return e(Ce)},class:"flex-1",onclick:()=>M(Z,!0),"data-testid":"tag-create-dialog-button",children:(u,p)=>{var ue=Ms(),L=w(ue);es(L,{}),ae(),s(u,ue)},$$slots:{default:!0}});var ke=r(he,2);const De=_(()=>!e(N));Re(ke,{variant:"outline",get disabled(){return e(De)},size:"icon",title:"Clear selection",get onclick(){return e(h)},children:(u,p)=>{Za(u,{})},$$slots:{default:!0}}),n(ge);var f=r(ge,2);ve(f,()=>Ca,(u,p)=>{p(u,{onOpenChange:we,get open(){return e(Z)},children:(ue,L)=>{var K=U(),z=w(K);ve(z,()=>$a,($e,Se)=>{Se($e,{class:"sm:max-w-[425px]",children:(D,q)=>{var oe=Ds(),te=w(oe);ve(te,()=>xa,(G,de)=>{de(G,{children:(Ae,pe)=>{var _e=Os(),xe=w(_e);ve(xe,()=>ba,(se,be)=>{be(se,{children:(ze,Fe)=>{ae();var Le=fe();ce(()=>J(Le,`Add the selected ${e(E)??""} to a tag`)),s(ze,Le)},$$slots:{default:!0}})});var Y=r(xe,2);ve(Y,()=>ya,(se,be)=>{be(se,{children:(ze,Fe)=>{ae();var Le=fe();ce(()=>J(Le,`Add the selected ${y().size??""}
                ${e(E)??""} to an new or existing tag. Tags can later be exported.`)),s(ze,Le)},$$slots:{default:!0}})}),s(Ae,_e)},$$slots:{default:!0}})});var ie=r(te,2);{var Te=G=>{Et(G,{title:"Error occured",children:(de,Ae)=>{ae();var pe=fe();ce(()=>J(pe,e(Ie))),s(de,pe)}})};re(ie,G=>{e(Ie)&&G(Te)})}var b=r(ie,2),j=o(b);Ft(j,{type:"text",placeholder:"Create or search tags",autofocus:!0,"data-testid":"tag-create-dialog-input",get value(){return e(P)},set value(G){M(P,je(G))}}),n(b);var $=r(b,2),W=o($);We(W,17,()=>e(ye),G=>G.tag_id,(G,de)=>{var Ae=Ns(),pe=o(Ae);const _e=_(()=>`tagCreateDialog-tag-${e(de).tag_id}`),xe=_(()=>T.has(e(de).tag_id));Gt(pe,{get name(){return e(_e)},get isChecked(){return e(xe)},get label(){return e(de).name},onCheckedChange:()=>me(e(de).tag_id)}),n(Ae),s(G,Ae)});var F=r(W,2);{var R=G=>{const de=_(()=>ot("",...Sa({variant:"outline"})));Re(G,{type:"button",variant:"outline",get class(){return e(de)},onclick:Q,"data-testid":"tag-create-dialog-create",children:(Ae,pe)=>{ae();var _e=fe();ce(()=>J(_e,`Create tag "${e(P)??""}"`)),s(Ae,_e)},$$slots:{default:!0}})};re(F,G=>{e(P)&&G(R)})}n($);var le=r($,2);ve(le,()=>wa,(G,de)=>{de(G,{children:(Ae,pe)=>{var _e=U(),xe=w(_e);{var Y=se=>{Re(se,{type:"submit",onclick:()=>B().mutate(),"data-testid":"tag-create-dialog-save",children:(be,ze)=>{ae();var Fe=fe("Save changes");s(be,Fe)},$$slots:{default:!0}})};re(xe,se=>{e(ee)&&se(Y)})}s(Ae,_e)},$$slots:{default:!0}})}),s(D,oe)},$$slots:{default:!0}})}),s(ue,K)},$$slots:{default:!0}})}),s(l,ne),Ne(),i()}var js=g('<div class="flex items-center space-x-2 py-1" data-testid="tag-menu-item"><!></div>'),Rs=g("<p>No tag, create a tag</p>"),Bs=g('<div class="mb-3 w-full space-y-2"></div>');function qs(l,t){Oe(t,!0);const[a,i]=Ge(),c=()=>O(e(y),"$tags",a),d=()=>O(e(B),"$tagsSelected",a),v=_(()=>At({dataset_id:t.dataset_id,kind:[t.gridType==="annotations"?"annotation":"sample"]})),y=_(()=>e(v).tags),B=_(()=>e(v).tagsSelected),E=_(()=>e(v).tagSelectionToggle);$t(l,{title:"Tags",icon:qa,children:(A,k)=>{var I=Bs();We(I,5,c,C=>C.tag_id,(C,S)=>{var x=js(),m=o(x);const h=_(()=>d().has(e(S).tag_id));Gt(m,{get name(){return e(S).tag_id},get isChecked(){return e(h)},get label(){return e(S).name},onCheckedChange:()=>e(E)(e(S).tag_id)}),n(x),s(C,x)},C=>{var S=Rs();s(C,S)}),n(I),s(A,I)}}),Ne(),i()}var Vs=g(`<li>Once satisfied with the results, click "Commit Temporary Classifier"
                                to save permanently</li>`),Hs=g('<div class="flex w-80 flex-col rounded-[1vw] bg-card p-4"><div class="mb-5 mt-2 flex items-center justify-between"><div class="text-lg font-semibold"> </div> <!></div> <!> <div class="flex-1 space-y-6"><div class="space-y-4"><div><h3 class="mb-2 text-lg font-semibold">Refinement Instructions</h3> <p class="mb-4 text-sm text-muted-foreground">You are refining classifier: <span class="font-medium"> </span></p> <ol class="list-inside list-decimal space-y-2 text-sm text-muted-foreground"><li>Select positive examples from the samples</li> <li>Click "Refine Classifier" to retrain with your selections</li> <!></ol></div></div> <div class="space-y-4"><!> <!> <div class="flex items-center justify-between gap-4"><!> <!></div> <!></div></div></div>'),Gs=g('<div class="hidden"></div>');function Js(l,t){Oe(t,!1);const[a,i]=Ge(),c=()=>O(C,"$isRefineClassifiersPanelOpen",a),d=()=>O(x,"$currentMode",a),v=()=>O(h,"$currentClassifierName",a),y=()=>O(Z,"$error",a),B=()=>O(m,"$currentClassifierId",a),E=()=>O(V,"$currentClassifierClasses",a),A=()=>O(I,"$showTrainingSamplesToggle",a),{clearSelectedSamples:k}=it(),I=Xt("refine_classifier_show_training_samples",!1),{isRefineClassifiersPanelOpen:C,closeRefineClassifiersPanel:S,currentMode:x,currentClassifierId:m,currentClassifierName:h,currentClassifierClasses:V}=Pa(),{error:Z,commitTempClassifier:N,refineClassifier:P,showClassifierTrainingSamples:H}=Vt();let Q=Je.params.dataset_id;function ye(){k(),I.set(!1),S(),Ye(He.toSamples(Q))}Qt();var T=U(),me=w(T);{var Ie=Pe=>{var X=Hs(),we=o(X),ee=o(we),ne=o(ee,!0);n(ee);var ge=r(ee,2);Re(ge,{variant:"ghost",size:"icon",onclick:ye,class:"h-8 w-8",children:(b,j)=>{ae();var $=fe("✕");s(b,$)},$$slots:{default:!0}}),n(we);var he=r(we,2);ut(he,{class:"mb-4 bg-border-hard"});var Ce=r(he,2),ke=o(Ce),De=o(ke),f=r(o(De),2),u=r(o(f)),p=o(u,!0);n(u),n(f);var ue=r(f,2),L=r(o(ue),4);{var K=b=>{var j=Vs();s(b,j)};re(L,b=>{d()==="temp"&&b(K)})}n(ue),n(De),n(ke);var z=r(ke,2),$e=o(z);{var Se=b=>{Et(b,{title:"Error occured",children:(j,$)=>{ae();var W=fe();ce(()=>J(W,y())),s(j,W)}})};re($e,b=>{y()&&b(Se)})}var D=r($e,2);Re(D,{variant:"default",class:"w-full",onclick:()=>{I.set(!1),P(B()||"",Q,E()||[])},children:(b,j)=>{ae();var $=fe("Refine Classifier");s(b,$)},$$slots:{default:!0}});var q=r(D,2),oe=o(q);Ht(oe,{class:"text-foreground",children:(b,j)=>{ae();var $=fe("Show All Training Samples");s(b,$)},$$slots:{default:!0}});var te=r(oe,2);ka(te,{class:"",get checked(){return A()},onCheckedChange:b=>{I.set(b),H(B()||"",Q,E()||[],b)}}),n(q);var ie=r(q,2);{var Te=b=>{Re(b,{variant:"outline",class:"w-full",onclick:()=>{I.set(!1),N(B()||"",Q)},children:(j,$)=>{ae();var W=fe("Commit Temporary Classifier");s(j,W)},$$slots:{default:!0}})};re(ie,b=>{d()==="temp"&&b(Te)})}n(z),n(Ce),n(X),ce(()=>{J(ne,d()==="temp"?"Refine Temporary Classifier":"Refine Classifier"),J(p,v())}),s(Pe,X)},Ee=Pe=>{var X=Gs();s(Pe,X)};re(me,Pe=>{c()?Pe(Ie):Pe(Ee,!1)})}s(l,T),Ne(),i()}const Ks=async({params:{dataset_id:l}})=>{const{data:t,error:a}=await ea(l);if(a||!t)throw ra(307,He.toHome());const i=it(),c=qt(i.selectedAnnotationFilterIds,d=>Array.from(d));return{datasetId:l,dataset:t,globalStorage:i,selectedAnnotationFilterIds:c,sampleSize:i.sampleSize}},Fr=Object.freeze(Object.defineProperty({__proto__:null,load:Ks},Symbol.toStringTag,{value:"Module"})),Ws=l=>{const{settingsStore:t}=Ta(),a=new Set,i=d=>{if(d.target instanceof HTMLInputElement||d.target instanceof HTMLTextAreaElement||d.target instanceof HTMLSelectElement)return;a.add(d.key);const v=Xe(_t).url.pathname,y={hideAnnotations:Xe(t).key_hide_annotations||"v",goBack:Xe(t).key_go_back||"Escape"};Object.entries(l).forEach(([B,E])=>{const A=y[B]||E.key;if(d.key===A){if(E.requiredPath){if(typeof E.requiredPath=="function"){if(!E.requiredPath(v))return}else if(!E.requiredPath.test(v))return}E.action(d)}})},c=d=>{a.delete(d.key)};return Jt(()=>{window.addEventListener("keydown",i),window.addEventListener("keyup",c)}),Kt(()=>{window.removeEventListener("keydown",i),window.removeEventListener("keyup",c)}),{isKeyPressed:d=>a.has(d)}},Qs={goBack:{key:"Escape",description:"Go back from detail view to grid view",isConfigurable:!0,requiredPath:l=>/\/datasets\/[^/]+\/(samples|annotations)\/[^/]+/.test(l)||/\/samples\/[^/]+/.test(l),action:()=>{const l=Xe(_t).url.pathname,t=Xe(_t).params.dataset_id;if(/\/samples\/[^/]+/.test(l)&&!t){Ye("/");return}t&&(l.includes("/samples/")?Ye(He.toSamples(t)):l.includes("/annotations/")&&Ye(He.toAnnotations(t)))}}},Ys=async({query_text:l="",model_id:t=""})=>{const a={data:[],error:void 0};try{const i=await vt.GET("/api/text_embedding/embed_text",{params:{query:{query_text:l,model_id:t}}});if(i.error)throw new Error(JSON.stringify(i.error,null,2));if(!i.data)throw new Error("No data");a.data=i.data}catch(i){a.error="Error creating text embedding: "+String(i)}return a},Us=({datasetId:l,options:t})=>{var a,i,c,d;return za(ja({path:{dataset_id:l},query:{...(t==null?void 0:t.filtered_labels)&&{filtered_labels:t.filtered_labels},...((a=t==null?void 0:t.dimensions)==null?void 0:a.min_width)&&{min_width:t.dimensions.min_width},...((i=t==null?void 0:t.dimensions)==null?void 0:i.max_width)&&{max_width:t.dimensions.max_width},...((c=t==null?void 0:t.dimensions)==null?void 0:c.min_height)&&{min_height:t.dimensions.min_height},...((d=t==null?void 0:t.dimensions)==null?void 0:d.max_height)&&{max_height:t.dimensions.max_height}}}))};var Zs=g("<div><!></div>"),Xs=g('<div class="space-y-2"><!> <!></div>'),er=g('<div class="flex w-80 flex-col space-y-6 rounded-[1vw] bg-card py-4"><div class="px-4"><!></div> <div class="min-h-0 flex-1 space-y-2 overflow-y-auto px-4 dark:[color-scheme:dark]"><div><!> <!></div> <!> <!></div></div>'),tr=g('<div class="relative"><!> <!></div>'),ar=g("<!> <!>",1),sr=g('<div class="flex h-full w-full space-x-4 px-4 pb-4"><!> <div class="flex1 flex flex-grow flex-col space-y-4 rounded-[1vw] bg-card p-4"><div class="my-2 flex items-center space-x-4"><div class="flex-1"><!></div> <div class="w-4/12"><!></div></div> <!> <div class="flex min-h-0 flex-1"><!></div></div> <!> <!></div>');function Mr(l,t){Oe(t,!0);const[a,i]=Ge(),c=()=>O(I,"$textEmbedding",a),d=()=>O(N,"$featureFlags",a),v=()=>O(X,"$annotationFilterLabels",a),y=()=>O(S,"$selectedAnnotationFilterIds",a),B=()=>O(me,"$dimensionsValues",a),E=()=>O(e(we),"$annotationCounts",a),{datasetId:A,globalStorage:{setTextEmbedding:k,textEmbedding:I,setLastGridType:C,selectedAnnotationFilterIds:S}}=t.data,{handleKeyEvent:x}=Ia();Jt(()=>{window.addEventListener("keydown",x),window.addEventListener("keyup",x)}),Kt(()=>{window.removeEventListener("keydown",x),window.removeEventListener("keyup",x)}),Ws({goBack:Qs.goBack});let m=Be("samples");Dt(()=>{Je.url.pathname===He.toAnnotations(A)?M(m,"annotations"):Je.url.pathname===He.toClassifiers(A)?M(m,"classifiers"):M(m,"samples"),C(e(m))});let h=Be(je(c()?c().queryText:""));async function V(){if(e(h).trim()!=="")try{return(await Ys({query_text:e(h),model_id:void 0})).data}catch(f){ge(f.message),console.error("Error during API call:",f)}}async function Z(f){if(f.key==="Enter"){const u=await V();k({queryText:e(h),embedding:u||[]})}}const{featureFlags:N}=Ba(),P=_(()=>d().some(f=>f==="embeddingSearchEnabled")),H=_(()=>d().some(f=>f==="fewShotClassifierEnabled")),Q=_(()=>ta(Je.route.id)),ye=_(()=>aa(Je.route.id)),T=_(()=>sa(Je.route.id)),{dimensionsValues:me}=Wt(A),Ie=Ea(),Ee=_(()=>{const f=v(),u=Array.from(y());return Object.entries(f).filter(([,p])=>u.includes(p)).map(([p])=>p)}),Pe=(f,u)=>f.map(p=>({...p,selected:u.includes(p.label_name)})),X=qt(Ie,f=>f.data?f.data.reduce((u,p)=>({...u,[p.annotation_label_name]:p.annotation_label_id}),{}):{}),we=_(()=>Us({datasetId:A,options:{filtered_labels:e(Ee).length>0?e(Ee):void 0,dimensions:B()}})),ee=na([]);Dt(()=>{const f=E().data;if(f){const u=Pe(f,e(Ee));ee.set(u)}});const ne=f=>{const u=Xe(X)[f];u&&S.update(p=>(p.has(u)?p.delete(u):p.add(u),p))},ge=f=>{Fa.error("Error",{description:f})};var he=U(),Ce=w(he);{var ke=f=>{var u=U(),p=w(u);Ue(p,()=>t.children),s(f,u)},De=f=>{var u=sr(),p=o(u);{var ue=$=>{var W=er(),F=o(W),R=o(F);Wa(R,{datasetId:A,get gridType(){return e(m)}}),n(F);var le=r(F,2),G=o(le),de=o(G);qs(de,{dataset_id:A,get gridType(){return e(m)}});var Ae=r(de,2);zs(Ae,{datasetId:A,get gridType(){return e(m)}}),n(G);var pe=r(G,2);{var _e=Y=>{var se=Zs(),be=o(se);Ma(be,{}),n(se),s(Y,se)};re(pe,Y=>{e(m)==="samples"&&e(P)&&e(H)&&Y(_e)})}var xe=r(pe,2);$t(xe,{title:"Filters",icon:ts,children:(Y,se)=>{var be=Xs(),ze=o(be);Ts(ze,{annotationFilters:ee,onToggleAnnotationFilter:ne});var Fe=r(ze,2);{var Le=Ve=>{Ua(Ve,{})};re(Fe,Ve=>{e(m)==="samples"&&Ve(Le)})}n(be),s(Y,be)}}),n(le),n(W),s($,W)};re(p,$=>{(e(m)==="samples"||e(m)==="annotations")&&$(ue)})}var L=r(p,2),K=o(L),z=o(K),$e=o(z);{var Se=$=>{var W=tr(),F=o(W);Aa(F,{class:"absolute left-2 top-[50%] h-4 w-4 translate-y-[-50%] text-muted-foreground"});var R=r(F,2);Ft(R,{placeholder:"Search",class:"pl-8",onkeydown:Z,"data-testid":"text-embedding-search-input",get value(){return e(h)},set value(le){M(h,je(le))}}),n(W),s($,W)};re($e,$=>{e(m)==="samples"&&e(P)&&$(Se)})}n(z);var D=r(z,2),q=o(D);ws(q,{}),n(D),n(K);var oe=r(K,2);ut(oe,{class:"mb-4 bg-border-hard"});var te=r(oe,2),ie=o(te);Ue(ie,()=>t.children),n(te),n(L);var Te=r(L,2);{var b=$=>{var W=ar(),F=w(W);bs(F,{});var R=r(F,2);Js(R,{}),s($,W)};re(Te,$=>{e(m)==="classifiers"&&e(P)&&e(H)&&$(b)})}var j=r(Te,2);_s(j,{}),n(u),s(f,u)};re(Ce,f=>{e(Q)||e(ye)||e(T)?f(ke):f(De,!1)})}s(l,he),Ne(),i()}export{Mr as component,Fr as universal};
