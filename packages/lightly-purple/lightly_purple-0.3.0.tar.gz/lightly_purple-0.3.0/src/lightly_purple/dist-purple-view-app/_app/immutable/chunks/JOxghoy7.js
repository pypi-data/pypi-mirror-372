var mt=Object.defineProperty;var $e=t=>{throw TypeError(t)};var vt=(t,e,s)=>e in t?mt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var Ke=(t,e,s)=>vt(t,typeof e!="symbol"?e+"":e,s),me=(t,e,s)=>e.has(t)||$e("Cannot "+s);var n=(t,e,s)=>(me(t,e,"read from private field"),s?s.call(t):e.get(t)),p=(t,e,s)=>e.has(t)?$e("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,s),l=(t,e,s,r)=>(me(t,e,"write to private field"),r?r.call(t,s):e.set(t,s),s),g=(t,e,s)=>(me(t,e,"access private method"),s);import{a as we,d as ve,g as gt}from"./B9NWxkPv.js";import{av as tt,aw as St}from"./Bzf_CGVu.js";const wt={bodySerializer:t=>JSON.stringify(t,(e,s)=>typeof s=="bigint"?s.toString():s)},Ct=async(t,e)=>{const s=typeof e=="function"?await e(t):e;if(s)return t.scheme==="bearer"?`Bearer ${s}`:t.scheme==="basic"?`Basic ${btoa(s)}`:s},Ot=t=>{switch(t){case"label":return".";case"matrix":return";";case"simple":return",";default:return"&"}},Rt=t=>{switch(t){case"form":return",";case"pipeDelimited":return"|";case"spaceDelimited":return"%20";default:return","}},jt=t=>{switch(t){case"label":return".";case"matrix":return";";case"simple":return",";default:return"&"}},st=({allowReserved:t,explode:e,name:s,style:r,value:a})=>{if(!e){const i=(t?a:a.map(h=>encodeURIComponent(h))).join(Rt(r));switch(r){case"label":return`.${i}`;case"matrix":return`;${s}=${i}`;case"simple":return i;default:return`${s}=${i}`}}const u=Ot(r),o=a.map(i=>r==="label"||r==="simple"?t?i:encodeURIComponent(i):pe({allowReserved:t,name:s,value:i})).join(u);return r==="label"||r==="matrix"?u+o:o},pe=({allowReserved:t,name:e,value:s})=>{if(s==null)return"";if(typeof s=="object")throw new Error("Deeply-nested arrays/objects arenâ€™t supported. Provide your own `querySerializer()` to handle these.");return`${e}=${t?s:encodeURIComponent(s)}`},rt=({allowReserved:t,explode:e,name:s,style:r,value:a,valueOnly:u})=>{if(a instanceof Date)return u?a.toISOString():`${s}=${a.toISOString()}`;if(r!=="deepObject"&&!e){let h=[];Object.entries(a).forEach(([d,c])=>{h=[...h,d,t?c:encodeURIComponent(c)]});const m=h.join(",");switch(r){case"form":return`${s}=${m}`;case"label":return`.${m}`;case"matrix":return`;${s}=${m}`;default:return m}}const o=jt(r),i=Object.entries(a).map(([h,m])=>pe({allowReserved:t,name:r==="deepObject"?`${s}[${h}]`:h,value:m})).join(o);return r==="label"||r==="matrix"?o+i:i},At=/\{[^{}]+\}/g,Et=({path:t,url:e})=>{let s=e;const r=e.match(At);if(r)for(const a of r){let u=!1,o=a.substring(1,a.length-1),i="simple";o.endsWith("*")&&(u=!0,o=o.substring(0,o.length-1)),o.startsWith(".")?(o=o.substring(1),i="label"):o.startsWith(";")&&(o=o.substring(1),i="matrix");const h=t[o];if(h==null)continue;if(Array.isArray(h)){s=s.replace(a,st({explode:u,name:o,style:i,value:h}));continue}if(typeof h=="object"){s=s.replace(a,rt({explode:u,name:o,style:i,value:h,valueOnly:!0}));continue}if(i==="matrix"){s=s.replace(a,`;${pe({name:o,value:h})}`);continue}const m=encodeURIComponent(i==="label"?`.${h}`:h);s=s.replace(a,m)}return s},nt=({allowReserved:t,array:e,object:s}={})=>a=>{const u=[];if(a&&typeof a=="object")for(const o in a){const i=a[o];if(i!=null)if(Array.isArray(i)){const h=st({allowReserved:t,explode:!0,name:o,style:"form",value:i,...e});h&&u.push(h)}else if(typeof i=="object"){const h=rt({allowReserved:t,explode:!0,name:o,style:"deepObject",value:i,...s});h&&u.push(h)}else{const h=pe({allowReserved:t,name:o,value:i});h&&u.push(h)}}return u.join("&")},Ft=t=>{var s;if(!t)return"stream";const e=(s=t.split(";")[0])==null?void 0:s.trim();if(e){if(e.startsWith("application/json")||e.endsWith("+json"))return"json";if(e==="multipart/form-data")return"formData";if(["application/","audio/","image/","video/"].some(r=>e.startsWith(r)))return"blob";if(e.startsWith("text/"))return"text"}},It=async({security:t,...e})=>{for(const s of t){const r=await Ct(s,e.auth);if(!r)continue;const a=s.name??"Authorization";switch(s.in){case"query":e.query||(e.query={}),e.query[a]=r;break;case"cookie":e.headers.append("Cookie",`${a}=${r}`);break;case"header":default:e.headers.set(a,r);break}return}},He=t=>Ut({baseUrl:t.baseUrl,path:t.path,query:t.query,querySerializer:typeof t.querySerializer=="function"?t.querySerializer:nt(t.querySerializer),url:t.url}),Ut=({baseUrl:t,path:e,query:s,querySerializer:r,url:a})=>{const u=a.startsWith("/")?a:`/${a}`;let o=(t??"")+u;e&&(o=Et({path:e,url:o}));let i=s?r(s):"";return i.startsWith("?")&&(i=i.substring(1)),i&&(o+=`?${i}`),o},Be=(t,e)=>{var r;const s={...t,...e};return(r=s.baseUrl)!=null&&r.endsWith("/")&&(s.baseUrl=s.baseUrl.substring(0,s.baseUrl.length-1)),s.headers=it(t.headers,e.headers),s},it=(...t)=>{const e=new Headers;for(const s of t){if(!s||typeof s!="object")continue;const r=s instanceof Headers?s.entries():Object.entries(s);for(const[a,u]of r)if(u===null)e.delete(a);else if(Array.isArray(u))for(const o of u)e.append(a,o);else u!==void 0&&e.set(a,typeof u=="object"?JSON.stringify(u):u)}return e};class ge{constructor(){Ke(this,"_fns");this._fns=[]}clear(){this._fns=[]}getInterceptorIndex(e){return typeof e=="number"?this._fns[e]?e:-1:this._fns.indexOf(e)}exists(e){const s=this.getInterceptorIndex(e);return!!this._fns[s]}eject(e){const s=this.getInterceptorIndex(e);this._fns[s]&&(this._fns[s]=null)}update(e,s){const r=this.getInterceptorIndex(e);return this._fns[r]?(this._fns[r]=s,e):!1}use(e){return this._fns=[...this._fns,e],this._fns.length-1}}const Tt=()=>({error:new ge,request:new ge,response:new ge}),xt=nt({allowReserved:!1,array:{explode:!0,style:"form"},object:{explode:!0,style:"deepObject"}}),qt={"Content-Type":"application/json"},at=(t={})=>({...wt,headers:qt,parseAs:"auto",querySerializer:xt,...t}),Dt=(t={})=>{let e=Be(at(),t);const s=()=>({...e}),r=o=>(e=Be(e,o),s()),a=Tt(),u=async o=>{const i={...e,...o,fetch:o.fetch??e.fetch??globalThis.fetch,headers:it(e.headers,o.headers)};i.security&&await It({...i,security:i.security}),i.requestValidator&&await i.requestValidator(i),i.body&&i.bodySerializer&&(i.body=i.bodySerializer(i.body)),(i.body===void 0||i.body==="")&&i.headers.delete("Content-Type");const h=He(i),m={redirect:"follow",...i};let d=new Request(h,m);for(const C of a.request._fns)C&&(d=await C(d,i));const c=i.fetch;let f=await c(d);for(const C of a.response._fns)C&&(f=await C(f,d,i));const w={request:d,response:f};if(f.ok){if(f.status===204||f.headers.get("Content-Length")==="0")return i.responseStyle==="data"?{}:{data:{},...w};const C=(i.parseAs==="auto"?Ft(f.headers.get("Content-Type")):i.parseAs)??"json";let F;switch(C){case"arrayBuffer":case"blob":case"formData":case"json":case"text":F=await f[C]();break;case"stream":return i.responseStyle==="data"?f.body:{data:f.body,...w}}return C==="json"&&(i.responseValidator&&await i.responseValidator(F),i.responseTransformer&&(F=await i.responseTransformer(F))),i.responseStyle==="data"?F:{data:F,...w}}const j=await f.text();let v;try{v=JSON.parse(j)}catch{}const S=v??j;let O=S;for(const C of a.error._fns)C&&(O=await C(S,f,d,i));if(O=O||{},i.throwOnError)throw O;return i.responseStyle==="data"?void 0:{error:O,...w}};return{buildUrl:He,connect:o=>u({...o,method:"CONNECT"}),delete:o=>u({...o,method:"DELETE"}),get:o=>u({...o,method:"GET"}),getConfig:s,head:o=>u({...o,method:"HEAD"}),interceptors:a,options:o=>u({...o,method:"OPTIONS"}),patch:o=>u({...o,method:"PATCH"}),post:o=>u({...o,method:"POST"}),put:o=>u({...o,method:"PUT"}),request:u,setConfig:r,trace:o=>u({...o,method:"TRACE"})}},_t=t=>(t.created_at&&(t.created_at=new Date(t.created_at)),t),Pt=async t=>(t=t.map(e=>_t(e)),t),Qt=t=>(t.created_at=new Date(t.created_at),t.updated_at=new Date(t.updated_at),t),Mt=async t=>(t=Qt(t),t),P=Dt(at()),Lt=t=>((t==null?void 0:t.client)??P).get({url:"/api/annotation_labels",...t}),zt=t=>(t.client??P).get({url:"/api/datasets/{dataset_id}/annotations/count",...t,headers:{"Content-Type":"application/json",...t.headers}}),kt=t=>(t.client??P).get({url:"/api/datasets/{dataset_id}/annotations",...t}),$t=t=>(t.client??P).put({responseTransformer:Pt,url:"/api/datasets/{dataset_id}/annotations",...t,headers:{"Content-Type":"application/json",...t.headers}}),Kt=t=>(t.client??P).get({url:"/api/datasets/{dataset_id}/annotations/{annotation_id}",...t}),ws=t=>((t==null?void 0:t.client)??P).get({responseTransformer:Mt,url:"/api/settings",...t}),Cs=t=>(t.client??P).get({url:"/api/classifiers/{classifier_id}/sample_history",...t}),Ht=t=>(t.client??P).get({url:"/api/datasets/{dataset_id}/metadata/info",...t});var Qe=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(t){return this.listeners.add(t),this.onSubscribe(),()=>{this.listeners.delete(t),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},ie=typeof window>"u"||"Deno"in globalThis;function Ce(){}function Os(t,e){return typeof t=="function"?t(e):t}function Oe(t){return typeof t=="number"&&t>=0&&t!==1/0}function ot(t,e){return Math.max(t+(e||0)-Date.now(),0)}function ye(t,e){return typeof t=="function"?t(e):t}function x(t,e){return typeof t=="function"?t(e):t}function Rs(t,e){const{type:s="all",exact:r,fetchStatus:a,predicate:u,queryKey:o,stale:i}=t;if(o){if(r){if(e.queryHash!==Bt(o,e.options))return!1}else if(!Me(e.queryKey,o))return!1}if(s!=="all"){const h=e.isActive();if(s==="active"&&!h||s==="inactive"&&h)return!1}return!(typeof i=="boolean"&&e.isStale()!==i||a&&a!==e.state.fetchStatus||u&&!u(e))}function js(t,e){const{exact:s,status:r,predicate:a,mutationKey:u}=t;if(u){if(!e.options.mutationKey)return!1;if(s){if(Re(e.options.mutationKey)!==Re(u))return!1}else if(!Me(e.options.mutationKey,u))return!1}return!(r&&e.state.status!==r||a&&!a(e))}function Bt(t,e){return((e==null?void 0:e.queryKeyHashFn)||Re)(t)}function Re(t){return JSON.stringify(t,(e,s)=>Ae(s)?Object.keys(s).sort().reduce((r,a)=>(r[a]=s[a],r),{}):s)}function Me(t,e){return t===e?!0:typeof t!=typeof e?!1:t&&e&&typeof t=="object"&&typeof e=="object"?!Object.keys(e).some(s=>!Me(t[s],e[s])):!1}function ut(t,e){if(t===e)return t;const s=Ne(t)&&Ne(e);if(s||Ae(t)&&Ae(e)){const r=s?t:Object.keys(t),a=r.length,u=s?e:Object.keys(e),o=u.length,i=s?[]:{};let h=0;for(let m=0;m<o;m++){const d=s?m:u[m];(!s&&r.includes(d)||s)&&t[d]===void 0&&e[d]===void 0?(i[d]=void 0,h++):(i[d]=ut(t[d],e[d]),i[d]===t[d]&&t[d]!==void 0&&h++)}return a===o&&h===a?t:i}return e}function je(t,e){if(!e||Object.keys(t).length!==Object.keys(e).length)return!1;for(const s in t)if(t[s]!==e[s])return!1;return!0}function Ne(t){return Array.isArray(t)&&t.length===Object.keys(t).length}function Ae(t){if(!We(t))return!1;const e=t.constructor;if(e===void 0)return!0;const s=e.prototype;return!(!We(s)||!s.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(t)!==Object.prototype)}function We(t){return Object.prototype.toString.call(t)==="[object Object]"}function Nt(t){return new Promise(e=>{setTimeout(e,t)})}function Ee(t,e,s){return typeof s.structuralSharing=="function"?s.structuralSharing(t,e):s.structuralSharing!==!1?ut(t,e):e}function As(t,e,s=0){const r=[...t,e];return s&&r.length>s?r.slice(1):r}function Es(t,e,s=0){const r=[e,...t];return s&&r.length>s?r.slice(0,-1):r}var ct=Symbol();function Wt(t,e){return!t.queryFn&&(e!=null&&e.initialPromise)?()=>e.initialPromise:!t.queryFn||t.queryFn===ct?()=>Promise.reject(new Error(`Missing queryFn: '${t.queryHash}'`)):t.queryFn}var k,Q,J,Je,Vt=(Je=class extends Qe{constructor(){super();p(this,k);p(this,Q);p(this,J);l(this,J,e=>{if(!ie&&window.addEventListener){const s=()=>e();return window.addEventListener("visibilitychange",s,!1),()=>{window.removeEventListener("visibilitychange",s)}}})}onSubscribe(){n(this,Q)||this.setEventListener(n(this,J))}onUnsubscribe(){var e;this.hasListeners()||((e=n(this,Q))==null||e.call(this),l(this,Q,void 0))}setEventListener(e){var s;l(this,J,e),(s=n(this,Q))==null||s.call(this),l(this,Q,e(r=>{typeof r=="boolean"?this.setFocused(r):this.onFocus()}))}setFocused(e){n(this,k)!==e&&(l(this,k,e),this.onFocus())}onFocus(){const e=this.isFocused();this.listeners.forEach(s=>{s(e)})}isFocused(){var e;return typeof n(this,k)=="boolean"?n(this,k):((e=globalThis.document)==null?void 0:e.visibilityState)!=="hidden"}},k=new WeakMap,Q=new WeakMap,J=new WeakMap,Je),ht=new Vt,X,M,Y,Xe,Gt=(Xe=class extends Qe{constructor(){super();p(this,X,!0);p(this,M);p(this,Y);l(this,Y,e=>{if(!ie&&window.addEventListener){const s=()=>e(!0),r=()=>e(!1);return window.addEventListener("online",s,!1),window.addEventListener("offline",r,!1),()=>{window.removeEventListener("online",s),window.removeEventListener("offline",r)}}})}onSubscribe(){n(this,M)||this.setEventListener(n(this,Y))}onUnsubscribe(){var e;this.hasListeners()||((e=n(this,M))==null||e.call(this),l(this,M,void 0))}setEventListener(e){var s;l(this,Y,e),(s=n(this,M))==null||s.call(this),l(this,M,e(this.setOnline.bind(this)))}setOnline(e){n(this,X)!==e&&(l(this,X,e),this.listeners.forEach(r=>{r(e)}))}isOnline(){return n(this,X)}},X=new WeakMap,M=new WeakMap,Y=new WeakMap,Xe),lt=new Gt;function Fe(){let t,e;const s=new Promise((a,u)=>{t=a,e=u});s.status="pending",s.catch(()=>{});function r(a){Object.assign(s,a),delete s.resolve,delete s.reject}return s.resolve=a=>{r({status:"fulfilled",value:a}),t(a)},s.reject=a=>{r({status:"rejected",reason:a}),e(a)},s}function Jt(t){return Math.min(1e3*2**t,3e4)}function dt(t){return(t??"online")==="online"?lt.isOnline():!0}var ft=class extends Error{constructor(t){super("CancelledError"),this.revert=t==null?void 0:t.revert,this.silent=t==null?void 0:t.silent}};function Se(t){return t instanceof ft}function Xt(t){let e=!1,s=0,r=!1,a;const u=Fe(),o=v=>{var S;r||(f(new ft(v)),(S=t.abort)==null||S.call(t))},i=()=>{e=!0},h=()=>{e=!1},m=()=>ht.isFocused()&&(t.networkMode==="always"||lt.isOnline())&&t.canRun(),d=()=>dt(t.networkMode)&&t.canRun(),c=v=>{var S;r||(r=!0,(S=t.onSuccess)==null||S.call(t,v),a==null||a(),u.resolve(v))},f=v=>{var S;r||(r=!0,(S=t.onError)==null||S.call(t,v),a==null||a(),u.reject(v))},w=()=>new Promise(v=>{var S;a=O=>{(r||m())&&v(O)},(S=t.onPause)==null||S.call(t)}).then(()=>{var v;a=void 0,r||(v=t.onContinue)==null||v.call(t)}),j=()=>{if(r)return;let v;const S=s===0?t.initialPromise:void 0;try{v=S??t.fn()}catch(O){v=Promise.reject(O)}Promise.resolve(v).then(c).catch(O=>{var be;if(r)return;const C=t.retry??(ie?0:3),F=t.retryDelay??Jt,le=typeof F=="function"?F(s,O):F,de=C===!0||typeof C=="number"&&s<C||typeof C=="function"&&C(s,O);if(e||!de){f(O);return}s++,(be=t.onFail)==null||be.call(t,s,O),Nt(le).then(()=>m()?void 0:w()).then(()=>{e?f(O):j()})})};return{promise:u,cancel:o,continue:()=>(a==null||a(),u),cancelRetry:i,continueRetry:h,canStart:d,start:()=>(d()?j():w().then(j),u)}}function Yt(){let t=[],e=0,s=i=>{i()},r=i=>{i()},a=i=>setTimeout(i,0);const u=i=>{e?t.push(i):a(()=>{s(i)})},o=()=>{const i=t;t=[],i.length&&a(()=>{r(()=>{i.forEach(h=>{s(h)})})})};return{batch:i=>{let h;e++;try{h=i()}finally{e--,e||o()}return h},batchCalls:i=>(...h)=>{u(()=>{i(...h)})},schedule:u,setNotifyFunction:i=>{s=i},setBatchNotifyFunction:i=>{r=i},setScheduler:i=>{a=i}}}var Le=Yt(),$,Ye,Zt=(Ye=class{constructor(){p(this,$)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),Oe(this.gcTime)&&l(this,$,setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(t){this.gcTime=Math.max(this.gcTime||0,t??(ie?1/0:5*60*1e3))}clearGcTimeout(){n(this,$)&&(clearTimeout(n(this,$)),l(this,$,void 0))}},$=new WeakMap,Ye),Z,ee,U,K,R,oe,H,T,_,Ze,Fs=(Ze=class extends Zt{constructor(e){super();p(this,T);p(this,Z);p(this,ee);p(this,U);p(this,K);p(this,R);p(this,oe);p(this,H);l(this,H,!1),l(this,oe,e.defaultOptions),this.setOptions(e.options),this.observers=[],l(this,K,e.client),l(this,U,n(this,K).getQueryCache()),this.queryKey=e.queryKey,this.queryHash=e.queryHash,l(this,Z,es(this.options)),this.state=e.state??n(this,Z),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var e;return(e=n(this,R))==null?void 0:e.promise}setOptions(e){this.options={...n(this,oe),...e},this.updateGcTime(this.options.gcTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&n(this,U).remove(this)}setData(e,s){const r=Ee(this.state.data,e,this.options);return g(this,T,_).call(this,{data:r,type:"success",dataUpdatedAt:s==null?void 0:s.updatedAt,manual:s==null?void 0:s.manual}),r}setState(e,s){g(this,T,_).call(this,{type:"setState",state:e,setStateOptions:s})}cancel(e){var r,a;const s=(r=n(this,R))==null?void 0:r.promise;return(a=n(this,R))==null||a.cancel(e),s?s.then(Ce).catch(Ce):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(n(this,Z))}isActive(){return this.observers.some(e=>x(e.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===ct||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStale(){return this.state.isInvalidated?!0:this.getObserversCount()>0?this.observers.some(e=>e.getCurrentResult().isStale):this.state.data===void 0}isStaleByTime(e=0){return this.state.isInvalidated||this.state.data===void 0||!ot(this.state.dataUpdatedAt,e)}onFocus(){var s;const e=this.observers.find(r=>r.shouldFetchOnWindowFocus());e==null||e.refetch({cancelRefetch:!1}),(s=n(this,R))==null||s.continue()}onOnline(){var s;const e=this.observers.find(r=>r.shouldFetchOnReconnect());e==null||e.refetch({cancelRefetch:!1}),(s=n(this,R))==null||s.continue()}addObserver(e){this.observers.includes(e)||(this.observers.push(e),this.clearGcTimeout(),n(this,U).notify({type:"observerAdded",query:this,observer:e}))}removeObserver(e){this.observers.includes(e)&&(this.observers=this.observers.filter(s=>s!==e),this.observers.length||(n(this,R)&&(n(this,H)?n(this,R).cancel({revert:!0}):n(this,R).cancelRetry()),this.scheduleGc()),n(this,U).notify({type:"observerRemoved",query:this,observer:e}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||g(this,T,_).call(this,{type:"invalidate"})}fetch(e,s){var h,m,d;if(this.state.fetchStatus!=="idle"){if(this.state.data!==void 0&&(s!=null&&s.cancelRefetch))this.cancel({silent:!0});else if(n(this,R))return n(this,R).continueRetry(),n(this,R).promise}if(e&&this.setOptions(e),!this.options.queryFn){const c=this.observers.find(f=>f.options.queryFn);c&&this.setOptions(c.options)}const r=new AbortController,a=c=>{Object.defineProperty(c,"signal",{enumerable:!0,get:()=>(l(this,H,!0),r.signal)})},u=()=>{const c=Wt(this.options,s),f={client:n(this,K),queryKey:this.queryKey,meta:this.meta};return a(f),l(this,H,!1),this.options.persister?this.options.persister(c,f,this):c(f)},o={fetchOptions:s,options:this.options,queryKey:this.queryKey,client:n(this,K),state:this.state,fetchFn:u};a(o),(h=this.options.behavior)==null||h.onFetch(o,this),l(this,ee,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((m=o.fetchOptions)==null?void 0:m.meta))&&g(this,T,_).call(this,{type:"fetch",meta:(d=o.fetchOptions)==null?void 0:d.meta});const i=c=>{var f,w,j,v;Se(c)&&c.silent||g(this,T,_).call(this,{type:"error",error:c}),Se(c)||((w=(f=n(this,U).config).onError)==null||w.call(f,c,this),(v=(j=n(this,U).config).onSettled)==null||v.call(j,this.state.data,c,this)),this.scheduleGc()};return l(this,R,Xt({initialPromise:s==null?void 0:s.initialPromise,fn:o.fetchFn,abort:r.abort.bind(r),onSuccess:c=>{var f,w,j,v;if(c===void 0){i(new Error(`${this.queryHash} data is undefined`));return}try{this.setData(c)}catch(S){i(S);return}(w=(f=n(this,U).config).onSuccess)==null||w.call(f,c,this),(v=(j=n(this,U).config).onSettled)==null||v.call(j,c,this.state.error,this),this.scheduleGc()},onError:i,onFail:(c,f)=>{g(this,T,_).call(this,{type:"failed",failureCount:c,error:f})},onPause:()=>{g(this,T,_).call(this,{type:"pause"})},onContinue:()=>{g(this,T,_).call(this,{type:"continue"})},retry:o.options.retry,retryDelay:o.options.retryDelay,networkMode:o.options.networkMode,canRun:()=>!0})),n(this,R).start()}},Z=new WeakMap,ee=new WeakMap,U=new WeakMap,K=new WeakMap,R=new WeakMap,oe=new WeakMap,H=new WeakMap,T=new WeakSet,_=function(e){const s=r=>{switch(e.type){case"failed":return{...r,fetchFailureCount:e.failureCount,fetchFailureReason:e.error};case"pause":return{...r,fetchStatus:"paused"};case"continue":return{...r,fetchStatus:"fetching"};case"fetch":return{...r,...yt(r.data,this.options),fetchMeta:e.meta??null};case"success":return{...r,data:e.data,dataUpdateCount:r.dataUpdateCount+1,dataUpdatedAt:e.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!e.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const a=e.error;return Se(a)&&a.revert&&n(this,ee)?{...n(this,ee),fetchStatus:"idle"}:{...r,error:a,errorUpdateCount:r.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:r.fetchFailureCount+1,fetchFailureReason:a,fetchStatus:"idle",status:"error"};case"invalidate":return{...r,isInvalidated:!0};case"setState":return{...r,...e.state}}};this.state=s(this.state),Le.batch(()=>{this.observers.forEach(r=>{r.onQueryUpdate()}),n(this,U).notify({query:this,type:"updated",action:e})})},Ze);function yt(t,e){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:dt(e.networkMode)?"fetching":"paused",...t===void 0&&{error:null,status:"pending"}}}function es(t){const e=typeof t.initialData=="function"?t.initialData():t.initialData,s=e!==void 0,r=s?typeof t.initialDataUpdatedAt=="function"?t.initialDataUpdatedAt():t.initialDataUpdatedAt:0;return{data:e,dataUpdateCount:0,dataUpdatedAt:s?r??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:s?"success":"pending",fetchStatus:"idle"}}var I,y,ue,E,B,te,L,D,ce,se,re,N,W,z,ne,b,ae,Ie,Ue,Te,xe,qe,De,_e,pt,et,ts=(et=class extends Qe{constructor(e,s){super();p(this,b);p(this,I);p(this,y);p(this,ue);p(this,E);p(this,B);p(this,te);p(this,L);p(this,D);p(this,ce);p(this,se);p(this,re);p(this,N);p(this,W);p(this,z);p(this,ne,new Set);this.options=s,l(this,I,e),l(this,D,null),l(this,L,Fe()),this.options.experimental_prefetchInRender||n(this,L).reject(new Error("experimental_prefetchInRender feature flag is not enabled")),this.bindMethods(),this.setOptions(s)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(n(this,y).addObserver(this),Ve(n(this,y),this.options)?g(this,b,ae).call(this):this.updateResult(),g(this,b,xe).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return Pe(n(this,y),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return Pe(n(this,y),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,g(this,b,qe).call(this),g(this,b,De).call(this),n(this,y).removeObserver(this)}setOptions(e,s){const r=this.options,a=n(this,y);if(this.options=n(this,I).defaultQueryOptions(e),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof x(this.options.enabled,n(this,y))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");g(this,b,_e).call(this),n(this,y).setOptions(this.options),r._defaulted&&!je(this.options,r)&&n(this,I).getQueryCache().notify({type:"observerOptionsUpdated",query:n(this,y),observer:this});const u=this.hasListeners();u&&Ge(n(this,y),a,this.options,r)&&g(this,b,ae).call(this),this.updateResult(s),u&&(n(this,y)!==a||x(this.options.enabled,n(this,y))!==x(r.enabled,n(this,y))||ye(this.options.staleTime,n(this,y))!==ye(r.staleTime,n(this,y)))&&g(this,b,Ie).call(this);const o=g(this,b,Ue).call(this);u&&(n(this,y)!==a||x(this.options.enabled,n(this,y))!==x(r.enabled,n(this,y))||o!==n(this,z))&&g(this,b,Te).call(this,o)}getOptimisticResult(e){const s=n(this,I).getQueryCache().build(n(this,I),e),r=this.createResult(s,e);return rs(this,r)&&(l(this,E,r),l(this,te,this.options),l(this,B,n(this,y).state)),r}getCurrentResult(){return n(this,E)}trackResult(e,s){const r={};return Object.keys(e).forEach(a=>{Object.defineProperty(r,a,{configurable:!1,enumerable:!0,get:()=>(this.trackProp(a),s==null||s(a),e[a])})}),r}trackProp(e){n(this,ne).add(e)}getCurrentQuery(){return n(this,y)}refetch({...e}={}){return this.fetch({...e})}fetchOptimistic(e){const s=n(this,I).defaultQueryOptions(e),r=n(this,I).getQueryCache().build(n(this,I),s);return r.fetch().then(()=>this.createResult(r,s))}fetch(e){return g(this,b,ae).call(this,{...e,cancelRefetch:e.cancelRefetch??!0}).then(()=>(this.updateResult(),n(this,E)))}createResult(e,s){var ke;const r=n(this,y),a=this.options,u=n(this,E),o=n(this,B),i=n(this,te),m=e!==r?e.state:n(this,ue),{state:d}=e;let c={...d},f=!1,w;if(s._optimisticResults){const A=this.hasListeners(),V=!A&&Ve(e,s),G=A&&Ge(e,r,s,a);(V||G)&&(c={...c,...yt(d.data,e.options)}),s._optimisticResults==="isRestoring"&&(c.fetchStatus="idle")}let{error:j,errorUpdatedAt:v,status:S}=c;if(s.select&&c.data!==void 0)if(u&&c.data===(o==null?void 0:o.data)&&s.select===n(this,ce))w=n(this,se);else try{l(this,ce,s.select),w=s.select(c.data),w=Ee(u==null?void 0:u.data,w,s),l(this,se,w),l(this,D,null)}catch(A){l(this,D,A)}else w=c.data;if(s.placeholderData!==void 0&&w===void 0&&S==="pending"){let A;if(u!=null&&u.isPlaceholderData&&s.placeholderData===(i==null?void 0:i.placeholderData))A=u.data;else if(A=typeof s.placeholderData=="function"?s.placeholderData((ke=n(this,re))==null?void 0:ke.state.data,n(this,re)):s.placeholderData,s.select&&A!==void 0)try{A=s.select(A),l(this,D,null)}catch(V){l(this,D,V)}A!==void 0&&(S="success",w=Ee(u==null?void 0:u.data,A,s),f=!0)}n(this,D)&&(j=n(this,D),w=n(this,se),v=Date.now(),S="error");const O=c.fetchStatus==="fetching",C=S==="pending",F=S==="error",le=C&&O,de=w!==void 0,q={status:S,fetchStatus:c.fetchStatus,isPending:C,isSuccess:S==="success",isError:F,isInitialLoading:le,isLoading:le,data:w,dataUpdatedAt:c.dataUpdatedAt,error:j,errorUpdatedAt:v,failureCount:c.fetchFailureCount,failureReason:c.fetchFailureReason,errorUpdateCount:c.errorUpdateCount,isFetched:c.dataUpdateCount>0||c.errorUpdateCount>0,isFetchedAfterMount:c.dataUpdateCount>m.dataUpdateCount||c.errorUpdateCount>m.errorUpdateCount,isFetching:O,isRefetching:O&&!C,isLoadingError:F&&!de,isPaused:c.fetchStatus==="paused",isPlaceholderData:f,isRefetchError:F&&de,isStale:ze(e,s),refetch:this.refetch,promise:n(this,L)};if(this.options.experimental_prefetchInRender){const A=fe=>{q.status==="error"?fe.reject(q.error):q.data!==void 0&&fe.resolve(q.data)},V=()=>{const fe=l(this,L,q.promise=Fe());A(fe)},G=n(this,L);switch(G.status){case"pending":e.queryHash===r.queryHash&&A(G);break;case"fulfilled":(q.status==="error"||q.data!==G.value)&&V();break;case"rejected":(q.status!=="error"||q.error!==G.reason)&&V();break}}return q}updateResult(e){const s=n(this,E),r=this.createResult(n(this,y),this.options);if(l(this,B,n(this,y).state),l(this,te,this.options),n(this,B).data!==void 0&&l(this,re,n(this,y)),je(r,s))return;l(this,E,r);const a={},u=()=>{if(!s)return!0;const{notifyOnChangeProps:o}=this.options,i=typeof o=="function"?o():o;if(i==="all"||!i&&!n(this,ne).size)return!0;const h=new Set(i??n(this,ne));return this.options.throwOnError&&h.add("error"),Object.keys(n(this,E)).some(m=>{const d=m;return n(this,E)[d]!==s[d]&&h.has(d)})};(e==null?void 0:e.listeners)!==!1&&u()&&(a.listeners=!0),g(this,b,pt).call(this,{...a,...e})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&g(this,b,xe).call(this)}},I=new WeakMap,y=new WeakMap,ue=new WeakMap,E=new WeakMap,B=new WeakMap,te=new WeakMap,L=new WeakMap,D=new WeakMap,ce=new WeakMap,se=new WeakMap,re=new WeakMap,N=new WeakMap,W=new WeakMap,z=new WeakMap,ne=new WeakMap,b=new WeakSet,ae=function(e){g(this,b,_e).call(this);let s=n(this,y).fetch(this.options,e);return e!=null&&e.throwOnError||(s=s.catch(Ce)),s},Ie=function(){g(this,b,qe).call(this);const e=ye(this.options.staleTime,n(this,y));if(ie||n(this,E).isStale||!Oe(e))return;const r=ot(n(this,E).dataUpdatedAt,e)+1;l(this,N,setTimeout(()=>{n(this,E).isStale||this.updateResult()},r))},Ue=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(n(this,y)):this.options.refetchInterval)??!1},Te=function(e){g(this,b,De).call(this),l(this,z,e),!(ie||x(this.options.enabled,n(this,y))===!1||!Oe(n(this,z))||n(this,z)===0)&&l(this,W,setInterval(()=>{(this.options.refetchIntervalInBackground||ht.isFocused())&&g(this,b,ae).call(this)},n(this,z)))},xe=function(){g(this,b,Ie).call(this),g(this,b,Te).call(this,g(this,b,Ue).call(this))},qe=function(){n(this,N)&&(clearTimeout(n(this,N)),l(this,N,void 0))},De=function(){n(this,W)&&(clearInterval(n(this,W)),l(this,W,void 0))},_e=function(){const e=n(this,I).getQueryCache().build(n(this,I),this.options);if(e===n(this,y))return;const s=n(this,y);l(this,y,e),l(this,ue,e.state),this.hasListeners()&&(s==null||s.removeObserver(this),e.addObserver(this))},pt=function(e){Le.batch(()=>{e.listeners&&this.listeners.forEach(s=>{s(n(this,E))}),n(this,I).getQueryCache().notify({query:n(this,y),type:"observerResultsUpdated"})})},et);function ss(t,e){return x(e.enabled,t)!==!1&&t.state.data===void 0&&!(t.state.status==="error"&&e.retryOnMount===!1)}function Ve(t,e){return ss(t,e)||t.state.data!==void 0&&Pe(t,e,e.refetchOnMount)}function Pe(t,e,s){if(x(e.enabled,t)!==!1){const r=typeof s=="function"?s(t):s;return r==="always"||r!==!1&&ze(t,e)}return!1}function Ge(t,e,s,r){return(t!==e||x(r.enabled,t)===!1)&&(!s.suspense||t.state.status!=="error")&&ze(t,s)}function ze(t,e){return x(e.enabled,t)!==!1&&t.isStaleByTime(ye(e.staleTime,t))}function rs(t,e){return!je(t.getCurrentResult(),e)}const bt="$$_queryClient",ns=()=>{const t=tt(bt);if(!t)throw new Error("No QueryClient was found in Svelte context. Did you forget to wrap your component with QueryClientProvider?");return t},Is=t=>{St(bt,t)},is="$$_isRestoring",as=()=>{try{const t=tt(is);return t||we(!1)}catch{return we(!1)}};function os(){return as()}function us(t){return ns()}function cs(t){return"subscribe"in t&&typeof t.subscribe=="function"}function hs(){}function ls(t,e,s){const r=us(),a=os(),u=cs(t)?t:we(t),o=ve([u,a],([d,c])=>{const f=r.defaultQueryOptions(d);return f._optimisticResults=c?"isRestoring":"optimistic",f}),i=new e(r,gt(o));o.subscribe(d=>{i.setOptions(d,{listeners:!1})});const h=ve(a,(d,c)=>{const f=d?hs:i.subscribe(Le.batchCalls(c));return i.updateResult(),f}),{subscribe:m}=ve([h,o],([d,c])=>(d=i.getOptimisticResult(c),c.notifyOnChangeProps?d:i.trackResult(d)));return{subscribe:m}}function Us(t,e){return ls(t,ts)}const he=(t,e,s)=>{const r={_id:t,baseUrl:(e==null?void 0:e.baseUrl)||((e==null?void 0:e.client)??P).getConfig().baseUrl};return s&&(r._infinite=s),e!=null&&e.body&&(r.body=e.body),e!=null&&e.headers&&(r.headers=e.headers),e!=null&&e.path&&(r.path=e.path),e!=null&&e.query&&(r.query=e.query),[r]},ds=(t,e)=>{const s={...t[0]};return e.body&&(s.body={...t[0].body,...e.body}),e.headers&&(s.headers={...t[0].headers,...e.headers}),e.path&&(s.path={...t[0].path,...e.path}),e.query&&(s.query={...t[0].query,...e.query}),s},fs=t=>he("readAnnotationLabels",t),Ts=t=>({queryFn:async({queryKey:e,signal:s})=>{const{data:r}=await Lt({...t,...e[0],signal:s,throwOnError:!0});return r},queryKey:fs(t)}),ys=t=>he("countAnnotationsByDataset",t),xs=t=>({queryFn:async({queryKey:e,signal:s})=>{const{data:r}=await zt({...t,...e[0],signal:s,throwOnError:!0});return r},queryKey:ys(t)}),ps=t=>he("readAnnotations",t,!0),qs=t=>({queryFn:async({pageParam:e,queryKey:s,signal:r})=>{const u=ds(s,typeof e=="object"?e:{query:{cursor:e}}),{data:o}=await kt({...t,...u,signal:r,throwOnError:!0});return o},queryKey:ps(t)}),Ds=t=>({mutationFn:async s=>{const{data:r}=await $t({...t,...s,throwOnError:!0});return r}}),bs=t=>he("getAnnotation",t),_s=t=>({queryFn:async({queryKey:e,signal:s})=>{const{data:r}=await Kt({...t,...e[0],signal:s,throwOnError:!0});return r},queryKey:bs(t)}),ms=t=>he("getMetadataInfo",t),Ps=t=>({queryFn:async({queryKey:e,signal:s})=>{const{data:r}=await Ht({...t,...e[0],signal:s,throwOnError:!0});return r},queryKey:ms(t)});export{ls as A,cs as B,hs as C,Ds as D,qs as E,Cs as F,Fs as Q,Zt as R,Qe as S,_s as a,xs as b,Us as c,js as d,Ce as e,ht as f,Ps as g,Bt as h,ye as i,Os as j,Re as k,Is as l,Rs as m,Le as n,lt as o,Me as p,ws as q,Ts as r,ct as s,Xt as t,us as u,Wt as v,Es as w,As as x,ts as y,je as z};
