import{w as Mt,g as at}from"../chunks/B9NWxkPv.js";import{I as lt,l as Ut,s as et,N as Qt,O as Pt,P as Vt,Q as Wt,R as Gt,U as Zt,V as Jt,m as Nt,D as Xt,e as Yt,h as $t,C as Ct,z as Bt,W as Et,b as X,c as nt,u as ta,d as aa,S as ea,X as na,a as oa}from"../chunks/CEsXP70Q.js";import{c as sa}from"../chunks/BzArsHZA.js";import"../chunks/CWj6FrbW.js";import{p as N,f as k,n as R,a as $,$ as ht,g as s,d as x,c as h,r as f,s as M,t as L,F as ra,P as ia,at as St}from"../chunks/Bzf_CGVu.js";import{c as j,a as c,t as I,n as la}from"../chunks/DudhA4Qw.js";import{i as F,a as z,s as ot}from"../chunks/CMIc6HKa.js";import{e as pt}from"../chunks/CGiUvFS7.js";import{g as it}from"../chunks/DVrGeszw.js";import{u as Dt}from"../chunks/C2RVOhm1.js";import{f as kt,S as da}from"../chunks/DDZ-yUNZ.js";import{r as V}from"../chunks/H7C68rOM.js";import"../chunks/zR0aG0nj.js";import{a as ca,u as ua,c as va,r as fa,b as ma}from"../chunks/JOxghoy7.js";import"../chunks/69_IOA4Y.js";import{p as Z}from"../chunks/BoQGZ29z.js";import{S as _a}from"../chunks/CQpBBVqJ.js";import{S as ga,Z as ha,g as pa}from"../chunks/DKl5Supe.js";import{S as ba}from"../chunks/BE3_oRq-.js";import{s as dt,r as q,p as U,a as xa,b as Y}from"../chunks/BYXJJYwp.js";import{s as J}from"../chunks/CF3MLdDH.js";import{s as O}from"../chunks/DTwAVzRw.js";import{C as ya}from"../chunks/E3w8eaja.js";function Aa(i,t){N(t,!0);let e=q(t,["$$slots","$$events","$$legacy"]);lt(i,dt({name:"chevron-right"},()=>e,{iconNode:[["path",{d:"m9 18 6-6-6-6"}]],children:(a,n)=>{var o=j(),r=k(o);O(r,()=>t.children??R),c(a,o)},$$slots:{default:!0}})),$()}function Ia(i,t){N(t,!0);let e=q(t,["$$slots","$$events","$$legacy"]);lt(i,dt({name:"database"},()=>e,{iconNode:[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5"}],["path",{d:"M3 12A9 3 0 0 0 21 12"}]],children:(a,n)=>{var o=j(),r=k(o);O(r,()=>t.children??R),c(a,o)},$$slots:{default:!0}})),$()}function wa(i,t){N(t,!0);let e=q(t,["$$slots","$$events","$$legacy"]);lt(i,dt({name:"house"},()=>e,{iconNode:[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"}]],children:(a,n)=>{var o=j(),r=k(o);O(r,()=>t.children??R),c(a,o)},$$slots:{default:!0}})),$()}function Pa(i,t){N(t,!0);let e=q(t,["$$slots","$$events","$$legacy"]);lt(i,dt({name:"square-dashed"},()=>e,{iconNode:[["path",{d:"M5 3a2 2 0 0 0-2 2"}],["path",{d:"M19 3a2 2 0 0 1 2 2"}],["path",{d:"M21 19a2 2 0 0 1-2 2"}],["path",{d:"M5 21a2 2 0 0 1-2-2"}],["path",{d:"M9 3h1"}],["path",{d:"M9 21h1"}],["path",{d:"M14 3h1"}],["path",{d:"M14 21h1"}],["path",{d:"M3 9v1"}],["path",{d:"M21 9v1"}],["path",{d:"M3 14v1"}],["path",{d:"M21 14v1"}]],children:(a,n)=>{var o=j(),r=k(o);O(r,()=>t.children??R),c(a,o)},$$slots:{default:!0}})),$()}const Sa=async({dataset_id:i,cursor:t=0,limit:e=10,annotation_label_ids:l,tag_ids:a})=>{const n={data:[],error:void 0};try{const o=await sa.GET("/api/datasets/{dataset_id}/annotations",{params:{path:{dataset_id:i},query:{annotation_label_ids:l,tag_ids:a,cursor:t,limit:e}}});if(o.error)throw new Error(JSON.stringify(o.error,null,2));if(!o.data)throw new Error("No data");n.data=o.data.data}catch(o){n.error="Error loading annotations: "+String(o)}return n},ka=({annotationIndex:i,...t})=>{const e=Mt({isLoading:!1});return(async()=>{e.update(a=>({...a,isLoading:!0}));try{const a=await Sa({cursor:i>0?i-1:0,limit:3,...t}),n=a.data.findIndex(u=>u.annotation_id===t.currentAnnotationId),o=a.data[n+1],r=a.data[n-1];e.update(u=>({...u,isLoading:!1,error:a.error?String(a.error):void 0,data:a.error?void 0:{annotationNext:o,annotationPrevious:r}}))}catch(a){e.update(n=>({...n,isLoading:!1,error:String(a)}))}})(),e},Ma=async({parent:i,params:{dataset_id:t,annotationId:e,annotationIndex:l}})=>{const{annotationsSelectedTagsIds:a,annotationsSelectedAnnotationLabelsIds:n,sample:o,dataset:r}=await i(),u=parseInt(l,10),d=Mt();if(!o||!o.annotations)throw new Error("Sample data or annotations not found");if(!r)throw new Error("Dataset data not found");const m=o.annotations.find(v=>v.annotation_id===e);if(!m)throw new Error("Annotation not found");const{taskMap:b}=Ut(),C=m&&m.annotation_task_id&&at(b).has(m.annotation_task_id)?at(b).get(m.annotation_task_id).is_prediction:!1;return ka({annotationIndex:u,dataset_id:t,currentAnnotationId:e,annotation_label_ids:Array.from(at(n)),tag_ids:Array.from(at(a))}).subscribe(({data:v})=>{d.set(v)}),{annotationAdjacents:d,annotationIndex:u,annotationId:e,isPrediction:C,dataset:r}},De=Object.freeze(Object.defineProperty({__proto__:null,load:Ma},Symbol.toStringTag,{value:"Module"}));function Na(i,t){N(t,!0);const[e,l]=ot(),a=()=>z(s(o),"$annotationAdjacents",e),n=x(()=>Z.data.annotationIndex),o=x(()=>Z.data.annotationAdjacents),r=()=>{a().annotationNext&&it(V.toSampleWithAnnotation({datasetId:a().annotationNext.dataset_id,sampleId:a().annotationNext.sample_id,annotationId:a().annotationNext.annotation_id,annotationIndex:s(n)+1}))},u=()=>{a().annotationPrevious&&it(V.toSampleWithAnnotation({datasetId:a().annotationPrevious.dataset_id,sampleId:a().annotationPrevious.sample_id,annotationId:a().annotationPrevious.annotation_id,annotationIndex:s(n)-1}))},d=v=>{switch(v.key){case"ArrowRight":r();break;case"ArrowLeft":u();break}};var m=j();pt("keydown",ht,d);var b=k(m);{var C=v=>{const _=x(()=>!!a().annotationPrevious),P=x(()=>!!a().annotationNext);ba(v,{get hasPrevious(){return s(_)},get hasNext(){return s(P)},onPrevious:u,onNext:r})};F(b,v=>{a()&&v(C)})}c(i,m),$(),l()}const $a={object_detection:"Object Detection",bbox:"Bounding Box",instance_segmentation:"Instance Segmentation",semantic_segmentation:"Semantic Segmentation",classification:"Classification"};var Ca=I('<span class="text-sm"> </span> <span class="break-all text-sm"> </span>',1);function Ba(i,t){var e=Ca(),l=k(e),a=h(l,!0);f(l);var n=M(l,2),o=h(n,!0);f(n),L(()=>{J(a,t.label),et(n,"data-testid",`annotation-metadata-${t.id}`),J(o,t.value)}),c(i,e)}const ct=({datasetId:i,annotationId:t,onUpdate:e})=>{const l=ca({path:{annotation_id:t,dataset_id:i}}),a=ua(),{updateAnnotations:n}=Qt({datasetId:i}),o=va(l);return{updateAnnotation:async u=>{try{await n([u]),a.invalidateQueries({queryKey:l.queryKey}),a.invalidateQueries({queryKey:fa().queryKey}),a.invalidateQueries({queryKey:ma({path:{dataset_id:i}}).queryKey}),Pt.success("Annotation updated successfully"),e==null||e()}catch(d){Pt.error("Failed to update annotation:"+d.message)}},annotation:o}};var Ea=I('<span class="break-all text-sm"> </span>'),Da=I('<span class="text-sm"> </span> <!>',1);function La(i,t){N(t,!0);const[e,l]=ot(),a=()=>z(o,"$result",e),n=()=>z(t.isEditingMode,"$isEditingMode",e),o=Vt(),{updateAnnotation:r}=ct({datasetId:t.datasetId,annotationId:t.annotationId,onUpdate:t.onUpdate}),u=x(()=>Zt(a().data||[])),d=x(()=>{const A=s(u).find(y=>y.value===t.value);return A||{value:t.value,label:t.value}});var m=Da(),b=k(m),C=h(b,!0);f(b);var v=M(b,2);{var _=A=>{Wt(A,{get items(){return s(u)},get value(){return s(d)},name:"annotation-label",placeholder:"Select a label",onSelect:p=>{r({annotation_id:t.annotationId,dataset_id:t.datasetId,label_name:p.value})},notFound:(p,g)=>{let w=()=>g==null?void 0:g().inputValue;Gt(p,{get label(){return w()}})},$$slots:{notFound:!0}})},P=A=>{var y=Ea();et(y,"data-testid","annotation-metadata-label");var p=h(y,!0);f(y),L(()=>J(p,t.value)),c(A,y)};F(v,A=>{n()?A(_):A(P,!1)})}L(()=>J(C,t.label)),c(i,m),$(),l()}var Ta=I('<div class="flex flex-col gap-4"><div class="grid grid-cols-[6rem_1fr] gap-y-3 text-diffuse-foreground"></div></div>');function ja(i,t){N(t,!0);const[e,l]=ot(),a=()=>z(s(r),"$annotationResp",e),{datasetId:n}=Z.data,o=x(()=>ct({datasetId:n,annotationId:t.annotationId})),r=x(()=>s(o).annotation);let u=x(()=>a().data);const d=x(()=>{var P,A;if(!s(u))return[];let _=[{id:"label",label:"Label:",value:(A=(P=s(u))==null?void 0:P.annotation_label)==null?void 0:A.annotation_label_name},{id:"type",label:"Type:",value:$a[s(u).annotation_type]||"Unknown"},{id:"status",label:"Status:",value:t.isPrediction?"Prediction":"Ground Truth"}];if(s(u)&&!Jt(s(u))){const{height:y,width:p}=Nt(s(u));_=[{id:"height",label:"Height:",value:kt(Math.round(y))+"px"},{id:"width",label:"Width:",value:kt(Math.round(p))+"px"},..._]}return _}),{isEditingMode:m}=Z.data.globalStorage;var b=j(),C=k(b);{var v=_=>{Xt(_,{title:"Annotation details",children:(P,A)=>{var y=Ta(),p=h(y);Yt(p,21,()=>s(d),({label:g,value:w,id:B})=>g,(g,w)=>{let B=()=>s(w).label,E=()=>s(w).value,S=()=>s(w).id;var D=j(),H=k(D);{var W=K=>{La(K,{get onUpdate(){return t.onUpdate},get annotationId(){return t.annotationId},datasetId:n,get label(){return B()},get value(){return E()},isEditingMode:m})},tt=K=>{Ba(K,{get label(){return B()},get id(){return S()},get value(){return E()}})};F(H,K=>{S()==="label"&&m?K(W):K(tt,!1)})}c(g,D)}),f(p),f(y),c(P,y)}})};F(C,_=>{s(d).length>0&&_(v)})}c(i,b),$(),l()}var Oa=I('<!> <h2 class="py-2 text-lg font-semibold"><a>Check all sample annotations</a></h2>',1),Ha=I('<div class="flex h-full w-full items-center justify-center"><!></div>'),Ra=I('<div class="flex h-full min-h-0 flex-col space-y-4 overflow-hidden dark:[color-scheme:dark]"><!> <!></div>');function qa(i,t){N(t,!0);const e=U(t,"isPrediction",3,!1),{datasetId:l}=Z.data;let a=ia(void 0);ct({datasetId:l,annotationId:t.annotationId}).annotation.subscribe(d=>{d.isSuccess&&ra(a,xa(d.data.sample))});const o=$t(),[r,u]=o;Ct(i,{className:"h-full",children:(d,m)=>{Bt(d,{className:"h-full flex flex-col",children:(b,C)=>{var v=Ra(),_=h(v);ja(_,{get annotationId(){return t.annotationId},get isPrediction(){return e()},get onUpdate(){return t.onUpdate}});var P=M(_,2);{var A=p=>{var g=Oa(),w=k(g);ga(w,{get sample(){return s(a)},showCustomMetadata:!1});var B=M(w,2),E=h(B);f(B),L(S=>et(E,"href",S),[()=>r(V.toSample({sampleId:s(a).sample_id,datasetId:s(a).dataset_id}),void 0)]),c(p,g)},y=p=>{var g=Ha(),w=h(g);Et(w,{size:"large",align:"center"}),f(g),c(p,g)};F(P,p=>{s(a)?p(A):p(y,!1)})}f(v),c(b,v)},$$slots:{default:!0}})},$$slots:{default:!0}}),$()}var Fa=I("<nav><!></nav>");function Ka(i,t){N(t,!0);let e=U(t,"ref",15),l=q(t,["$$slots","$$events","$$legacy","ref","class","children"]);var a=Fa();let n;var o=h(a);O(o,()=>t.children??R),f(a),Y(a,r=>e(r),()=>e()),L(()=>n=X(a,n,{class:t.class,"aria-label":"breadcrumb",...l})),c(i,a),$()}var za=I("<li><!></li>");function rt(i,t){N(t,!0);let e=U(t,"ref",15,null),l=q(t,["$$slots","$$events","$$legacy","ref","class","children"]);var a=za();let n;var o=h(a);O(o,()=>t.children??R),f(a),Y(a,r=>e(r),()=>e()),L(r=>n=X(a,n,{class:r,...l}),[()=>nt("inline-flex items-center gap-1.5",t.class)]),c(i,a),$()}var Ua=I("<li><!></li>");function _t(i,t){N(t,!0);let e=U(t,"ref",15,null),l=q(t,["$$slots","$$events","$$legacy","ref","class","children"]);var a=Ua();let n;var o=h(a);{var r=d=>{var m=j(),b=k(m);O(b,()=>t.children??R),c(d,m)},u=d=>{Aa(d,{})};F(o,d=>{t.children?d(r):d(u,!1)})}f(a),Y(a,d=>e(d),()=>e()),L(d=>n=X(a,n,{role:"presentation","aria-hidden":"true",class:d,...l}),[()=>nt("[&>svg]:size-3.5",t.class)]),c(i,a),$()}var Qa=I("<a><!></a>");function gt(i,t){N(t,!0);let e=U(t,"ref",15,null),l=U(t,"href",3,void 0),a=q(t,["$$slots","$$events","$$legacy","ref","class","href","child","children"]);const n=x(()=>({class:nt("hover:text-foreground transition-colors",t.class),href:l(),...a})),o=$t(),[r,u]=o;var d=j(),m=k(d);{var b=v=>{var _=j(),P=k(_);O(P,()=>t.child,()=>({props:s(n)})),c(v,_)},C=v=>{var _=Qa();let P;var A=h(_);O(A,()=>t.children??R),f(_),Y(_,y=>e(y),()=>e()),L(y=>P=X(_,P,{...y}),[()=>u({...s(n)},[{attribute_name:"href",lang_attribute_name:"hreflang"}])]),c(v,_)};F(m,v=>{t.child?v(b):v(C,!1)})}c(i,d),$()}var Va=I("<ol><!></ol>");function Wa(i,t){N(t,!0);let e=U(t,"ref",15,null),l=q(t,["$$slots","$$events","$$legacy","ref","class","children"]);var a=Va();let n;var o=h(a);O(o,()=>t.children??R),f(a),Y(a,r=>e(r),()=>e()),L(r=>n=X(a,n,{class:r,...l}),[()=>nt("text-muted-foreground flex flex-wrap items-center gap-1.5 break-words text-sm sm:gap-2.5",t.class)]),c(i,a),$()}var Ga=I("<span><!></span>");function Za(i,t){N(t,!0);let e=U(t,"ref",15,null),l=q(t,["$$slots","$$events","$$legacy","ref","class","children"]);var a=Ga();let n;var o=h(a);O(o,()=>t.children??R),f(a),Y(a,r=>e(r),()=>e()),L(r=>n=X(a,n,{role:"link","aria-disabled":"true","aria-current":"page",class:r,...l}),[()=>nt("text-foreground font-normal",t.class)]),c(i,a),$()}var Ja=I('<!> <span class="hidden sm:inline">Home</span>',1),Xa=I('<!> <span class="max-w-[150px] truncate"> </span>',1),Ya=I('<!> <span class="hidden sm:inline">Annotations</span>',1),te=I('<!> <span class="max-w-[200px] truncate"> </span>',1),ae=I("<!> <!> <!> <!> <!> <!> <!>",1);function ee(i,t){N(t,!0);const[e,l]=ot(),a=()=>z(n,"$annotationsTotalCount",e),{annotationsTotalCount:n}=Dt();Ka(i,{class:"mb-2",children:(o,r)=>{Wa(o,{children:(u,d)=>{var m=ae(),b=k(m);rt(b,{children:(p,g)=>{const w=x(()=>V.toHome());gt(p,{get href(){return s(w)},class:"flex items-center gap-2",children:(B,E)=>{var S=Ja(),D=k(S);wa(D,{class:"h-4 w-4"}),St(2),c(B,S)},$$slots:{default:!0}})},$$slots:{default:!0}});var C=M(b,2);_t(C,{});var v=M(C,2);rt(v,{children:(p,g)=>{const w=x(()=>V.toAnnotations(t.dataset.dataset_id));gt(p,{get href(){return s(w)},class:"flex items-center gap-2",get title(){return t.dataset.directory},children:(B,E)=>{var S=Xa(),D=k(S);Ia(D,{class:"h-4 w-4"});var H=M(D,2),W=h(H,!0);f(H),L(()=>{et(H,"title",t.dataset.directory),J(W,t.dataset.name)}),c(B,S)},$$slots:{default:!0}})},$$slots:{default:!0}});var _=M(v,2);_t(_,{});var P=M(_,2);rt(P,{children:(p,g)=>{const w=x(()=>V.toAnnotations(t.dataset.dataset_id));gt(p,{get href(){return s(w)},class:"flex items-center gap-2",children:(B,E)=>{var S=Ya(),D=k(S);ya(D,{class:"h-4 w-4"}),St(2),c(B,S)},$$slots:{default:!0}})},$$slots:{default:!0}});var A=M(P,2);_t(A,{});var y=M(A,2);rt(y,{children:(p,g)=>{Za(p,{class:"flex items-center gap-2",children:(w,B)=>{var E=te(),S=k(E);Pa(S,{class:"h-4 w-4"});var D=M(S,2),H=h(D);f(D),L(()=>J(H,`Annotation ${t.annotationIndex+1} of ${a()??""}`)),c(w,E)},$$slots:{default:!0}})},$$slots:{default:!0}}),c(u,m)},$$slots:{default:!0}})},$$slots:{default:!0}}),$(),l()}var ne=la("<image></image><g><!></g>",1),oe=I('<div class="h-full w-full overflow-hidden"><div class="sample relative h-full w-full"><div class="absolute right-4 top-2 z-30"><!></div> <!> <!></div></div>'),se=I('<div class="flex h-full w-full items-center justify-center"><!></div>'),re=I('<div class="flex h-full w-full flex-col space-y-4"><div class="flex w-full items-center"><!></div> <!> <div class="flex min-h-0 flex-1 gap-4"><div class="flex-1"><!></div> <div class="relative w-[375px]"><!></div></div></div>');function ie(i,t){N(t,!0);const[e,l]=ot(),a=()=>z(s(p),"$annotationResp",e),n=()=>z(u,"$selectedSampleAnnotationCropIds",e),o=()=>z(d,"$isHidden",e),{toggleSampleAnnotationCropSelection:r,selectedSampleAnnotationCropIds:u}=Dt(),{isHidden:d,handleKeyEvent:m}=ta(),{settingsStore:b}=aa(),C=" ",v=at(b).key_go_back,_=()=>{var T;(T=t.sample)!=null&&T.dataset_id?it(V.toAnnotations(t.sample.dataset_id)):it("/")},P=T=>{switch(T.key){case v:_();break;case C:T.preventDefault(),r(t.annotationId);break}m(T)},A=Z.data.datasetId,y=x(()=>ct({datasetId:A,annotationId:t.annotationId})),p=x(()=>s(y).annotation);let g=x(()=>a().data),w=x(()=>{var T,ut;return pa(((ut=(T=s(g))==null?void 0:T.sample)==null?void 0:ut.sample_id)||"")}),B=x(()=>s(g)?Nt(s(g)):void 0);var E=re();pt("keydown",ht,P),pt("keyup",ht,m);var S=h(E),D=h(S);ee(D,{get dataset(){return t.dataset},get annotationIndex(){return t.annotationIndex}}),f(S);var H=M(S,2);da(H,{class:"mb-4 bg-border-hard"});var W=M(H,2),tt=h(W),K=h(tt);Ct(K,{className:"h-full",children:(T,ut)=>{Bt(T,{className:"h-full",children:(Tt,de)=>{var xt=j(),jt=k(xt);{var Ot=G=>{var Q=oe(),st=h(Q),vt=h(st),Rt=h(vt);const qt=x(()=>n().has(t.annotationId));ea(Rt,{onSelect:()=>r(t.annotationId),get isSelected(){return s(qt)}}),f(vt);var yt=M(vt,2);Na(yt,{});var Ft=M(yt,2);ha(Ft,{get width(){return s(g).sample.width},get height(){return s(g).sample.height},get boundingBox(){return s(B)},children:(Kt,ce)=>{var At=ne(),It=k(At),ft=M(It);let wt;var zt=h(ft);na(zt,()=>s(g).annotation_id,mt=>{_a(mt,{get annotation(){return s(g)},showLabel:!0,get imageWidth(){return s(g).sample.width}})}),f(ft),L(mt=>{et(It,"href",s(w)),wt=oa(ft,0,"",null,wt,mt)},[()=>({invisible:o()})]),c(Kt,At)},$$slots:{default:!0}}),f(st),f(Q),c(G,Q)},Ht=G=>{var Q=se(),st=h(Q);Et(st,{size:"large",align:"center"}),f(Q),c(G,Q)};F(jt,G=>{s(g)?G(Ot):G(Ht,!1)})}c(Tt,xt)},$$slots:{default:!0}})},$$slots:{default:!0}}),f(tt);var bt=M(tt,2),Lt=h(bt);qa(Lt,{get annotationId(){return t.annotationId},get isPrediction(){return t.isPrediction}}),f(bt),f(W),f(E),c(i,E),$(),l()}var le=I('<div class="flex h-full w-full space-x-4 px-4 pb-4" data-testid="annotation-details"><div class="h-full w-full space-y-6 rounded-[1vw] bg-card p-4"><!></div></div>');function Le(i,t){const e=x(()=>t.data.sample),l=x(()=>t.data.annotationId),a=x(()=>t.data.isPrediction),n=x(()=>t.data.dataset),o=x(()=>t.data.annotationIndex);var r=le(),u=h(r),d=h(u);{var m=b=>{ie(b,{get annotationId(){return s(l)},get annotationIndex(){return s(o)},get dataset(){return s(n)},get isPrediction(){return s(a)},get sample(){return s(e)}})};F(d,b=>{s(e)&&s(l)&&s(n)&&b(m)})}f(u),f(r),c(i,r)}export{Le as component,De as universal};
