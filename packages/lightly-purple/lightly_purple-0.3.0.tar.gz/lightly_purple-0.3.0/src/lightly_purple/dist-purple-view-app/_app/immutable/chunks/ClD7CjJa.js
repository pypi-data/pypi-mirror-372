import"./CWj6FrbW.js";import{p as U,c as V,g as t,d as z,r as F,t as Y,a as q,F as u,P as I,u as N,f as oe,s as re}from"./Bzf_CGVu.js";import{n as ke,a as g,t as j,c as de}from"./DudhA4Qw.js";import{a as l,s as fe,i as me}from"./CMIc6HKa.js";import{u as Le,e as Me,i as We,s as O,a as ze,c as Ee,b as Ge,d as Be,f as De,g as Te,h as Ne,G as Ue,j as Ye,S as qe,k as Je}from"./CEsXP70Q.js";import{p as ue,r as Ke,a as x,b as Qe}from"./BYXJJYwp.js";import{d as Xe}from"./B9NWxkPv.js";import{u as ge}from"./C2RVOhm1.js";import{o as ve}from"./DVrGeszw.js";import{r as Ze}from"./H7C68rOM.js";import{u as $e}from"./zR0aG0nj.js";import{u as et}from"./dEoPsUJ9.js";import"./69_IOA4Y.js";import"./BoQGZ29z.js";import{u as tt}from"./CnVqPRP3.js";import{P as at}from"./BzArsHZA.js";import{S as st}from"./CQpBBVqJ.js";import{r as it}from"./CGiUvFS7.js";import{l as ce}from"./snYJ8SMg.js";var nt=ke('<svg style="position: absolute; top: 0; left: 0;"><g></g></svg>');function lt(H,e){U(e,!0);const[a,C]=fe(),w=()=>l(P,"$isHidden",a),y=ue(e,"sampleImageObjectFit",3,"contain"),{isHidden:P}=Le(),p=z(()=>e.sample.annotations.filter(v=>v.annotation_type!=="classification"));var s=nt(),o=V(s);let r;Me(o,21,()=>t(p),We,(v,k)=>{st(v,{get annotation(){return t(k)},get showLabel(){return e.showLabel},get imageWidth(){return e.sample.width}})}),F(o),F(s),Y(v=>{O(s,"viewBox",`0 0 ${e.sample.width} ${e.sample.height}`),O(s,"preserveAspectRatio",y()==="contain"?"xMidYMid meet":"xMidYMid slice"),O(s,"width",e.containerWidth),O(s,"height",e.containerHeight),r=ze(o,0,"",null,r,v)},[()=>({invisible:w()})]),g(H,s),q(),C()}var ot=j("<img>");function rt(H,e){U(e,!0);const a=ue(e,"objectFit",3,"contain"),C=Ke(e,["$$slots","$$events","$$legacy","sample","objectFit"]),{class:w,...y}=C,{getDatasetVersion:P}=ge();let p=I("");ve(async()=>{var r;(r=e.sample)!=null&&r.dataset_id&&u(p,x(await P(e.sample.dataset_id)))});var s=ot();let o;Y(r=>o=Ge(s,o,{src:`${at}/sample/${e.sample.sample_id}${t(p)?`?v=${t(p)}`:""}`,alt:e.sample.file_path_abs,class:r,style:`--object-fit: ${a()??""}`,loading:"lazy",...y},"svelte-1c6bz0a"),[()=>Ee("sample-image rounded-lg bg-black",w)]),it(s),g(H,s),q()}var dt=j('<div class="relative"><div class="absolute right-7 top-1 z-10"><!></div> <a data-testid="sample-link" class="block"><!> <!></a></div>'),mt=j('<div slot="noMore"></div>'),ct=j('<div slot="noResults"></div>'),ft=j('<div class="viewport flex-1 svelte-gzepom"><!></div>'),ut=j('<div class="flex h-full w-full items-center justify-center"><div>Loading...</div></div>');function kt(H,e){U(e,!0);const[a,C]=fe(),w=()=>l(pe,"$gridViewSampleRenderingStore",a),y=()=>l(Ie,"$infiniteLoaderIdentifier",a),P=()=>l(Q,"$dimensions",a),p=()=>l(Z,"$isCreateClassifiersPanelOpen",a),s=()=>l($,"$isRefineClassifiersPanelOpen",a),o=()=>l(ee,"$classifierSamples",a),r=()=>l(X,"$metadataValues",a),v=()=>l(e.selectedAnnotationFilterIds,"$selectedAnnotationFilterIds",a),k=()=>l(K,"$tagsSelected",a),J=()=>l(e.textEmbedding,"$textEmbedding",a),_e=()=>l(he,"$selectedSampleIds",a),{gridViewSampleRenderingStore:pe}=Be(),{tagsSelected:K}=tt({dataset_id:e.dataset_id,kind:["sample"]}),{dimensionsValues:Q}=$e(),{metadataValues:X}=et(e.dataset_id),{isCreateClassifiersPanelOpen:Z}=De(),{isRefineClassifiersPanelOpen:$}=Te(),{selectedSampleIds:he,classifierSamples:ee,toggleSampleSelection:be,getDatasetVersion:Se}=ge();let Ie=Xe([e.selectedAnnotationFilterIds,K,Q,X,e.textEmbedding,Z,$,ee],([i,n,_,c,b,M,ie,S])=>i.join(",")+Array.from(n).join(",")+_.min_width+_.max_width+_.min_height+_.max_height+JSON.stringify(c)+(b?b.queryText:"")+(M?"open":"closed")+(ie?"open":"closed")+(S?`${S.positiveSampleIds.join(",")},${S.negativeSampleIds.join(",")}`:"")),A=I(0);const L=100;let m=I(x([])),h=I(null),te=I(!1),E=I(x(w())),G=I(0);ve(async()=>{await Se(e.dataset_id),u(te,!0)}),N(()=>{u(E,x(w()))}),N(()=>{y(),u(m,x([])),u(A,0)}),N(()=>{if(!t(h))return;u(G,x(t(h).clientHeight));const i=new ResizeObserver(()=>{t(h)&&u(G,x(t(h).clientHeight))});return i.observe(t(h)),()=>{i.disconnect()}});async function xe({detail:{loaded:i,complete:n}}){const _=P();let c;if(p()||s()){if(!o()){n();return}const b=[...o().positiveSampleIds,...o().negativeSampleIds];if(b.length===0){n();return}c=await ce({dataset_id:e.dataset_id,limit:L,offset:t(A),sampleIds:b,metadataValues:r()})}else c=await ce({dataset_id:e.dataset_id,limit:L,offset:t(A),annotationLabelIds:v().length>0?v():void 0,tagIds:k().size>0?Array.from(k()):void 0,textEmbedding:J()?J().embedding:void 0,metadataValues:r(),..._});c.data.length?(u(A,t(A)+L),t(m).push(...c.data),c.data.length<L?n():i()):n()}const ae=16,we=Ne(),[ye,gt]=we;var se=de(),Fe=oe(se);{var je=i=>{var n=ft(),_=V(n);const c=z(()=>e.sampleHeight+ae),b=z(()=>e.sampleWidth+ae);Ue(_,{get itemCount(){return t(m).length},get itemHeight(){return t(c)},get itemWidth(){return t(b)},get height(){return t(G)},class:"overflow-none overflow-y-auto dark:[color-scheme:dark]",get style(){return`--sample-width: ${e.sampleWidth??""}px; --sample-height: ${e.sampleHeight??""}px;`},overScan:100,item:(S,d)=>{let f=()=>d==null?void 0:d().index,R=()=>d==null?void 0:d().style;var ne=de(),Ce=oe(ne);{var Pe=B=>{var W=dt(),D=V(W),Ae=V(D);const Re=z(()=>_e().has(t(m)[f()].sample_id));qe(Ae,{onSelect:()=>be(t(m)[f()].sample_id),get isSelected(){return t(Re)}}),F(D);var T=re(D,2),le=V(T);rt(le,{get sample(){return t(m)[f()]},get objectFit(){return t(E)}});var Ve=re(le,2);lt(Ve,{get sample(){return t(m)[f()]},get containerWidth(){return e.sampleWidth},get sampleImageObjectFit(){return t(E)},get containerHeight(){return e.sampleHeight}}),F(T),F(W),Y(Oe=>{Je(W,R()),O(T,"href",Oe)},[()=>ye(Ze.toSample({sampleId:t(m)[f()].sample_id,datasetId:e.dataset_id,sampleIndex:f()}),void 0)]),g(B,W)};me(Ce,B=>{t(m)[f()]&&B(Pe)})}g(S,ne)},footer:S=>{Ye(S,{get identifier(){return y()},$$events:{infinite:xe},$$slots:{noMore:(d,f)=>{var R=mt();g(d,R)},noResults:(d,f)=>{var R=ct();g(d,R)}}})},$$slots:{item:!0,footer:!0}}),F(n),Qe(n,M=>u(h,M),()=>t(h)),g(i,n)},He=i=>{var n=ut();g(i,n)};me(Fe,i=>{t(te)?i(je):i(He,!1)})}g(H,se),q(),C()}export{kt as S};
