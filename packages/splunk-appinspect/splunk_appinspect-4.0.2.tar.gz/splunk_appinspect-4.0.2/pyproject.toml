[tool.pydocstyle]
ignore = ["D202", "D204", "D205", "D208", "D301", "D400", "D401"]
match-dir= "[^contrib|.env|.venv|venv].*"

[tool.black]
target-version = ["py312"] # TODO change to py313 when possible
force-exclude = "venv|inconsistent_tab_space|syntax_error|null_byte|with_hardcoded|malformed|splunklib_dependency_under_bin|has_python_sdk|has_binary_file|tarsec|data|packages|python_analyzer_packages"
line-length = "120"

[tool.isort]
line_length = "120"
profile = "black"
skip = [".poetry", ".venv", "venv", "./build", "./tarsec", "splunklib_dependency_under_bin", "has_python_sdk_old_deep_nested", "has_python_sdk_old", "has_binary_file", "data", "packages", "python_analyzer_packages"]
multi_line_output = "3"
include_trailing_comma = true
force_grid_wrap = "0"
use_parentheses = true

[tool.flake8]
ignore = ["E203", "E266", "E501", "W503", "C901"]
max-line-length = 88
max-complexity = 18
select = ["B", "C", "E", "F", "W", "T4"]
exclude = [
    ".venv*",
    "./build/*",
    "./tarsec/*",
    "./test*dependency*.py",
    "./test*high_memory_usage*.py",
    "./test*ta_dellemc_vmax.py",
    "./test*has_malformed*.py",
    "./test*with_hardcoded*.py",
    "./test*alphabet*.py",
    "./test*load_modules*.py",
    "./test*complicated_topology*.py",
    "./test*two_ssc*.py",
    "./test*multi_children*.py",
    "./test*secret_in_multi_line_url.py",
    "./test*multi_items*.py",
    "./test*multi_parents*.py",
    "./test*import*.py",
    "./test*bin_lib_folder*.py",
    "./test*self_loop*.py",
    "./test*multi_errors*.py",
    "./test*module*.py",
    "./test*basic_python_code*.py",
    "./test*ACD*.py",
    "./test*tab_space*.py",
    "./test*null_byte*.py",
    "./test*syntax_error*.py",
    "./test*has_python_sdk*.py",
    "./test*has_binary_file*.py",
    ]

[project]
dynamic = ["version"]
name = "splunk-appinspect"


[tool.poetry]
name = "splunk-appinspect"
version = "4.0.2" # placeholder - overridden by dynamic versioning
description = "Automatic validation checks for Splunk Apps"
authors = ["Splunk <devsupport-splunk@cisco.com>"]
license = "Proprietary"
homepage = "https://splunk.com"
repository = "https://dev.splunk.com/goto/appinspectdownload"
keywords = ["AppInspect", "Certification", "Splunk", "Splunk AppInspect", "Testing"]
classifiers = [
    "Development Status :: 5 - Production/Stable",
    "Environment :: Console",
    "Intended Audience :: Developers",
    "Intended Audience :: End Users/Desktop",
    "Natural Language :: English",
    "Operating System :: MacOS",
    "Operating System :: Microsoft",
    "Operating System :: Unix",
    "Programming Language :: Python :: 3",
    "Programming Language :: Python :: Implementation :: CPython",
    "Topic :: Software Development :: Testing",
    "Topic :: Utilities",
]
readme = "splunk_appinspect/README.md"
packages = [
    { include = "splunk_appinspect" },
    { include = "tarsec/tarsec" },
]
include = [
    "scripts/splunk-appinspect",
    "splunk_appinspect/version/VERSION.txt",
    "splunk_appinspect/checks/**",
    "splunk_appinspect/templates/*.html",
    { path = "splunk_appinspect/python_analyzer/trustedlibs/lib_files/*.csv", format = ["sdist", "wheel"] },
    "splunk_appinspect/splunk/telemetry/list.csv",
    "splunk_appinspect/splunk/jquery_checks_data/*.json",
    "splunk_appinspect/resources/*.json",
    "tarsec.tarsec"
]

[tool.poetry.dependencies]
python = ">=3.7"
beautifulsoup4 = "4.10.0"
chardet = "3.0.4"
click = ">=8.0.0"
croniter = ">=0.3.34,<2.0.0"
defusedxml = "0.7.1"
jinja2 = ">=3.1.6,<4.0.0"
lxml = ">=5.3.0,<6.0.0"
mako = ">=1.0.12,<2.0.0"
markdown = ">=3.1.1,<4.0.0"
packaging-legacy = "23.0"
painter = ">=0.3.1,<1.0.0"
pyyaml = ">=6.0.1,<7.0.0"
structlog = ">=23.1.0,<=24.4.0"
semver = ">=2.13.0"

# darwin + linux
python-magic = { version = "0.4.24", markers = "sys_platform != 'win32'" }

# windows
python-magic-bin = { version = "0.4.14",  markers = "sys_platform == 'win32'" }
pywin32 = { version = "310", markers="sys_platform == 'win32'" }

[tool.poetry.requires-plugins]
poetry-dynamic-versioning = { version = ">=1.0.0,<2.0.0", extras = ["plugin"] }

[tool.poetry.scripts]
splunk-appinspect = "splunk_appinspect.main:execute"

[tool.poetry-dynamic-versioning]
enable=false

[tool.poetry-dynamic-versioning.from-file]
source = "splunk_appinspect/version/VERSION.txt"

[build-system]
requires = ["poetry-core>=1.6.1,<2.1.4", "poetry-dynamic-versioning==1.8.2"]
build-backend = "poetry_dynamic_versioning.backend"