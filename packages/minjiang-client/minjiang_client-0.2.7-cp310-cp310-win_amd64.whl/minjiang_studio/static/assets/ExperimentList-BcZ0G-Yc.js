import{d as W,c as P,e as g,f as l,I as B,S as Q,T as U,U as rt,a as _t,v as ut,b as dt,V as mt,W as pt,r as w,J as O,o as ft,X as gt,x as E,w as s,h as e,Q as vt,L as yt,B as ht,t as r,j as a,y as kt,Y as j,m as d,Z as wt,$ as bt,a0 as Ct,a1 as Et,a2 as It,a3 as St,n as Tt,p as xt,a4 as Lt,a5 as A,a6 as qt,i as Rt,a7 as Dt,a8 as H,a9 as I,O as Nt,H as Mt,R as zt,aa as Bt,E as Ot}from"./index-CJHu08WN.js";import{a as Pt}from"./task-CM87Uqc3.js";import{s as Vt,g as $t,a as Ft}from"./exp-C62lh81F.js";import{u as Ut}from"./useInterval-B20nE-o6.js";import{_ as jt}from"./Space-2Dxw0REU.js";import{R as At,D as Ht,E as Jt}from"./ExpsTpl-OFJjOD3V.js";import{c as Gt}from"./index-QzDl4DuY.js";import{C as Wt}from"./ChevronBack-Bcy9c0tE.js";import{A as J}from"./Add-mcgiZaHd.js";import"./DynamicForm.vue_vue_type_script_setup_true_lang-C5GYfVCL.js";import"./json-editor-vue-XbQv5odU.js";import"./debounce-hwifx5mx.js";import"./InputNumber-B1LDyqyR.js";import"./Add-DBNoZeg_.js";import"./FormItem-B_ZM_PH0.js";import"./Alert-CW6CUGuq.js";import"./Tabs-CV3jlbM5.js";const Qt={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Xt=W({name:"Eye",render:function(u,i){return g(),P("svg",Qt,i[0]||(i[0]=[l("circle",{cx:"256",cy:"256",r:"64",fill:"currentColor"},null,-1),l("path",{d:"M490.84 238.6c-26.46-40.92-60.79-75.68-99.27-100.53C349 110.55 302 96 255.66 96c-42.52 0-84.33 12.15-124.27 36.11c-40.73 24.43-77.63 60.12-109.68 106.07a31.92 31.92 0 0 0-.64 35.54c26.41 41.33 60.4 76.14 98.28 100.65C162 402 207.9 416 255.66 416c46.71 0 93.81-14.43 136.2-41.72c38.46-24.77 72.72-59.66 99.08-100.92a32.2 32.2 0 0 0-.1-34.76zM256 352a96 96 0 1 1 96-96a96.11 96.11 0 0 1-96 96z",fill:"currentColor"},null,-1)]))}}),G=(S,u)=>{var T;if(!S.length)return;const i=document.createEvent("MouseEvents");i.initEvent("click",!0,!0);const b=S.map(m=>B(Q,{width:100,src:m}));let f=document.querySelector("#preview-image");if(!f){const m=document.createElement("div");m.id="preview-image",document.body.appendChild(m),f=m}b.length>1?U(B(rt,{},[B(jt,{},b)]),f):U(b[0],f),(T=f==null?void 0:f.querySelectorAll(".n-image img")[u])==null||T.dispatchEvent(i)},Yt={class:"flex items-center mb-5 text-xl gap-2"},Zt={class:"inline-flex gap-2"},Kt={class:"flex justify-between"},te={class:"text-lg flex items-center gap-1.5"},ee={class:"break-keep"},se={class:"flex items-center gap-1.5 opacity-75 text-xs"},ae={class:"flex gap-2"},ne={key:2,class:"bg-gray-500 w-20 h-20 rounded text-center leading-4 text-xs flex items-center justify-center text-white"},oe={class:"flex gap-2 flex-col"},ie={class:"flex items-center gap-1"},le={class:"flex justify-around items-center gap-1"},ce=W({__name:"ExperimentList",setup(S){const{t:u}=_t(),i=ut(),b=dt(),f=mt(),T=pt(),m=w(),R=O({}),x=w(!1),X=w(),V=w(),C=O({page:1,per_page:8,total:0}),$=(o,c={})=>{const n=new URLSearchParams({device_group_name:i.query.device_group_name,task_id:i.query.task_id,task_title:i.query.task_title,space_id:i.query.space_id,exp_id:String(o.exp_id),...c});window.open(`/experiment/waveforms?${n.toString()}`,"_blank")},L=w(),Y=async o=>{const[c,n]=await Ft({exp_id:o});if(!c&&(n==null?void 0:n.status)===0)return n.data},D=async o=>{var v;if(!o){if(x.value)return;x.value=!0}const c=i.query.device_group_name;if(!c)return;const[n,_]=await Pt({...((v=X.value)==null?void 0:v.searchParasm)||{},...zt(C),task_id:i.query.task_id,device_group_name:c});if(o||(x.value=!1),!n&&_&&_.status===0){const y=Gt(_.data.list.map(p=>{if(R[p.exp_id]===void 0)return p.exp_id;p.img=R[p.exp_id]}));if(y.length>0){const p=JSON.parse(JSON.stringify(_.data.list));Y(y.join(",")).then(h=>{h&&(Bt(h,(q,z)=>{p.some(k=>{if(k.exp_id===+z)return k.img=q,[I.COMPLETE,I.ERROR,I.CANCELED].includes(k.status)&&(R[k.exp_id]=q),!0})}),L.value=p)})}L.value=_.data.list,C.total=_.data.total}},Z=()=>{b.push({name:"taskList",query:{device_group_name:i.query.device_group_name}})},K=async o=>{const[c,n]=await Vt({exp_id:o.exp_id});!c&&(n==null?void 0:n.status)===0&&T.success("实验终止成功")},tt=o=>{$(o,{dup:"1"})},et=()=>{var o;(o=V.value)==null||o.open()},st=()=>{},{start:at,stop:nt}=Ut(D,{initParams:!0,isManual:!0});ft(()=>{D(),m.value=setTimeout(()=>{at()},5e3)}),gt(()=>{nt(),m.value!==null&&clearInterval(m.value),m.value=null});const N=w(),M=O({}),ot=async o=>{if(M[String(o.exp_id)]){G([M[String(o.exp_id)]],0);return}N.value=o.exp_id;const[c,n]=await $t({exp_id:o.exp_id,device_group_name:i.query.device_group_name,space_id:i.query.space_id});N.value=void 0,!c&&(n==null?void 0:n.status)===0&&(G([n.data.big_picture_url],0),M[String(o.exp_id)]=n.data.big_picture_url)};return(o,c)=>{const n=kt,_=ht,v=Lt,y=qt,p=Rt,h=Dt,q=Q,z=Tt,k=St,F=Ct,it=wt,lt=yt,ct=vt;return g(),E(h,{show:a(x)},{default:s(()=>[e(ct,{"has-sider":""},{default:s(()=>[e(lt,{class:"min-h-[500px]"},{default:s(()=>[l("div",Yt,[e(_,{onClick:Z,quaternary:""},{icon:s(()=>[e(n,{size:"26"},{default:s(()=>[e(a(Wt))]),_:1})]),default:s(()=>[l("span",null,r(a(u)("groupDetail.exps.back")),1)]),_:1}),l("span",{class:"flex-1 text-center",style:j({color:a(f).primaryColor})},r(a(u)("groupDetail.exps.taskTitle",{taskId:a(i).query.task_id,taskTitle:` " ${a(i).query.task_title} " `})),5),l("div",Zt,[e(_,{type:"primary",onClick:et},{default:s(()=>[e(n,null,{default:s(()=>[e(a(J))]),_:1}),d("  "+r(a(u)("groupDetail.exps.createFromTemplate")),1)]),_:1}),e(_,{type:"primary",onClick:st},{default:s(()=>[e(n,null,{default:s(()=>[e(a(J))]),_:1}),d("  "+r(a(u)("groupDetail.exps.createManualTask")),1)]),_:1})])]),e(it,{style:j({maxHeight:a(bt)(a(L))?"200px":"calc(100vh - 350px)"})},{default:s(()=>[e(F,{cols:"4","x-gap":"20","y-gap":"20",class:"py-1 px-1.5"},{default:s(()=>[(g(!0),P(Et,null,It(a(L),t=>(g(),E(k,{key:t.exp_id},{default:s(()=>[e(z,{rounded:"",style:{width:"100%"},"content-class":"!mb-0 !p-2",class:"hover:scale-103 hover:transform-gpu"},{default:s(()=>[l("div",Kt,[l("div",null,[l("div",te,[l("div",ee,r(t.exp_id),1),t!=null&&t.status?(g(),E(v,{key:0,color:{color:a(A)[t.status].color,textColor:"#fff"},bordered:!1,size:"small"},{default:s(()=>[d(r(a(u)(a(A)[t.status].text)),1)]),_:2},1032,["color"])):xt("",!0),e(v,{size:"small",type:"info"},{default:s(()=>[d(r(t==null?void 0:t.progress),1)]),_:2},1024),l("div",se,[e(y,{"line-clamp":1},{default:s(()=>[d(r(t==null?void 0:t.create_time),1)]),_:2},1024)])])])]),e(y,{style:{"max-width":"100%"},class:"text-lg mt-2"},{default:s(()=>[d(r(t==null?void 0:t.title),1)]),_:2},1024),e(p,{class:"!my-3"}),l("div",ae,[l("div",null,[(t==null?void 0:t.img)===void 0?(g(),E(h,{key:0,show:!0},{default:s(()=>c[1]||(c[1]=[l("div",{class:"w-20 h-20 rounded"},null,-1)])),_:1})):t!=null&&t.img?(g(),E(h,{key:1,show:a(N)===t.exp_id},{default:s(()=>[e(q,{class:"w-20 h-20 rounded cursor-pointer",src:t==null?void 0:t.img,"preview-disabled":!0,onClick:()=>ot(t)},null,8,["src","onClick"])]),_:2},1032,["show"])):(g(),P("div",ne,r(a(u)("groupDetail.exps.noresult")),1))]),l("div",oe,[l("div",ie,[e(v,{type:"warning",size:"small"},{default:s(()=>[d(r((t==null?void 0:t.template_name)==="-"?"No Template":t==null?void 0:t.template_name),1)]),_:2},1024)]),e(y,{style:{"max-width":"100%"},class:"opacity-75 text-xs","line-clamp":3},{default:s(()=>[d(r(t==null?void 0:t.description),1)]),_:2},1024)])]),e(p,{class:"!my-3"}),l("div",le,[e(_,{disabled:![a(I).RUNNING,a(I).HOST_DOWNLOADED].includes(t.status),type:"info",size:"small",class:"flex-1 !px-0.5",onClick:H(()=>K(t),["stop"])},{icon:s(()=>[e(a(At))]),default:s(()=>[d(" "+r(a(u)("groupDetail.exps.stop")),1)]),_:2},1032,["disabled","onClick"]),e(_,{type:"info",size:"small",class:"flex-1",onClick:H(()=>tt(t),["stop"]),disabled:(t==null?void 0:t.exp_mode)==="batch_circuit"},{icon:s(()=>[e(a(Ht))]),default:s(()=>[d(r(a(u)("expInfo.duplicate"))+" ",1)]),_:2},1032,["onClick","disabled"]),e(_,{type:"info",size:"small",class:"flex-1",disabled:(t==null?void 0:t.exp_mode)==="batch_circuit",onClick:()=>$(t)},{icon:s(()=>[e(a(Xt))]),default:s(()=>[d(r(a(u)("groupDetail.exps.preview"))+" ",1)]),_:2},1032,["disabled","onClick"])])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1},8,["style"]),e(Nt,{"page-info":a(C),"onUpdate:pageInfo":c[0]||(c[0]=t=>Mt(C)?C.value=t:null),"page-sizes":[8,16,24],onUpdateList:D,class:"!pb-0"},null,8,["page-info"]),e(Jt,{ref_key:"expsTplRef",ref:V},null,512)]),_:1})]),_:1})]),_:1},8,["show"])}}}),Se=Ot(ce,[["__scopeId","data-v-0a4982ff"]]);export{Se as default};
