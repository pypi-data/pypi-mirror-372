import{l as w}from"./jupyterlab-C2EV-Dpr.js";import{d as P,aF as F,aL as V,r as u,f as D,U as A,W as R,y as g,E as s,B as l,u as t,G as d,I as i,z as b,o as y,aP as z,L as U,a4 as a,a3 as p,M as C,$ as h,a8 as N,aO as G}from"./primevue-1TEWPnDt.js";const K={id:"admin"},O={style:{"margin-right":"3rem",display:"flex","justify-content":"right","justify-items":"center"}},q={style:{"margin-top":"auto","margin-bottom":"auto","font-weight":"bolder","font-size":"larger"}},H={class:"stats"},W={class:"stats-tables"},J={class:"header"},Q={style:{"font-size":"large"}},X={class:"context-config"},se=P({__name:"BeakerAdmin",props:["config"],setup(Y){const B=F(),L=V(),_=w.PageConfig.getBaseUrl(),r=u({}),S=u(),T=u("never"),m=u("---"),v=u([]),x=u([]),j=D(()=>r.value.sessions?.map(e=>({session_id:e.path,raw_id:e.id,kernel:e.kernel,subkernel:e.subkernel,last_active:e.kernel.last_activity,idle:((Date.now()-Date.parse(e.kernel.last_activity))/6e4).toFixed(2),connected:e.kernel.connections>0,process_info:e.process_info,context:e.kernel.context?.name,context_config:e.kernel.context?.config}))),k=D(()=>x.value.map(o=>o.session_id)),c=async()=>{const o=w.URLExt.join(_,"/stats"),e=await fetch(o);r.value=await e.json(),T.value=new Date().toUTCString()},E=async o=>{for(const e of o){const n=w.URLExt.join(_,"/api/sessions/",e),f=await fetch(n,{method:"DELETE",headers:{Authorization:`token ${r.value.token}`}});if(!f.ok){const M=await f.text();L.add({severity:"error",summary:"Error removing session",detail:`${f.status} ${f.statusText} - ${M}`,life:3e3})}}await c()},I=()=>{v.value.length===0||m.value==="---"||m.value==="destroy"&&$(v.value)},$=o=>{B.require({message:`Are you sure you want to proceed? This will destroy session(s): ${o.map(e=>e.session_id).join(", ")}`,header:"Confirmation",icon:"pi pi-exclamation-triangle",rejectClass:"p-button-secondary p-button-outlined",rejectLabel:"Cancel",acceptLabel:"Confirm",accept:async()=>{await E(o.map(e=>e.raw_id))},reject:()=>{}})};return A(()=>{c(),S.value=window.setInterval(c,6e4)}),R(()=>{clearInterval(S.value)}),(o,e)=>(y(),g(b,null,[s(t(z)),l("div",K,[l("div",null,[e[4]||(e[4]=l("h1",{style:{"text-align":"center"}},"Beaker admin",-1)),l("div",O,[l("span",q,"Last updated: "+d(T.value),1),s(t(U),{icon:"pi pi-refresh",style:{"margin-left":"1rem"},raised:"",onClick:e[0]||(e[0]=n=>c())})])]),l("div",H,[e[9]||(e[9]=l("h2",null,"Stats",-1)),l("div",W,[s(t(p),{value:[r.value.file_handles]},{header:i(()=>e[5]||(e[5]=[l("div",{class:"header"},[l("span",{class:"header-title"},"File Handles")],-1)])),default:i(()=>[s(t(a),{field:"open",header:"Open"}),s(t(a),{field:"total",header:"Total"}),s(t(a),{field:"usage",header:"Usage"})]),_:1},8,["value"]),s(t(p),{value:[r.value.load]},{header:i(()=>e[6]||(e[6]=[l("div",{class:"header"},[l("span",{class:"header-title"},"Load")],-1)])),default:i(()=>[s(t(a),{field:"1_min",header:"1 Min"}),s(t(a),{field:"5_min",header:"5 Min"}),s(t(a),{field:"15_min",header:"15 Min"})]),_:1},8,["value"]),s(t(p),{value:[r.value.memory]},{header:i(()=>e[7]||(e[7]=[l("div",{class:"header"},[l("span",{class:"header-title"},"Memory")],-1)])),default:i(()=>[s(t(a),{field:"total",header:"Total"}),s(t(a),{field:"used",header:"Used"}),s(t(a),{field:"free",header:"Free"}),s(t(a),{field:"usage",header:"Usage"})]),_:1},8,["value"]),s(t(p),{value:[r.value.disk]},{header:i(()=>e[8]||(e[8]=[l("div",{class:"header"},[l("span",{class:"header-title"},"Disk")],-1)])),default:i(()=>[s(t(a),{field:"total",header:"Total"}),s(t(a),{field:"used",header:"Used"}),s(t(a),{field:"free",header:"Free"}),s(t(a),{field:"usage",header:"Usage"})]),_:1},8,["value"])])]),l("div",null,[e[22]||(e[22]=l("h2",null,"Sessions",-1)),s(t(p),{value:j.value,selection:v.value,"onUpdate:selection":e[2]||(e[2]=n=>v.value=n),"expanded-rows":x.value,"onUpdate:expandedRows":e[3]||(e[3]=n=>x.value=n),"striped-rows":!0,removableSort:""},{header:i(()=>[l("div",J,[e[11]||(e[11]=l("span",{class:"header-title"},"Sessions",-1)),e[12]||(e[12]=l("span",{style:{flex:"100"}},null,-1)),l("span",Q,"Session count: "+d(r.value.sessions?.length||0),1),e[13]||(e[13]=l("span",{style:{padding:"0 1rem"}}," | ",-1)),s(t(N),{options:["---","destroy"],modelValue:m.value,"onUpdate:modelValue":e[1]||(e[1]=n=>m.value=n)},null,8,["modelValue"]),s(t(U),{severity:"success",raised:"",onClick:I},{default:i(()=>e[10]||(e[10]=[h("Go")])),_:1})])]),expansion:i(({data:n})=>[l("div",null,[e[21]||(e[21]=l("h4",null,[h("Process details "),l("span",{style:{"font-size":"smaller","margin-left":"3rem"}},"(Note: CPU and Memory usage may be reflected mulitple times due to parent/child relational reporting)")],-1)),s(t(p),{value:n.process_info,"striped-rows":!0,removableSort:""},{default:i(()=>[s(t(a),{field:"pid",header:"PID",sortable:""}),s(t(a),{field:"ppid",header:"Parent PID",sortable:""}),s(t(a),{field:"cpu_pct",header:"CPU Usage %",sortable:""}),s(t(a),{field:"cputime",header:"Cumulative CPU Time",sortable:""}),s(t(a),{field:"mem_pct",header:"Mem Usage (%)",sortable:""}),s(t(a),{field:"mem_bytes",header:"Mem Usage (bytes)",sortable:""}),s(t(a),{field:"threads",header:"Thread count",sortable:""}),s(t(a),{field:"open_files",header:"File handles",sortable:""}),s(t(a),{field:"cmd",header:"Full command",sortable:""})]),_:2},1032,["value"])])]),default:i(()=>[s(t(a),{class:"selection-column","selection-mode":"multiple"}),s(t(a),{class:"expansion-column",expander:""}),s(t(a),{field:"kernel.id",header:"Beaker Kernel",sortable:""},{body:i(({data:n})=>[l("div",null,d(n.session_id),1),k.value.includes(n.session_id)?(y(),g(b,{key:0},[e[15]||(e[15]=l("br",null,null,-1)),l("div",null,[e[14]||(e[14]=l("span",{style:{"font-weight":"bold"}},"Kernel ID:",-1)),h(" "+d(n.kernel.id),1)])],64)):C("",!0)]),_:1}),s(t(a),{header:"Subkernel",field:"subkernel.id",sortable:""},{body:i(({data:n})=>[l("div",null,d(n.subkernel.id),1),k.value.includes(n.session_id)?(y(),g(b,{key:0},[e[17]||(e[17]=l("br",null,null,-1)),l("div",null,[e[16]||(e[16]=l("span",{style:{"font-weight":"bold"}},"Type:",-1)),h(" "+d(n.subkernel.name),1)])],64)):C("",!0)]),_:1}),s(t(a),{header:"Current Context",field:"context",sortable:""},{body:i(({data:n})=>[l("div",null,d(n.context),1),k.value.includes(n.session_id)?(y(),g(b,{key:0},[e[18]||(e[18]=l("br",null,null,-1)),e[19]||(e[19]=l("span",{style:{"font-weight":"bold"}},"Config:",-1)),e[20]||(e[20]=l("br",null,null,-1)),l("div",X,d(n.context_config),1)],64)):C("",!0)]),_:1}),s(t(a),{field:"last_active",header:"Last Active",sortable:""}),s(t(a),{field:"idle",header:"Idle Duration (min)",sortable:""}),s(t(a),{field:"connected",header:"User connected",sortable:""}),s(t(a),{header:"Destroy"},{body:i(({data:n})=>[s(t(U),{style:{height:"2rem",width:"2rem","text-align":"center"},icon:"pi pi-times",severity:"danger",raised:"",onClick:f=>$([{session_id:n.session_id,raw_id:n.raw_id}])},null,8,["onClick"])]),_:1})]),_:1},8,["value","selection","expanded-rows"])])]),s(t(G),{position:"bottom-right"})],64))}});export{se as default};
