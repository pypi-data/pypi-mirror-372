import{_ as E,j as t,b as S,c as F,r as x,M as O,F as R,K as B,w as U}from"./index-DyO0UDjL.js";import{B as W,s as $}from"./browse-BtsT-niR.js";import{f as w,u as I,s as H,c as V,g as K,T as Z,v as L,a as P,b as M,d as q,e as N,h as _,G as v,i as J,j as Q,k as X,l as Y,D as ee}from"./DataGrid-B9kibQ7O.js";import"./toPropertyKey-DCwh5dYN.js";import"./FormControlLabel-DznhDAwM.js";import"./Input-CDkFTjZA.js";import"./Stack-Dc0uk6AB.js";import"./Tooltip-DqrpFdTD.js";import"./Checkbox-GTVZdQnO.js";const te=["className","children"],se=o=>{const{classes:p}=o;return V({root:["toolbarContainer"]},K,p)},oe=H(Z,{name:"MuiDataGrid",slot:"ToolbarContainer",shouldForwardProp:o=>o!=="ownerState"})({display:"flex",alignItems:"center",flexWrap:"wrap",gap:L.spacing(1),padding:L.spacing(.5),minHeight:"auto"}),ne=w(function(p,g){const{className:c,children:e}=p,d=E(p,te),n=I(),s=se(n);return e?t.jsx(oe,S({className:F(s.root,c),ownerState:n},d,{ref:g,children:e})):null}),ae=w(function(p,g){var a,C;const{slotProps:c={}}=p,e=c.button||{},d=c.tooltip||{},n=P(),s=P(),u=M(),f=I(),{columnsPanelTriggerRef:l}=q(),r=N(u,J),i=_(g,l),b=m=>{var j;r.open&&r.openedPanelValue===v.columns?u.current.hidePreferences():u.current.showPreferences(v.columns,s,n),(j=e.onClick)==null||j.call(e,m)};if(f.disableColumnSelector)return null;const h=r.open&&r.panelId===s;return t.jsx(f.slots.baseTooltip,S({title:u.current.getLocaleText("toolbarColumnsLabel"),enterDelay:1e3},(a=f.slotProps)==null?void 0:a.baseTooltip,d,{children:t.jsx(f.slots.baseButton,S({id:n,size:"small","aria-label":u.current.getLocaleText("toolbarColumnsLabel"),"aria-haspopup":"menu","aria-expanded":h,"aria-controls":h?s:void 0,startIcon:t.jsx(f.slots.columnSelectorIcon,{})},(C=f.slotProps)==null?void 0:C.baseButton,e,{onPointerUp:m=>{var j;r.open&&m.stopPropagation(),(j=e.onPointerUp)==null||j.call(e,m)},onClick:b,ref:i,children:u.current.getLocaleText("toolbarColumns")}))}))}),le=w(function(p,g){var D,G;const{slotProps:c={}}=p,e=c.button||{},d=c.tooltip||{},n=M(),s=I(),u=N(n,Y),f=P(),l=P(),[r,i]=x.useState(!1),b=x.useRef(null),h=_(g,b),a=[{icon:t.jsx(s.slots.densityCompactIcon,{}),label:n.current.getLocaleText("toolbarDensityCompact"),value:"compact"},{icon:t.jsx(s.slots.densityStandardIcon,{}),label:n.current.getLocaleText("toolbarDensityStandard"),value:"standard"},{icon:t.jsx(s.slots.densityComfortableIcon,{}),label:n.current.getLocaleText("toolbarDensityComfortable"),value:"comfortable"}],C=x.useMemo(()=>{switch(u){case"compact":return t.jsx(s.slots.densityCompactIcon,{});case"comfortable":return t.jsx(s.slots.densityComfortableIcon,{});default:return t.jsx(s.slots.densityStandardIcon,{})}},[u,s]),m=y=>{var T;i(A=>!A),(T=e.onClick)==null||T.call(e,y)},j=()=>{i(!1)},k=y=>{n.current.setDensity(y),i(!1)};if(s.disableDensitySelector)return null;const z=a.map((y,T)=>t.jsx(s.slots.baseMenuItem,{onClick:()=>k(y.value),selected:y.value===u,iconStart:y.icon,children:y.label},T));return t.jsxs(x.Fragment,{children:[t.jsx(s.slots.baseTooltip,S({title:n.current.getLocaleText("toolbarDensityLabel"),enterDelay:1e3},(D=s.slotProps)==null?void 0:D.baseTooltip,d,{children:t.jsx(s.slots.baseButton,S({size:"small",startIcon:C,"aria-label":n.current.getLocaleText("toolbarDensityLabel"),"aria-haspopup":"menu","aria-expanded":r,"aria-controls":r?l:void 0,id:f},(G=s.slotProps)==null?void 0:G.baseButton,e,{onClick:m,ref:h,children:n.current.getLocaleText("toolbarDensity")}))})),t.jsx(Q,{open:r,target:b.current,onClose:j,position:"bottom-end",children:t.jsx(s.slots.baseMenuList,{id:l,className:X.menuList,"aria-labelledby":f,autoFocusItem:r,children:z})})]})});function re(){return t.jsxs(ne,{children:[t.jsx(ae,{}),t.jsx(le,{})]})}const ie=10,ce=o=>{let p=O();const g=[{field:"id",headerName:"ID",flex:1,hide:!o.defaultColumns.includes("id")}];o.columns.map(l=>g.push({field:l.field,headerName:l.header,flex:1,hide:!o.defaultColumns.includes(l.field)}));const c=x.useContext(R),[e,d]=x.useState({page:0,pageSize:ie,rows:[],loading:!1}),[n,s]=x.useState({}),[u,f]=x.useState(0);return x.useEffect(()=>{let l=!0;async function r(){let i,b;const h=new AbortController;o.columns.length===0?(b=[],i=null):(b=["metadata"],i="{"+o.columns.map(m=>`${m.field}:${m.select_metadata}`).join(",")+"}");const a=await $(c.api_url,o.segments,h.signal,b,i,e.pageSize*e.page,e.pageSize);return f(a.meta.count),a.data}return(async()=>{d(a=>({...a,loading:!0}));const i=await r(),b={};i.map(a=>(b[a.id]=a.attributes.ancestors,null));const h=i.map(a=>{const C={};return C.id=a.id,o.columns.map(m=>(C[m.field]=a.attributes.metadata[m.field],null)),C});l&&(s(b),d(a=>({...a,loading:!1,rows:h})))})(),()=>{l=!1}},[e.page,e.pageSize,o.columns,o.segments]),t.jsx(W,{sx:{my:4},children:t.jsx(B,{maxWidth:"lg",children:t.jsx(ee,{columns:g,pagination:!0,rowCount:u,...e,paginationMode:"server",pageSizeOptions:[10,30,100],onPaginationModelChange:({page:l,pageSize:r})=>{d(i=>({...i,page:l,pageSize:r}))},onRowClick:l=>{p(`/browse${n[l.id].map(function(r){return"/"+r}).join("")}/${l.id}`)},slots:{toolbar:re},disableColumnFilter:!0,autoHeight:!0})})})},he=o=>{const c=(x.useContext(R).specs||[]).find(n=>o.item.data.attributes.specs.includes(n.spec));let e,d;return c===void 0?(e=[],d=["id"]):(e=c.columns,d=c.default_columns),t.jsxs(B,{maxWidth:"lg",children:[t.jsx(U,{id:"table-title",variant:"h6",component:"h2",children:"Contents"}),t.jsx(ce,{segments:o.segments,specs:o.item.data.attributes.specs,columns:e,defaultColumns:d})]})};export{he as default};
