# Capacity Web Package - UV æé€Ÿå·¥ä½œæµ âš¡
# åŸºäº uv çš„ç°ä»£åŒ– Python åŒ…å¼€å‘

.PHONY: sync test build publish clean dev format lint check release

# ğŸš€ åˆå§‹åŒ–é¡¹ç›® (ä»…éœ€è¿è¡Œä¸€æ¬¡)
init:
	@echo "ğŸ‰ ä½¿ç”¨ uv åˆå§‹åŒ–é¡¹ç›®..."
	uv sync
	@echo "âœ… é¡¹ç›®åˆå§‹åŒ–å®Œæˆï¼"

# ğŸ“¦ åŒæ­¥ä¾èµ– (è¶…å¿«é€Ÿåº¦)
sync:
	@echo "âš¡ åŒæ­¥ä¾èµ–..."
	uv sync

# ğŸ§ª è¿è¡Œæµ‹è¯• (UV ç¯å¢ƒ)
test:
	@echo "ğŸ§ª è¿è¡Œæµ‹è¯•..."
	uv run python tests/test_search.py
	@echo "ğŸ§ª è¿è¡Œ pytest..."
	uv run pytest tests/ -v

# ğŸš€ å¼€å‘æ¨¡å¼æµ‹è¯•
dev:
	@echo "ğŸš€ å¼€å‘æ¨¡å¼æµ‹è¯•..."
	uv run python -c "from capacity_web import search_with_nextchat; print('âœ… å¯¼å…¥æˆåŠŸ')"
	uv run python -c "from capacity_web import search_with_nextchat; result = search_with_nextchat('test', max_results=1); print(f'æµ‹è¯•ç»“æœ: {result[\"success\"]}')"

# ğŸ”¨ æ„å»ºåŒ… (UV åŸç”Ÿæ„å»º)
build:
	@echo "ğŸ”¨ ä½¿ç”¨ uv æ„å»ºåŒ…..."
	uv build

# ğŸ§ª å‘å¸ƒåˆ° TestPyPI (UV åŸç”Ÿ)
test-publish:
	@echo "ğŸ§ª å‘å¸ƒåˆ° TestPyPI..."
	uv publish --repository testpypi

# ğŸš€ å‘å¸ƒåˆ° PyPI (UV åŸç”Ÿ)
publish:
	@echo "ğŸš€ å‘å¸ƒåˆ° PyPI..."
	uv publish

# ğŸ¢ å‘å¸ƒåˆ°ç§æœ‰ä»“åº“
publish-private:
	@echo "ğŸ¢ å‘å¸ƒåˆ°ç§æœ‰ä»“åº“..."
	uv publish --repository-url http://your-private-pypi.com/simple/

# ğŸ§¹ æ¸…ç†æ„å»ºæ–‡ä»¶
clean:
	@echo "ğŸ§¹ æ¸…ç†æ„å»ºæ–‡ä»¶..."
	rm -rf build/
	rm -rf dist/
	rm -rf *.egg-info/
	rm -rf .uv_cache/
	find . -type d -name __pycache__ -delete
	find . -type f -name "*.pyc" -delete

# ğŸ“Š ä»£ç è´¨é‡æ£€æŸ¥
lint:
	@echo "ğŸ“Š ä»£ç è´¨é‡æ£€æŸ¥..."
	uv run ruff check .
	uv run mypy capacity_web/

# ğŸ¨ ä»£ç æ ¼å¼åŒ–
format:
	@echo "ğŸ¨ ä»£ç æ ¼å¼åŒ–..."
	uv run ruff format .

# âœ… å®Œæ•´æ£€æŸ¥
check: lint test
	@echo "âœ… æ‰€æœ‰æ£€æŸ¥é€šè¿‡ï¼"

# ğŸ‰ å®Œæ•´å‘å¸ƒæµç¨‹ (æé€Ÿç‰ˆ)
release: clean check build test-publish
	@echo "ğŸ‰ ç‰ˆæœ¬å‘å¸ƒå®Œæˆ! æ£€æŸ¥ TestPyPI åè¿è¡Œ 'make publish' å‘å¸ƒåˆ°æ­£å¼ PyPI"

# âš¡ æ·»åŠ ä¾èµ– (ç¤ºä¾‹)
add-dep:
	@echo "ç¤ºä¾‹: uv add requests"
	@echo "ç¤ºä¾‹: uv add --dev pytest-cov"

# ğŸ”„ æ›´æ–°æ‰€æœ‰ä¾èµ–
update:
	@echo "ğŸ”„ æ›´æ–°æ‰€æœ‰ä¾èµ–..."
	uv sync --upgrade

# ğŸ“‹ æ˜¾ç¤ºä¾èµ–æ ‘
tree:
	@echo "ğŸ“‹ ä¾èµ–æ ‘..."
	uv tree

# ğŸ¯ å¿«é€Ÿå¼€å§‹ (æ–°å¼€å‘è€…)
quickstart: init test dev
	@echo "ğŸ¯ å¿«é€Ÿå¼€å§‹å®Œæˆï¼å¯ä»¥å¼€å§‹å¼€å‘äº†"
