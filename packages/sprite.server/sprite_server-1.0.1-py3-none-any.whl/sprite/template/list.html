<!DOCTYPE html>
<html lang="en">
  <head>
    <title>List</title>
    {% include 'common.html' %}
    <style>
      body {
        width: 100%;
        height: 100%;
        padding: 1rem;
        overflow: auto;
      }

      a {
        text-decoration: none;
      }

      .stratosphere {
        z-index: 9999 !important;
      }

      .upload-parent {
        align-items: center;
      }

      table td {
        padding: 0 8px;
        word-break: keep-all;
        white-space: nowrap;
      }

      table img {
        height: 25px;
      }

      .modal .modal-header {
        border-bottom: none;
      }

      .modal .modal-body {
        padding-top: 0;
        padding-bottom: 0;
      }

      .modal .modal-footer {
        border-top: none;
      }

      .drop-box {
        width: 100%;
        height: 200px;
        border: 3px dashed #e5e5e5;
        text-align: center;
        color: #c6c6c6;
        flex-flow: column;
        justify-content: space-between;
      }

      .drop-over {
        background-color: #e8e8e8;
      }
    </style>
    <script>
      var messages = {
        dragText: "Drag the files here.",
        dragEnterText: "Please release mouse.",
        uploadSuccessfulText: "{0} file(s) uploaded successfully.",
        uploadFailedText: "{0} file(s) failed to upload.",
        uploadSuccessfulFailedText:
          "{0} file(s) failed to upload and {1} succeeded.",
      };

      $(function () {
        var successfulCount = 0;
        var failedCount = 0;
        var dragID = $("#dragID");
        dragID.children("span").text(messages.dragText);

        dragID.children("button").click(function () {
          var inputFile = dragID.find("[type='file']");
          inputFile.val("");
          inputFile[0].click();
        });

        dragID.find("[type='file']").on("change", function () {
          uploadFiles(this.files);
        });

        dragID.on("dragenter", function () {
          $(this).children().addClass("pe-none");
          $(this).children("span").text(messages.dragEnterText);
          $(this).addClass("drop-over");
        });

        dragID.on("dragover", function () {
          return false;
        });

        dragID.on("dragleave", function () {
          $(this).children().removeClass("pe-none");
          $(this).children("span").text(messages.dragText);
          $(this).removeClass("drop-over");
        });

        dragID.on("drop", function (event) {
          var files = event.originalEvent.dataTransfer.files;
          uploadFiles(files);
          $(this).children().removeClass("pe-none");
          $(this).children("span").text(messages.dragText);
          $(this).removeClass("drop-over");
          return false;
        });

        $("#uploadModalID").on("show.bs.modal", function () {
          var fileListID = $("#fileListID");
          fileListID.addClass("d-none");
          fileListID.children(".card-body").empty();
        });

        $("#uploadModalID").on("hide.bs.modal", function () {
          window.location.reload();
        });

        function uploadFiles(files) {
          successfulCount = 0;
          failedCount = 0;
          if (files.length === 0) {
            return false;
          } else {
            var fileListID = $("#fileListID");
            var fileListBody = fileListID.children(".card-body");
            fileListBody.empty();
            var fileTemplate = `<div class="row">
                  <div class="col-6">{0}</div>
                  <div class="col-6 d-flex flex-column justify-content-center">
                    <div class="progress">
                      <div class="progress-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                  </div>
                </div>`;
            for (var file of files) {
              var fileRow = $(format(fileTemplate, file.name, files.length));
              fileListBody.append(fileRow);
              var formData = new FormData();
              formData.append(file.name, file);
              executeUpload(formData, fileRow, files.length);
            }
            fileListID.removeClass("d-none");
          }
        }

        function executeUpload(formData, element, length) {
          var request = $.ajax({
            url: window.location.pathname,
            type: "POST",
            cache: false,
            data: formData,
            processData: false,
            contentType: false,

            xhr: function () {
              var xhr = $.ajaxSettings.xhr();
              if (onProgress && xhr.upload) {
                xhr.upload.addEventListener(
                  "progress",
                  function (event) {
                    onProgress(event, element.find(".progress-bar"));
                  },
                  false
                );
                return xhr;
              }
            },
            success: function () {
              successfulCount++;
            },
            error: function () {
              failedCount++;
              element.first().addClass("text-danger");
              progressBar = element.find(".progress-bar");
              progressBar.html("0%");
              progressBar.css("width", "0");
            },
            complete: function () {
              if (successfulCount === length) {
                var text = format(
                  messages.uploadSuccessfulText,
                  successfulCount
                );
                showToast("uploadSuccessToastID", text);
              } else if (failedCount === length) {
                var text = format(messages.uploadFailedText, failedCount);
                showToast("uploadFailedToastID", text);
              } else if (failedCount + successfulCount === length) {
                var text = format(
                  messages.uploadSuccessfulFailedText,
                  failedCount,
                  successfulCount
                );
                showToast("uploadSuccessfulFailedToastID", text);
              }
            },
          });

          function onProgress(event, progressBar) {
            var loaded = event.loaded;
            var total = event.total;
            var per = Math.floor((100 * loaded) / total);
            progressBar.html(per + "%");
            progressBar.css("width", per + "%");
          }
        }

        function showToast(id, text) {
          var uploadSuccessToastID = $("#" + id);
          uploadSuccessToastID.find(".toast-body").text(text);
          uploadSuccessToastID.toast("show");
        }
      });
    </script>
  </head>

  <body>
    <div class="row">
      <div class="col-8">
        <h1>Sprite Server</h1>
      </div>
      <div class="col-4 d-flex upload-parent">
        <button
          type="button"
          class="btn btn-primary ms-auto me-0"
          data-bs-toggle="modal"
          data-bs-target="#uploadModalID"
        >
          Upload
        </button>
      </div>
    </div>
    <hr />
    <table>
      <tr>
        <td>
          <a href="../">
            <img
              alt="upper"
              src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAgCAYAAAABtRhCAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAANKSURBVEhL7ZVtSBRBGMdnZvf27O708vIlkrKyMAski14x6I0+FBRWlBERvSEUChVF1NcIQiqhKEujgiAyiIryQ2CklpYpFoWGVBSZppbX5cvu3e7O9OzeeHndden5Lfxxw8z+Z3b+s/M8M4dGGeX/4VL9agdvjgjC64icrJ6+o6vvbXPh0zkuLkXNPw0Ln6RtokwrRggnKFpPLJejJqLhmZq0NYypV6ApIcTgx7C/Z1iMgRLjb0YwLKpNXakz7w2EsY1LAJgOHxmK4m/CPvE6iLPPUrM1qt2njDh1RpBOCaIMU8qkCoTHtDEqtsqq8iJemlR9eOmDbv7akAgxLK6bkunT5Yc6E5LBEA0yhLYABWrdYn44ZhZZ0/Htfq96qmhtXSOfIiJBhhfrUtJVqlaAUYoxeXhDgjQNI1X3F6sQh2IsDs3T339B9VqOnttY2cunC0sghqX1E1Ip8pVjjFK49G8gpH3eXtTp6RSdNkd+jBWXb7s2L4H3hsU0vP4qQ6DMdwlmmGqqw4Qyhj5/a0dWybIkyRV7f0NJVjzvCsE09GrdRtrPNpUAAxn5Z2b+PVM/dXxFNklaMME1tmTr5WUCSKK/5zem4a65HZC6QhE0o8r7AYyXW760o0SnYz0WfNvhMSQpAzF0WqcVYkTgRhkZOqVg2oEnJTuPLSyYGXIzBQw3Z9ZoArIVwKKucSlqPL0yUnzq1IkZzm1cChAwNNgz/6NmE5PzwPQul4Jg5t1GWjEmFQQLt0RiuYlhLJR6jPGPwRH59NWNxic48uwuazqXjJiGv2lKG7LsPd7OO3AO4XqD80fNM6lKwtgVh7IbqvmwIE493kua2xtn/ZSVdbKs71J8bPL0lCRWde9j7pvr78tgiPFxcKLDsHtuY59I7BthvZVcMpZGCSat/CmEg0vP09Itta/LdjYeTx03IwN2otDdI7PEtNjlYDKRDwve0sHkL2zxEOLIAafnXAIoryNzLrdMsUnOI+6fvqtxrpg5ot1iyOZ+/9XQ4MCiZreF2NfD1zUZAdTZ0AwN7uyrooqCTrR97yWiTdS5HNnQYP/ipjaJ2FdBYpQQjLu4PCRenn73wfNIzunvko2/qBGd8eFg7Ke5p6OMEgUI/QJMXEAnCyWQnAAAAABJRU5ErkJggg=="
            />
          </a>
        </td>
        <td>({{ parent.permission }})</td>
        <td>{{ parent.modification }}</td>
        <td></td>
        <td>
          <a href="../">../</a>
        </td>
      </tr>
      {% for item in directories %}
      <tr>
        <td>
          <a href="{{ item.name }}">
            <img
              alt="folder"
              src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB0AAAAgCAYAAADud3N8AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAVlSURBVEhLxZZLbBxFEIZrZnZ27PU7JjxCwIdIEZiIKBHihk+BIA6gHLnBhQsCCQESEeTACS5IiZJbDiQRygkhkAgiAZFAbDkh2JHs2I7y8GPXxvHa3vfOc2eGqp6eV6/BEhz4rXL39HbXV1Xd2zvwf0jiLVP+2jG5s0d7U1F7XtMyuQIoasGT1YJlrC7V1zfyRtNYHX7phMOn/2ulodc/Vgd29p3Ndmqvt5wWeA0DspICstoFICvg+n7LB1gFScl7IBckRc17kpp3wcnr5eXl6kYl33Ls0r6XT+G0v1cbtB+hGkIznRobM2pN8Go6wmWQ5dR0iDxLKkgZDXyc43l+HduCB9K9zUr12NBzR6f4rEgyb2ORJ5/9Awkhuf5uyO1+COycBuWmCU7LBQ8/J/PJPDTXBs+qg29WQbJrPbJVGc44zVdz2d5X5n7+IB0pqg1KOC/oBsIBWZKge0c3VBwHNsvonEChcXgYSNIM3ZJLmzXuKNYWmSLFQ2zKcMz1wDJtmJ5bgnKlgY9pQAhPWst1wcazISoNRf8+QoKSkVEfjbU+uFja/PI6/DI2DVMzC9DUzQgQBUDBROYhGJ0KEjJFBzgZj2mQIS0gC/s4jH7BxIzn7hbg+uQdBFsMIJabzLItqNWb3HesNNSX+OIgOww9DSYiF3WbdLCwfElQuuR8siABisahBArLyloGbvdCQ0kjEDN8sG2bBSaqrby0D2w/yQOBQhgFQpYQjvIMcU3ScB7bT6yCbbVfYEKm5DzOlEFCMO0zqxcZFxuiQMOYqB+WFuHpL1+kdigHM+Pg5AkWxcrPIGShi+DZMi0o420mKg1lIIyPABzC9pLD2eeCcEYEIYsPEq5Hk9qXiHtKvgnoIoiMwDwAMnQmKoYExuAYHxntqbXdnuJ85pwydRHmin0hU3piaxgosHBPqbXx2tTNbU4v+WwhgK4vF8tMILpRqA2gGH5S3HkEInhkLhpegXhvi2o7SAEoaMMM2Rj2KTPx543yjUGx0Z7u3bvr8NvvHBn544d3UxyhvCGUMuVZYhaU9YNiBeYXVyGjKHx2HECYZdKo1FnfHTFKje+mpxaeZhO50uXFqOPMArBLAWD/QbEMlWp8j2azGXjyiYexVeMMERQZPisdg1h6RVnfNFS+jCldXhTtWwhOlpeiT6pDy8LgQA979QhBYra9Qy+CNjgMpaqh4tZGrHR58S86SCEQnVGfnLJNDYW0YO9iizLmxhZga5iOgk0mWChAC39WQTfs6MTGWXOnfF4o8iuCQqP5jIn3g2449MK1NXTs5pJUbeAPM8su2F8GpkzJiSD6AlEBktmGX6FwX+mvoVudODXLFqFS0M1So4Wn8wr6QU5cWuqz8iZFWZBTMnYDUcufCc5aOiO+VNedblzRESwUoMfPjHsnz137stawP/JcXycYRc3eh0AyfUmd7erK1XL4ekqnl7wSKMhSyBjt7KgDk4stKm8Pug/eaVHxl45r9l7R03Xnxp6hHfNdOW0Eh3IUeXGjVvn05OVTX30/+7Xdkn57ZGffLfy8lskofYoi5XBe4tbgVXENUO1ia2x88sfFleptHGnQcBuUNHN3zRubKMwe3LdrordbewFfQQc2SnXj0ujdsWLJzN+e37hx4cqdC2e+mTz/7U9zp7WschExC/hObCuyPKhmFFbK6tr8+K+jE6cvjt6/rJvOCg6xV0PxTkupv7dD/vzDw88+v3/3eXwLHPzki0vv3bpfuYofraHZbFIs2qpsf6/W/8aRA/sPPPPYwZszK1dPnPt9BgtFP6o0n5dgG2UUSfrs/UNPHT966K09j3c9ikNbVmcLUUL/mNR2+s8OYgH8BcriPUv7BtvXAAAAAElFTkSuQmCC"
            />
          </a>
        </td>
        <td>({{ item.permission }})</td>
        <td>{{ item.modification }}</td>
        <td></td>
        <td>
          <a href="{{ item.name }}"> {{ item.name }} </a>
        </td>
      </tr>
      {% endfor %}
      {% for item in files %}
      <tr>
        <td>
          <a href="{{ item.name }}">
            <img
              alt="file"
              src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB0AAAAgCAYAAADud3N8AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAYcSURBVEhLtVdpbFRVFD7vzb50ZmhpmbYMXWhBWkuFAG4thEDEFARSjVQUC8T6wz9G/iBBEUGD/BD4odEYCUpYDQgNKcGUTWhYDNhSoFq7d2CYKaV02pnSdmbe85w7701naTshxi9z3t3euWe9574BGaIockhaaqWp/w1MQFWNS3e7uf/wndb+FX0eP1uIhii14eCQm+c4UaXirhm1yjX7PitskZbGBRO6ftutJaIIZ9YuzwJrkk6ajY+7Lb1w658eMBtUcPX24ytGvbJ035ZCl7Q8Jnh6+AUxPz/HBNmTEwAZISGMjDolGJCob9AGx0R67KtVPGvXL7dBQU7CS54B/+63Ntdq2M7jQEkPdJGazMN4wqkaBzR1enCO4gxQOM0CAnYaWvug5OVUuNHQA4IgQukiG9uAYNAp4IM3MmHHT81lzkdDtTt/btm1sXxqQFqOAXNk+ed1GwtyLF+teiWDxUkGdXH/MUGuJRdvWJ0FSgUHbY4B2PZj0+CTQWHNRLPm+Lcf54/KzdyLhghSC6fR0r9a3XD2uhOOnbNHKBEPWWl6WPeaTatUct/1eofnStMxYEJxY6YRCSgpSoMZ2WZY/LwVXkcXkiJPg/mzEqF04aSJ/oB4qOLL+mxpOgJMKIoMbV19zQm7D/wNew42svbkBTu03vOw/rX6h9JbQZCSgQAyRym2YoEVFsxKnOr2+L9ZvbkWj0MkmPPe3Vq3YWau5WuKKSVQuEtpQ4qrAtWjNlxAd+8g7D3ZCsuKkmFengUUGFcZQ8MC7DncBu0PBrbPeca8dcM7U1kICSx7EaGtLt50YnL0wQSTGsqWZEqzaFGIZQQTLVpYWpQKv56/D98f64gpIAq0QK9T5CnUPHk0tINs6Udo6S6ylI6D7G0Fezc+yDPEF42auodQddlxcOHclPL3lqeHjpC8a8gvNxoewZEzHYwOnG6Dg0hHfmuHrp4ncBVjSuPj5zqh3+uTOIIu51DyaBRcj3RTjNBncywsg4mWFafD0uI0ePWlVEg0aQC9wcaL51nRbXJkxgWTJskOISamLfZ+aHd4oQAFUIW60+yWVoLISjdiLNVwubaLWUjJ8+LMZGju7IesyQa4cbeHzc2fnUK7olFoL6eQuIOICVp6ig6em26BJLMaN0frsAwS0Ry1abhuMqqYUoU4V5BjxvqrgMx0PavJ+TjOyzZhhSJ5tCNWHjxW4YgRmmjWgs1qhASDmlFGqpERzVFLbtZrVaw/BedoXqNWQPIEHWg1SrBNMqDihojjo+AjhbKV8HM6Fh65h6AHKZJ9fFBortR1n+3p8+1ITdY6SoqtjWWLJgW/EsKPTDQobpduuuDUJQdaxLPCThj2Y45QTPEsDvoE0Gl4GMbWLx0MPY55qjSIIZzHNUGl4ksPbZ9VGTcFh30B+ENKjg/LMjG2JqZIVU0XeAcDMH2KAX44YYet7+fC0eoHcKX+MRYSET6tyIXMVB1792i1Ayp/d/E4KMItK2OOTDTInXSfykBmeHNTLew/fX9sJgn7q+7Bqk1/wokLThxxaHmw2sQkUjwU5pqgYqUNptkM0szYWPJCMmxBi2dkJbAx1QtqZaEjpsTBkyEBk2qYxSkeGju9UH29G6vZUHBC8hgTOq6botRpsnvRxV1gdw1KMyPITtfBnBkmSMbiQXwkg2qyyUCpwyo62y2ueymB6IOM4orXFDi7R4S50AL6RPFhJjd2eCDDqmMuzbBqoRmVSzKp2Dgv24hvc+D3iwPEx4wsxyODFWbUI0OwO71w4rwduh4Hz6kUmqDuCBrL/XCgEMpkj0rJufFqtGPlenvvJzNbGfd451QGvcg9ZdrV1D6Eyov3Dyyck7S2YuWUmKstLsgOAXPnaQkzlo++l9kIHwH/aJ8G/xnB5AlI4ZAhq3D5dpPb19juZncfVa8oEpF8Eo22HkP4Y0nn84vdTW2eCItoDdZ/cYvHD6l1+JG8ExVLYiuRICZUmhNQPocdWVniZ3uMgQa84kp+2TG7QxozRDBcre9VdroGrHj9obJsc2mdE8hT5Cye4/EvJR4+FMuJ9MBl8iE90E88BPBl9n0VMGiUzmXFKVF/AwH+BaCVgQ0oyfmZAAAAAElFTkSuQmCC"
            />
          </a>
        </td>
        <td>({{ item.permission }})</td>
        <td>{{ item.modification }}</td>
        <td>{{ item.size }}</td>
        <td>
          <a href="{{ item.name }}"> {{ item.name }} </a>
        </td>
      </tr>
      {% endfor %}
    </table>
    <div
      class="modal fade"
      id="uploadModalID"
      tabindex="-1"
      aria-labelledby="uploadModalLabelID"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="uploadModalLabelID">Upload Files</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body d-flex flex-column">
            <div id="dragID" class="drop-box d-flex p-3">
              <span class="mx-auto"></span>

              <button class="btn btn-primary mx-auto px-5 position-relative">
                Choose Files
                <input type="file" multiple="" class="d-none" />
              </button>
            </div>
            <div id="fileListID" class="card mt-3 overflow-auto d-none">
              <div class="card-body"></div>
            </div>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Close
            </button>
          </div>
        </div>
      </div>
    </div>
    <div class="position-fixed top-0 end-0 p-3 stratosphere">
      <div
        id="uploadSuccessToastID"
        class="toast border-success"
        role="alert"
        aria-live="assertive"
        aria-atomic="true"
      >
        <div class="toast-header border-success">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="16"
            height="16"
            fill="currentColor"
            class="bi bi-check-circle-fill text-success me-2"
            viewBox="0 0 16 16"
          >
            <path
              d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z"
            />
          </svg>
          <strong class="me-auto">Success</strong>
          <small>just now</small>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="toast"
            aria-label="Close"
          ></button>
        </div>
        <div class="toast-body"></div>
      </div>
      <div
        id="uploadFailedToastID"
        class="toast border-danger"
        role="alert"
        aria-live="assertive"
        aria-atomic="true"
      >
        <div class="toast-header border-danger">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="16"
            height="16"
            fill="currentColor"
            class="bi bi-x-circle-fill text-danger me-2"
            viewBox="0 0 16 16"
          >
            <path
              d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM5.354 4.646a.5.5 0 1 0-.708.708L7.293 8l-2.647 2.646a.5.5 0 0 0 .708.708L8 8.707l2.646 2.647a.5.5 0 0 0 .708-.708L8.707 8l2.647-2.646a.5.5 0 0 0-.708-.708L8 7.293 5.354 4.646z"
            />
          </svg>
          <strong class="me-auto">Failed</strong>
          <small>just now</small>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="toast"
            aria-label="Close"
          ></button>
        </div>
        <div class="toast-body"></div>
      </div>
      <div
        id="uploadSuccessfulFailedToastID"
        class="toast border-warning"
        role="alert"
        aria-live="assertive"
        aria-atomic="true"
      >
        <div class="toast-header border-warning">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="16"
            height="16"
            fill="currentColor"
            class="bi bi-exclamation-circle-fill text-warning me-2"
            viewBox="0 0 16 16"
          >
            <path
              d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM8 4a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0l.35-3.507A.905.905 0 0 0 8 4zm.002 6a1 1 0 1 0 0 2 1 1 0 0 0 0-2z"
            />
          </svg>
          <strong class="me-auto">Warning</strong>
          <small>just now</small>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="toast"
            aria-label="Close"
          ></button>
        </div>
        <div class="toast-body"></div>
      </div>
    </div>
  </body>
</html>
